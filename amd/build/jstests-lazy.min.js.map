{"version":3,"file":"jstests-lazy.min.js","sources":["../src/jstests-lazy.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * VPL JavaScript test\n *\n * @copyright 2017 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\nimport $ from 'jquery';\nimport {VPLUtil} from 'mod_vpl/vplutil';\n\nvar tests = [];\nvar result = [];\nvar testing = '';\nvar nAsserts = 0;\n\n/**\n * Show results of tests in page and window.console\n */\nfunction showResults() {\n    var stat = nAsserts + \" asserts tested\";\n    window.console.log(stat);\n    $('#test_results').append($('<p></p>').text(stat));\n    var message;\n    if (result.length == 0) {\n        message = 'Test passed';\n    } else {\n        message = result.length + ' errors found';\n    }\n    window.console.log(message);\n    $('#test_results').append($('<p></p>').text(message));\n    if (result.length > 0) {\n        var list = $('<ol></ol>');\n        for (var i = 0; i < result.length; i++) {\n            window.console.log((i + 1) + ': ' + result[i]);\n            var element = $('<li></li>');\n            element.text(result[i]);\n            list.append(element);\n        }\n        $('#test_results').append(list);\n    }\n}\n\n/**\n * Basic test assert\n * @param {boolean} b test result\n * @param {string} message Optional message\n */\nfunction assert(b, message) {\n    nAsserts++;\n    if (!b) {\n        if (typeof message == 'string') {\n            result.push(\"Error: \" + message + \" testing \" + testing);\n        }\n    }\n}\n\n/**\n * Basic test assert\n * @param {boolean} a Expected\n * @param {boolean} b Actual\n * @param {string} message Optional message\n */\nfunction assertEquals(a, b, message) {\n    nAsserts++;\n    if (a != b) {\n        if (typeof message == 'string') {\n            result.push(\"Error: \" + message + \" testing \" + testing + '. Expected \"' + a + '\" found \"' + b + '\"');\n        }\n    }\n}\n\ntests.push({\n    'name': \"VPLUtil\",\n    'test': function() {\n        assert(VPLUtil.returnTrue(), 'returnTrue');\n        assert(!VPLUtil.returnFalse(), 'returnFalse');\n        (function() {\n            var rawData = new ArrayBuffer(13);\n            assertEquals(13, rawData.byteLength, 'rawData.byteLength');\n            var bufferData = new Uint8Array(rawData);\n            for (var i = 0; i < bufferData.length; i++) {\n                bufferData[i] = Math.round(Math.random() * 255);\n            }\n            assertEquals(13, bufferData.length, 'bufferData.length');\n            var stringData = \"abcdeñhfjéÇ123143565387095609784\";\n            var rawResult = VPLUtil.String2ArrayBuffer(stringData);\n            var stringResult = VPLUtil.ArrayBuffer2String(rawResult);\n            assertEquals(stringData, stringResult, 'ArrayBuffer2String');\n            stringResult = VPLUtil.ArrayBuffer2String(rawData);\n            rawResult = VPLUtil.String2ArrayBuffer(stringResult);\n            var bufferResult = new Uint8Array(rawResult);\n            assertEquals(bufferData.length, bufferResult.length, 'String2ArrayBuffer');\n            if (bufferData.length == bufferResult.length) {\n                for (var j = 0; j < bufferData.length; j++) {\n                    assertEquals(bufferData[j], bufferResult[j], 'String2ArrayBuffer values');\n                }\n            }\n        })();\n        (function() {\n            assertEquals('c', VPLUtil.fileExtension('a.c'), 'fileExtension');\n            assertEquals('C', VPLUtil.fileExtension('a.c.C'), 'fileExtension');\n            assertEquals('hxx', VPLUtil.fileExtension('a.hxx'), 'fileExtension');\n            assertEquals('all', VPLUtil.fileExtension('.all'), 'fileExtension');\n        })();\n        (function() {\n            assert(!VPLUtil.isImage('a.c'), 'isImage');\n        })();\n        (function() {\n            assert(VPLUtil.isImage('a.png'), 'isImage');\n        })();\n        (function() {\n            assert(!VPLUtil.isBinary('a.c'), 'isBinary');\n        })();\n        (function() {\n            assert(VPLUtil.isBinary('a.pdf'), 'isBinary');\n        })();\n        (function() {\n            assert(VPLUtil.isBinary('a.png'), 'isBinary');\n        })();\n        (function() {\n            // Test isBinary with text content\n            var textContent = 'int main() {\\n    return 0;\\n}';\n            assert(!VPLUtil.isBinary('test.unknown', textContent), 'isBinary with text content');\n        })();\n        (function() {\n            // Test isBinary with binary content (null byte)\n            var binaryContent = 'text\\x00binary';\n            assert(VPLUtil.isBinary('test.unknown', binaryContent), 'isBinary with null byte');\n        })();\n        (function() {\n            // Test isBinary with Uint8Array text content\n            var encoder = new TextEncoder();\n            var textArray = encoder.encode('Hello World');\n            assert(!VPLUtil.isBinary('test.unknown', textArray), 'isBinary with Uint8Array text');\n        })();\n        (function() {\n            // Test isBinary with Uint8Array binary content\n            var binaryArray = new Uint8Array([0x00, 0x01, 0x02, 0x03]);\n            assert(VPLUtil.isBinary('test.unknown', binaryArray), 'isBinary with Uint8Array binary');\n        })();\n        (function() {\n            // Test isBinary with ArrayBuffer\n            var buffer = new ArrayBuffer(4);\n            var view = new Uint8Array(buffer);\n            view[0] = 72; // 'H'\n            view[1] = 105; // 'i'\n            view[2] = 33; // '!'\n            view[3] = 10; // '\\n'\n            assert(!VPLUtil.isBinary('test.unknown', buffer), 'isBinary with ArrayBuffer text');\n        })();\n        (function() {\n            // Test isBinary with mixed content (mostly text with control chars)\n            var mixedContent = 'Some text\\x05with control chars';\n            assert(VPLUtil.isBinary('test.unknown', mixedContent), 'isBinary with control chars');\n        })();\n        (function() {\n            // Test isBinary falls back to extension when no content provided\n            assert(VPLUtil.isBinary('test.pdf', undefined), 'isBinary extension fallback');\n            assert(!VPLUtil.isBinary('test.txt', undefined), 'isBinary extension fallback for text');\n        })();\n        (function() {\n            assert(!VPLUtil.isBlockly('a.c'), 'isBlockly');\n        })();\n        (function() {\n            assert(VPLUtil.validFileName('a.c'), 'validFileName');\n        })();\n    }\n});\n\ntests.push({\n    'name': \"VPLUtil langType\",\n    'test': function() {\n        var mapnames = VPLUtil.getLangNames();\n        for (var ext in mapnames) {\n            var filename;\n            if (ext == 'plain_text') {\n                continue;\n            }\n            if (ext.startsWith('.')) {\n                filename = ext.substring(1);\n            } else {\n                filename = 'filename.' + ext;\n            }\n            assert(VPLUtil.langType(filename) != 'plain_text', 'VPLUtil.langType');\n        }\n        assert(VPLUtil.langType('otra_cosa') == 'plain_text', 'VPLUtil.langType');\n    }\n});\n\n/**\n * Run tests in tests array\n */\nfunction runTests() {\n    for (var i = 0; i < tests.length; i++) {\n        try {\n            testing = tests[i].name;\n            tests[i].test();\n        } catch (e) {\n            result.push(\"Error: Exception \" + e.message + \" testing \" + testing + \"\\n\" + e.stack);\n        }\n    }\n}\n\nexport const start = () => {\n    runTests();\n    showResults();\n};\n"],"names":["tests","result","testing","nAsserts","assert","b","message","push","assertEquals","a","textArray","binaryArray","buffer","view","VPLUtil","returnTrue","returnFalse","rawData","ArrayBuffer","byteLength","bufferData","Uint8Array","i","length","Math","round","random","stringData","rawResult","String2ArrayBuffer","stringResult","ArrayBuffer2String","bufferResult","j","fileExtension","isImage","isBinary","TextEncoder","encode","undefined","isBlockly","validFileName","mapnames","getLangNames","ext","filename","startsWith","substring","langType","name","test","e","stack","runTests","stat","window","console","log","append","text","list","element","showResults"],"mappings":"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"}