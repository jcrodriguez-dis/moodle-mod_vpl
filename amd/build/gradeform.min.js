define("mod_vpl/gradeform",["exports","jquery"],(function(_exports,_jquery){var obj;
/**
   * JavaScript functions to help grade form
   * @copyright 2012 Juan Carlos Rodr√≠guez-del-Pino, 2021 Astor Bizard
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */function reduceGradeWithComments(grade,comments){for(var match,regDiscount=/^-.+\((-[0-9.]+)\)\s*$/gm;null!==(match=regDiscount.exec(comments));){var rest=parseFloat(match[1]);rest<0&&(grade+=rest)}return grade}function formatGrade(grade){return grade<0?0:Math.round(100*grade)/100}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.updateSubmissionsList=_exports.setup=_exports.highlightSubmission=void 0,_jquery=(obj=_jquery)&&obj.__esModule?obj:{default:obj};_exports.setup=()=>{(0,_jquery.default)('button[data-role="calculategrade"]').click((function(){var $form=(0,_jquery.default)(this).closest("form"),text=$form.find('[name="comments"]').val(),grade=parseFloat((0,_jquery.default)(this).data("maxgrade"));grade=formatGrade(reduceGradeWithComments(grade,text)),$form.find('[name="grade"]').val(grade)})),(0,_jquery.default)('button[data-role="mergegrade"]').click((function(){var $form=(0,_jquery.default)(this).closest("form"),gridpoints=0;$form.find(".score .scorevalue").length>0?$form.find(".checked .score .scorevalue").each((function(){gridpoints+=Number((0,_jquery.default)(this).text())})):$form.find(".score input").each((function(){gridpoints+=Number((0,_jquery.default)(this).val())}));var advancedgradingcomments="";$form.find(".criterion .remark textarea").each((function(){advancedgradingcomments+=(0,_jquery.default)(this).val()+"\n"})),gridpoints=reduceGradeWithComments(gridpoints,advancedgradingcomments);var maxgrade=(0,_jquery.default)(this).data("maxgrade"),currentgrade=(0,_jquery.default)(this).data("currentgrade"),grade=formatGrade(currentgrade-(0,_jquery.default)(this).data("maxgridpoints")*(currentgrade/maxgrade)+gridpoints);$form.find('[name="grade"]').val(grade);var $comments=$form.find('[name="comments"]'),text=$comments.val(),gridcomment="#Grid grade: "+grade,proposedcomment="#Proposed grade: "+currentgrade;text=(text=text.search("#Grid grade")<0?gridcomment+"\n"+text:text.replace(new RegExp("#Grid grade.*"),gridcomment)).search("#Proposed grade")<0?proposedcomment+"\n"+text:text.replace(new RegExp("#Proposed grade.*"),proposedcomment),$comments.val(text)})),(0,_jquery.default)('button[data-role="importfromsub"]').click((function(){var $form=(0,_jquery.default)(this).closest("form");$form.find('[name="grade"]').val((0,_jquery.default)(this).data("grade")),$form.find('[name="comments"]').val((0,_jquery.default)(this).data("comments")),(0,_jquery.default)("#advancedgrading-criteria .criterion .remark textarea").val(""),(0,_jquery.default)("#advancedgrading-criteria .criterion .score input").val(""),(0,_jquery.default)("#advancedgrading-criteria .criterion .level.checked").click(),(0,_jquery.default)(this).data("advgrading").forEach((function(criterion){var id=criterion.criterionid;void 0!==criterion.remark&&$form.find('[name="advancedgrading[criteria]['+id+'][remark]"]').val(criterion.remark),void 0!==criterion.score&&$form.find('[name="advancedgrading[criteria]['+id+'][score]"]').val(parseFloat(criterion.score)),void 0!==criterion.levelid&&(0,_jquery.default)("#advancedgrading-criteria-"+id+"-levels-"+criterion.levelid).click()}))}))};_exports.updateSubmissionsList=(submissionID,gradeData,nexturl)=>{if(null!==opener&&((0,_jquery.default)(opener.document).find("#g"+submissionID).html(gradeData.grade),(0,_jquery.default)(opener.document).find("#m"+submissionID).html(gradeData.grader),(0,_jquery.default)(opener.document).find("#o"+submissionID).html(gradeData.gradedon),(0,_jquery.default)(opener.document).find("#c"+submissionID).html(gradeData.comments),(0,_jquery.default)(opener.document).find(".gd"+submissionID).css("color","").css("backgroundColor","")),nexturl){null===opener&&window.close();var nextrow=(0,_jquery.default)(opener.document).find("#g"+submissionID).closest("tr").next();0==nextrow.length&&window.close();var nextid=nextrow.html().match(/user\/view\.php\?(.*?)id=([0-9]+)/)[2];nextid?location.replace(nexturl+nextid):window.close()}};_exports.highlightSubmission=submissionID=>{null!==opener&&((0,_jquery.default)(opener.document).find(".gd"+submissionID).css("color","black").css("backgroundColor","yellow"),window.onunload=function(){(0,_jquery.default)(opener.document).find(".gd"+submissionID).css("color","").css("backgroundColor","")})}}));

//# sourceMappingURL=gradeform.min.js.map