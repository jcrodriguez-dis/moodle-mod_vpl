{"version":3,"file":"vplutil.min.js","sources":["../src/vplutil.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tools for the VPL IDE\n *\n * @copyright 2016 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\n/* globals Blockly */\n/* globals ace */\n\nimport $ from 'jquery';\nimport log from 'core/log';\nimport url from 'core/url';\nexport var VPLUtil = {};\nVPLUtil.doNothing = $.noop;\nVPLUtil.returnFalse = function() {\n    return false;\n};\nVPLUtil.returnTrue = function() {\n    return true;\n};\nvar debugMode = false;\nVPLUtil.log = function(m, forced) {\n    if (debugMode || forced) {\n        log.debug(m);\n    }\n};\nVPLUtil.setUserPreferences = function(pref) {\n    $.ajax({\n        async: true,\n        type: \"POST\",\n        url: url.relativeUrl('/mod/vpl/editor/userpreferences.json.php'),\n        'data': JSON.stringify(pref),\n        contentType: \"application/json; charset=utf-8\",\n        dataType: \"json\"\n    });\n};\nVPLUtil.getUserPreferences = function(func) {\n    $.ajax({\n        async: true,\n        type: \"POST\",\n        url: url.relativeUrl('/mod/vpl/editor/userpreferences.json.php'),\n        'data': JSON.stringify({getPreferences: true}),\n        contentType: \"application/json; charset=utf-8\",\n        dataType: \"json\"\n    }).done(func);\n};\nVPLUtil.sanitizeHTML = function(t) {\n    if (typeof t == 'undefined' || t.replace(/^\\s+$/g, '') == '') {\n        return '';\n    }\n    return $('<div>' + t + '</div>').html();\n};\nVPLUtil.sanitizeText = function(s) {\n    if (typeof s == 'undefined' || s.replace(/^\\s+$/g, '') == '') {\n        return '';\n    }\n    return s.replace(/&/g, \"&amp;\")\n            .replace(/</g, \"&lt;\")\n            .replace(/>/g, \"&gt;\")\n            .replace(/\"/g, \"&quot;\")\n            .replace(/'/g, \"&#39;\");\n};\n\nVPLUtil.setProtocol = function(coninfo) {\n    var secure;\n    if (coninfo.securePort == 0 || coninfo.port == 0) {\n        secure = coninfo.port == 0;\n    } else {\n        switch (coninfo.wsProtocol) {\n            case 'always_use_wss':\n                secure = true;\n                break;\n            case 'always_use_ws':\n                secure = false;\n                break;\n            default:\n                secure = window.location.protocol == 'https:';\n        }\n    }\n    var URLBase = (secure ? 'wss://' : 'ws://') + coninfo.server;\n    coninfo.secure = secure;\n    coninfo.portToUse = secure ? coninfo.securePort : coninfo.port;\n    URLBase += ':' + coninfo.portToUse + '/';\n    coninfo.monitorURL = URLBase + coninfo.monitorPath;\n    coninfo.executionURL = URLBase + coninfo.executionPath;\n};\nVPLUtil.ArrayBuffer2String = function(data) {\n    var view = new Uint8Array(data);\n    var chunks = [];\n    var chunkSize = 32000;\n    var i, len;\n    for (i = 0, len = view.length; i < len; i += chunkSize) {\n        chunks.push(String.fromCharCode.apply(String, view.subarray(i, Math.min(i + chunkSize, len))));\n    }\n    return chunks.join('');\n};\nVPLUtil.String2ArrayBuffer = function(data) {\n    var len = data.length;\n    var ret = new ArrayBuffer(len);\n    var u8 = new Uint8Array(ret);\n    for (var i = 0; i < len; i++) {\n        u8[i] = data.charCodeAt(i);\n    }\n    return ret;\n};\n\n(function() {\n    var fileUniqueId = 0;\n    VPLUtil.getUniqueId = function() {\n        return fileUniqueId++;\n    };\n})();\n(function() {\n    var regExt = /\\.([^.]*)$/;\n    var regImg = /^(gif|jpg|jpeg|png|ico)$/i;\n    var regAudio = /^(wav|aiff|pcm|mp3|aac|ogg|wma|m4a|flac|alac|ape|wv|amr)$/i;\n    var regVideo = /^(mp4|webm|ogg|ogv|avi|mov|wmv|flv|mkv|m4v|mpeg|mpg|3gp)$/i;\n    var regBin = /^(zip|jar|pdf|tar|bin|7z|arj|deb|gzip|rar|rpm|dat|db|dll|rtf|doc|docx|odt|exe|com)$/i;\n    var regBlk = /^blockly[0123]?$/;\n    VPLUtil.fileExtension = function(fileName) {\n        var res = regExt.exec(fileName);\n        return res !== null ? res[1] : '';\n    };\n    VPLUtil.isImage = function(fileName) {\n        return regImg.test(VPLUtil.fileExtension(fileName));\n    };\n    VPLUtil.isAudio = function(fileName) {\n        return regAudio.test(VPLUtil.fileExtension(fileName));\n    };\n    VPLUtil.isVideo = function(fileName) {\n        return regVideo.test(VPLUtil.fileExtension(fileName));\n    };\n    VPLUtil.isBinary = function(fileName, fileContents) {\n        // Check by extension first.\n        if (VPLUtil.isImage(fileName) || VPLUtil.isAudio(fileName) || VPLUtil.isVideo(fileName)\n            || regBin.test(VPLUtil.fileExtension(fileName))) {\n            return true;\n        }\n        // @Astor-Bizard binary file detection.\n        if (typeof fileContents === 'undefined' || !fileContents) {\n            return false;\n        }\n        var textBytes = [7, 8, 9, 10, 12, 13, 27]\n                        .concat([...Array(0x5f).keys()].map(i => i + 0x20)) // Include [0x20 -> 0x7e].\n                        .concat([...Array(0x80).keys()].map(i => i + 0x80)); // Include [0x80 -> 0xff].\n        textBytes = Object.entries(textBytes).reduce((obj, [key, value]) => ({...obj, [value]: key}), {});\n        var bytes = null;\n        if (fileContents instanceof Uint8Array) {\n            bytes = fileContents;\n        } else if (fileContents instanceof ArrayBuffer) {\n            bytes = new Uint8Array(fileContents);\n        } else if (fileContents instanceof String || typeof fileContents === 'string') {\n            bytes = (new TextEncoder()).encode(fileContents.substring(0, 512));\n        } else {\n            return false;\n        }\n        var sizechecked = Math.min(1024, bytes.length);\n        for (var i = 0; i < sizechecked; i++) {\n            if (!textBytes.hasOwnProperty(bytes[i])) {\n                // Byte is not a standard text byte, file is likely binary.\n                return true;\n            }\n        }\n        return false;\n    };\n    VPLUtil.isBlockly = function(fileName) {\n        return regBlk.test(VPLUtil.fileExtension(fileName));\n    };\n    var regInvalidFileName = /[\\cA-\\cZ]|[:-@]|[{-~]|\\\\|\\[|\\]|[/^`´]|^-|^ | $|\\.\\./;\n    VPLUtil.validFileName = function(fileName) {\n        if (fileName.length < 1) {\n            return false;\n        }\n        if (fileName.length > 128) {\n            return false;\n        }\n        return !(regInvalidFileName.test(fileName));\n    };\n})();\nVPLUtil.getCurrentTime = function() {\n    return parseInt((new Date()).valueOf() / 1000);\n};\n\nVPLUtil.validPath = function(path) {\n    if (path.length > 256) {\n        return false;\n    }\n    var dirs = path.split(\"/\");\n    for (var i = 0; i < dirs.length; i++) {\n        if (!VPLUtil.validFileName(dirs[i])) {\n            return false;\n        }\n    }\n    return true;\n};\nVPLUtil.getFileName = function(path) {\n    var dirs = path.split(\"/\");\n    return dirs[dirs.length - 1];\n};\nVPLUtil.dataFromURLData = function(data) {\n    return data.substring(data.indexOf(',') + 1);\n};\n\n(function() {\n    var MIME = {\n        'gif': 'image/gif',\n        'jpg': 'image/jpeg',\n        'jpeg': 'image/jpeg',\n        'png': 'image/png',\n        'ico': 'image/vnd.microsoft.icon',\n        'pdf': 'application/pdf',\n        // Audio formats\n        'wav': 'audio/wav',\n        'aiff': 'audio/aiff',\n        'pcm': 'audio/pcm',\n        'mp3': 'audio/mpeg',\n        'aac': 'audio/aac',\n        'ogg': 'audio/ogg',\n        'oga': 'audio/ogg',\n        'wma': 'audio/x-ms-wma',\n        'm4a': 'audio/mp4',\n        'flac': 'audio/flac',\n        'alac': 'audio/alac',\n        'ape': 'audio/x-ape',\n        'wv': 'audio/x-wavpack',\n        'amr': 'audio/amr',\n        // Video formats\n        'mp4': 'video/mp4',\n        'webm': 'video/webm',\n        'ogv': 'video/ogg',\n        'avi': 'video/x-msvideo',\n        'mov': 'video/quicktime',\n        'wmv': 'video/x-ms-wmv',\n        'flv': 'video/x-flv',\n        'mkv': 'video/x-matroska',\n        'm4v': 'video/x-m4v',\n        'mpeg': 'video/mpeg',\n        'mpg': 'video/mpeg',\n        '3gp': 'video/3gpp'\n    };\n    VPLUtil.getMIME = function(fileName) {\n        var ext = VPLUtil.fileExtension(fileName);\n        if (ext in MIME) {\n            return MIME[ext];\n        }\n        return 'application/octet-stream';\n    };\n    VPLUtil.getTimeLeft = function(timeLeft) {\n        var res = '';\n        var minute = 60;\n        var hour = 60 * minute;\n        var day = 24 * hour;\n        if (timeLeft < 0) {\n            res += '-';\n            timeLeft = -timeLeft;\n        }\n        var timePending = timeLeft;\n        var days = parseInt(timePending / day);\n        timePending -= days * day;\n        if (days !== 0) {\n            res += days + 'T';\n        }\n        var hours = parseInt(timePending / hour);\n        timePending -= hours * hour;\n        var minutes = parseInt(timePending / minute);\n        timePending -= minutes * minute;\n        var seconds = parseInt(timePending);\n        res += ('00' + hours).slice(-2) + ':';\n        res += ('00' + minutes).slice(-2);\n        if (timeLeft < hour) {\n            res += ':' + ('00' + seconds).slice(-2);\n        }\n        return res;\n    };\n})();\n(function() {\n    var maplang = {\n        'Abap': 'abap',\n        'ABC': 'abc',\n        'Ada': 'ada',\n        'ActionScript': 'actionscript',\n        'x86 assembly': 'assembly_x86',\n        'Bash': 'sh',\n        'Batch': 'batchfile',\n        'C': 'c_cpp',\n        'C++': 'c_cpp',\n        'VPL cases': 'cases',\n        'Cobol': 'cobol',\n        'CoffeeScript': 'coffee',\n        'Clojure': 'clojure',\n        'C#': 'csharp',\n        'C# project': 'xml',\n        'CSS': 'css',\n        'D': 'd',\n        'Dart': 'dart',\n        'Eiffel': 'eiffel',\n        'Erlang': 'erlang',\n        'F#': 'fsharp',\n        'F# project': 'xml',\n        'Fortran': 'fortran',\n        'Go': 'golang',\n        'Groovy': 'groovy',\n        'Dot': 'dot',\n        'Haskell': 'haskell',\n        'HTML': 'html',\n        'Haxe': 'haxe',\n        'Java': 'java',\n        'Julia': 'julia',\n        'JavaScript': 'javascript',\n        'JSON': 'json',\n        'JSP': 'jsp',\n        'JSX': 'jsx',\n        'OCaml': 'ocaml',\n        'Kotlin': 'kotlin',\n        'Makefile': 'makefile',\n        'Matlab': 'matlab',\n        'Markdown': 'markdown',\n        'LaTeX': 'latex',\n        'Less': 'less',\n        'LISP': 'lisp',\n        'Lua': 'lua',\n        'Pascal': 'pascal',\n        'Perl': 'perl',\n        'PHP': 'php',\n        'Plain text': 'plain_text',\n        'Prolog': 'prolog',\n        'PSeInt': 'pseint',\n        'Python': 'python',\n        'R': 'r',\n        'reStructuredText': 'rst',\n        'Ruby': 'ruby',\n        'Rust': 'rust',\n        'SASS': 'sass',\n        'Scala': 'scala',\n        'Scheme': 'scheme',\n        'SCSS': 'scss',\n        'Bash/shell': 'sh',\n        'Swift': 'swift',\n        'SQL': 'sql',\n        'SVG': 'svg',\n        'TeX': 'tex',\n        'tcl': 'tcl',\n        'TypeScript': 'typescript',\n        'Twig': 'twig',\n        'VBScript': 'vbscript',\n        'Verilog': 'verilog',\n        'VisualBasic': 'vbscript',\n        'VisualBasic project': 'xml',\n        'VHDL': 'vhdl',\n        'XML': 'xml',\n        'Yaml': 'yaml'\n    };\n    var mapname = {\n        'abap': 'Abap',\n        'abc': 'ABC',\n        'ada': 'Ada', 'ads': 'Ada', 'adb': 'Ada',\n        'as': 'ActionScript', 'as3': 'ActionScript',\n        'asm': 'x86 assembly',\n        'bash': 'Bash',\n        'bat': 'Batch',\n        'c': 'C', 'C': 'C++', 'cc': 'C++', 'cpp': 'C++', 'c++': 'C++',\n        'hxx': 'C++', 'h': 'C', 'H': 'C++',\n        'cases': 'VPL cases',\n        'cbl': 'Cobol', 'cob': 'Cobol',\n        'coffee': 'CoffeeScript',\n        'clj': 'Clojure',\n        'cs': 'C#',\n        'csproj': 'C# project',\n        'css': 'CSS',\n        'd': 'D',\n        'dart': 'Dart',\n        'e': 'Eiffel',\n        'erl': 'Erlang', 'hrl': 'Erlang',\n        'f': 'Fortran', 'f77': 'Fortran', 'f90': 'Fortran', 'for': 'Fortran',\n        'fs': 'F#',\n        'fsproj': 'F# project',\n        'go': 'Go',\n        'groovy': 'Groovy',\n        'gv': 'Dot',\n        'hs': 'Haskell',\n        'htm': 'HTML', 'html': 'HTML',\n        'hx': 'Haxe',\n        'java': 'Java',\n        'jl': 'Julia',\n        'js': 'JavaScript',\n        'json': 'JSON',\n        'jsp': 'JSP',\n        'jsx': 'JSX',\n        'kt': 'Kotlin', 'kts': 'Kotlin',\n        'm': 'Matlab',\n        'md': 'Markdown',\n        'ml': 'OCaml', 'mli': 'OCaml',\n        'latex': 'LaTeX',\n        'less': 'Less',\n        'lisp': 'LISP', 'lsp': 'LISP',\n        'lua': 'Lua',\n        'pas': 'Pascal', 'p': 'Pascal',\n        'perl': 'Perl', 'prl': 'Perl',\n        'php': 'PHP',\n        'pro': 'Prolog', 'pl': 'Prolog',\n        'psc': 'pseint',\n        'py': 'Python',\n        'R': 'R', 'r': 'R',\n        'rb': 'Ruby', 'ruby': 'Ruby',\n        'rs': 'Rust',\n        'rst': 'reStructuredText',\n        's': 'x86 assembly',\n        'sass': 'SASS',\n        'scala': 'Scala',\n        'scm': 'Scheme',\n        'scss': 'SCSS',\n        'sh': 'Bash/shell',\n        'swift': 'Swift',\n        'sql': 'SQL',\n        'svg': 'SVG',\n        'tex': 'TeX',\n        'tcl': 'TCL',\n        'ts': 'TypeScript',\n        'twig': 'Twig',\n        'vb': 'VisualBasic',\n        'vbproj': 'VisualBasic project',\n        'vbs': 'VBSscript',\n        'v': 'Verilog', 'vh': 'Verilog',\n        'vhd': 'VHDL', 'vhdl': 'VHDL',\n        'xml': 'XML',\n        'yaml': 'YAML',\n        // Add dot to indicate that is not a file extension.\n        '.makefile': 'Makefile',\n        '.Makefile': 'Makefile'\n    };\n\n    /**\n     * Returns the language names\n     * @returns {object} copy of the language names\n     */\n    VPLUtil.getLangNames = function() {\n        return Object.assign({}, mapname);\n    };\n\n    /**\n     * Returns the Ace9 language type for a file\n     * @param {string} filenamepath\n     * @returns {string} language type\n     * @see https://ace.c9.io/#nav=api&api=edit_session\n     */\n    VPLUtil.langType = function(filenamepath) {\n        var ext = VPLUtil.fileExtension(filenamepath);\n        if (ext in mapname) {\n            return maplang[mapname[ext]];\n        }\n        var extfile = '.' + VPLUtil.getFileName(filenamepath);\n        if (extfile in mapname) {\n            return maplang[mapname[extfile]];\n        }\n        return 'plain_text';\n    };\n\n    /**\n     * Returns the language name for a file\n     * @param {string} filenamepath\n     * @returns {string} language name\n     */\n    VPLUtil.langName = function(filenamepath) {\n        var ext = VPLUtil.fileExtension(filenamepath);\n        if (ext in mapname) {\n            return mapname[ext];\n        }\n        var extfile = '.' + VPLUtil.getFileName(filenamepath);\n        if (extfile in mapname) {\n            return mapname[extfile];\n        }\n        return 'Plain text';\n    };\n\n    VPLUtil.useHardTabs = function(filenamepath) {\n        var type = VPLUtil.langType(filenamepath);\n        return type == 'makefile' || type == 'golang';\n    };\n})();\n(function() {\n    var i18n = {};\n    var strreg = /\\{\\\\*\\$a\\\\*}/g;\n    VPLUtil.str = function(key, parm) {\n        if (!i18n[key]) {\n            return '{' + key + '}';\n        }\n        if (typeof parm != 'undefined') {\n            return i18n[key].replace(strreg, parm);\n        } else {\n            return i18n[key];\n        }\n    };\n    VPLUtil.setStr = function(newi18n) {\n        for (var key in newi18n) {\n            if (newi18n.hasOwnProperty(key)) {\n                i18n[key] = newi18n[key];\n            }\n        }\n    };\n    VPLUtil.setStr(window.VPLi18n);\n})();\n(function() {\n    var delayedActions = {};\n    var afterAllActions = {};\n    var shortTimeout = 20;\n    var longTimeout = 100;\n    var numberDelayed = 0;\n    var internalDelay = function(timeout, id, func, arg1, arg2) {\n        if (typeof delayedActions[id] != 'undefined') {\n            clearTimeout(delayedActions[id]);\n            numberDelayed--;\n        }\n        numberDelayed++;\n        delayedActions[id] = setTimeout(function() {\n            numberDelayed--;\n            func(arg1, arg2);\n            delete delayedActions[id];\n        }, timeout);\n    };\n    VPLUtil.delay = function(id, func, arg1, arg2) {\n        internalDelay(shortTimeout, id, func, arg1, arg2);\n    };\n    VPLUtil.longDelay = function(id, func, arg1, arg2) {\n        internalDelay(longTimeout, id, func, arg1, arg2);\n    };\n    var setAfterTimeout = function(id, func, arg1, arg2) {\n        if (typeof afterAllActions[id] != 'undefined') {\n            clearTimeout(afterAllActions[id]);\n        }\n        afterAllActions[id] = setTimeout(function() {\n                if (numberDelayed > 0) {\n                    afterAllActions[id] = setAfterTimeout(id, func, arg1, arg2);\n                } else {\n                        func(arg1, arg2);\n                        delete afterAllActions[id];\n                }\n            }, longTimeout);\n    };\n    VPLUtil.afterAll = function(id, func, arg1, arg2) {\n        setAfterTimeout(id, func, arg1, arg2);\n    };\n})();\nVPLUtil.supportWebSocket = function() {\n    if (\"WebSocket\" in window) {\n        return true;\n    }\n    return false;\n};\nVPLUtil.isAndroid = function() {\n    return window.navigator.userAgent.indexOf('Android') > -1;\n};\nVPLUtil.isFirefox = function() {\n    return window.navigator.userAgent.indexOf('Firefox') > -1;\n};\nVPLUtil.isMac = function() {\n    return window.navigator.userAgent.indexOf('Mac') > -1;\n};\n(function() {\n    var lastProccessID = -1;\n    VPLUtil.setProcessId = function(id) {\n        lastProccessID = id;\n    };\n    VPLUtil.getProcessId = function() {\n        return lastProccessID;\n    };\n})();\n\n/**\n * Run a command in a execution server with input/output using a WebSocket\n * @param {string} URL to VPL editor services in Moodle server\n * @param {string} command Command to run in execution server\n * @param {array.<{name: string, contents: string, encoding: number}>} files\n *         array of objects name, contents and encoding 0 => UTF-8, 1 => Base64\n * @returns {object} deferred.\n *         Use done() to set handler to receive the WebSocket. Use fail to set error handler.\n */\nVPLUtil.directRun = function(URL, command, files) {\n    var deferred = $.Deferred();\n    $.ajax({\n        async: true,\n        type: \"POST\",\n        url: URL + 'directrun',\n        'data': JSON.stringify({\"command\": command, \"files\": files}),\n        contentType: \"application/json; charset=utf-8\",\n        dataType: \"json\"\n    }).done(function(result) {\n        if (!result.success) {\n            deferred.reject(result.error);\n        } else {\n            var response = result.response;\n            VPLUtil.setProtocol(response);\n            var ws = new WebSocket(response.executionURL);\n            log.debug('Conecting with:' + response.executionURL);\n            deferred.resolve({processid: response.processid, homepath: response.homepath, connection: ws});\n        }\n    }).fail(function(jqXHR, textStatus, errorThrown) {\n        var message = 'Connection fail' + ': ' + textStatus;\n        if (errorThrown.message != undefined) {\n            message += ': ' + errorThrown.message;\n        }\n        log.debug(message);\n        deferred.reject(message);\n    });\n    return deferred;\n};\n/**\n * Function to experiment with Direct run.\n * Limits: one data send and 10 messages received and 10 minutes connected\n * @param {string} URL to server\n * @param {string} command Command to prepare direct run. Execution of command must generate vpl_execution\n * @param {object} data to send to server\n */\n    VPLUtil.directRunTest = function(URL, command, data) {\n    var files = [{name: 'a.c', contents: 'int main(){return 0;}', encoding: 0},\n                    {name: 'b.c', contents: 'int f(){return 1;}', encoding: 0}];\n    VPLUtil.directRun(URL, command, files)\n        .done(function(result) {\n            var mcount = 0;\n            result.connection.onopen = function() {\n                log.debug(\"Ws open \" + result.homepath + \" processid \" + result.processid);\n                if (data != undefined) {\n                    result.connection.send(data);\n                }\n                setTimeout(function() { //  Close test if open for more than 10 minutes.\n                    result.connection.close();\n                }, 60 * 10 * 1000);\n            };\n            result.connection.onmessage = function(event) {\n                log.debug(\"WS Message (\" + ++mcount + \"): \" + event.data);\n                if (mcount >= 10) {\n                    result.connection.close();\n                }\n            };\n            result.connection.onerror = function(event) {\n                log.debug(\"WS error: \" + event);\n            };\n            result.connection.onclose = function(event) {\n                log.debug(\"WS close: \" + event.code + \" \" + event.reason);\n            };\n        })\n        .fail(function(message) {\n            log.debug(\"Direct run fail. URL: \" + URL + \" command: \" + command + \" message: \" + message);\n        });\n};\nVPLUtil.processResult = function(text, filenames, sh, noFormat, addLinks, folding) {\n    if (typeof text == 'undefined' || text.replace(/^\\s+$/gm, '') == '') {\n        return '';\n    }\n    /**\n     * Adds escape to the text\n     * @param {string} t text to escape\n     * @returns {string} result\n     */\n    function escReg(t) {\n        return t.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/, \"\\\\$&\");\n    }\n    var regtitgra = /\\([-]?[\\d]+[.]?[\\d]*\\)\\s*$/;\n    var regtit = /^-/;\n    var regcas = /^\\s*>/;\n    var regError = new RegExp('\\\\[err\\\\]|error|' + escReg(VPLUtil.str('error')), 'i');\n    var regWarning = new RegExp('\\\\[warn\\\\]|warning|note|' + escReg(VPLUtil.str('warning')), 'i');\n    var regInformation = new RegExp('\\\\[info\\\\]|information', 'i');\n    var state = '';\n    var html = '';\n    var comment = '';\n    var case_ = '';\n    var lines = text.split(/\\r\\n|\\n|\\r/);\n    var regFiles = [];\n    var lastAnnotation = false;\n    var lastAnnotationFile = false;\n    var afterTitle = false;\n    /**\n     * Generate attribute href for the editor in sh\n     * @param {int} i Index of sh\n     * @return {string} href\n     */\n    function getHref(i) {\n        if (typeof sh[i].getTagId === 'undefined') {\n            return 'href=\"#\" ';\n        } else {\n            return 'href=\"#' + sh[i].getTagId() + '\" ';\n        }\n    }\n    (function() {\n        for (var i = 0; i < filenames.length; i++) {\n            var regf = escReg(filenames[i]);\n            // Filename:N, filename(N), filename N, filename line N, filename on line N.\n            // N=#|#:#|#,#.\n            var reg = \"(^| |/)\" + regf + \"( on line | line |:|\\\\()(\\\\d+)(:|,)?(\\\\d+)?(\\\\))?\";\n            regFiles[i] = new RegExp(reg, 'm');\n        }\n    })();\n    /**\n     * Generate the file links in the comments to point to the files and add annotations\n     * @param {string} line Line to modify\n     * @param {string} rawline Text to include in annotation\n     * @returns {string} The line modified\n     */\n    function genFileLinks(line, rawline) {\n        if (!addLinks) {\n            return line;\n        }\n        var used = false;\n        for (var i = 0; i < regFiles.length; i++) {\n            var reg = regFiles[i];\n            var match;\n            while ((match = reg.exec(line)) !== null) {\n                var anot = sh[i].getAnnotations();\n                // Annotation format {row:,column:,raw:,type:error,warning,info;text} .\n                lastAnnotationFile = i;\n                used = true;\n                var type;\n                if (line.search(regError) > -1) {\n                    type = 'error';\n                } else if (line.search(regWarning) > -1) {\n                    type = 'warning';\n                } else if (line.search(regInformation) > -1) {\n                    type = 'info';\n                } else {\n                    type = 'error';\n                }\n                lastAnnotation = {\n                    'row': (match[3] - 1),\n                    'column': match[5],\n                    'type': type,\n                    'text': rawline,\n                };\n                anot.push(lastAnnotation);\n                var fileName = filenames[i];\n                var href = getHref(i);\n                var lt = VPLUtil.sanitizeText(fileName);\n                var data = 'data-file=\"' + fileName + '\" data-line=\"' + match[3] + '\"';\n                line = line.replace(reg, '$1<a ' + href + ' class=\"vpl_fl\" ' + data + '>' + lt + '$2$3$4$5$6</a>');\n                sh[i].setAnnotations(anot);\n            }\n        }\n        if (!used && lastAnnotation) {\n            if (rawline !== '') {\n                lastAnnotation.text += \"\\n\" + rawline;\n                sh[lastAnnotationFile].setAnnotations(sh[lastAnnotationFile].getAnnotations());\n            } else {\n                lastAnnotation = false;\n            }\n        }\n        return line;\n    }\n    /**\n     * Generates HTML for title line\n     * @param {string} line The line to process\n     * @returns {string} Line in HTML format\n     */\n    function getTitle(line) {\n        lastAnnotation = false;\n        line = line.substring(1);\n        var end = regtitgra.exec(line);\n        if (end !== null) {\n            line = line.substring(0, line.length - end[0].length);\n        }\n        var html = '';\n        if (folding) {\n            html += '<a href=\"javascript:void(0)\" onclick=\"VPLUtil.showHideDiv(this)\">[+]</a>';\n        }\n        html += '<b class=\"ui-widget-header ui-corner-all\">' + VPLUtil.sanitizeText(line) + '</b><br>';\n        html = genFileLinks(html, line);\n        return html;\n    }\n    /**\n     * Returns comment that has been saved\n     * @returns {string}\n     */\n    function getComment() {\n        lastAnnotation = false;\n        var ret = comment;\n        comment = '';\n        return ret;\n    }\n    /**\n     * Adds a new comment in HTML\n     * @param {string} rawline  Comment to add\n     */\n    function addComment(rawline) {\n        var line = VPLUtil.sanitizeText(rawline);\n        comment += genFileLinks(line, rawline) + '<br>';\n    }\n    /**\n     * Adds a new case\n     * @param {*} rawline Text to add\n     */\n    function addCase(rawline) {\n        var line = VPLUtil.sanitizeText(rawline);\n        case_ += genFileLinks(line, rawline) + \"\\n\";\n    }\n    /**\n     * Returns cases saved in HTML\n     * @returns {string}\n     */\n    function getCase() {\n        lastAnnotation = false;\n        var ret = case_;\n        case_ = '';\n        return '<pre>' + ret + '</pre>';\n    }\n\n    for (var i = 0; i < lines.length; i++) {\n        var line = lines[i];\n        if (noFormat) {\n            html += genFileLinks(VPLUtil.sanitizeText(line), line) + \"\\n\";\n            continue;\n        }\n        var match = regcas.exec(line);\n        var regcasv = regcas.test(line);\n        if ((match !== null) != regcasv) {\n            VPLUtil.log('error');\n        }\n        if (regtit.test(line)) {\n            switch (state) {\n                case 'comment':\n                    html += getComment();\n                    break;\n                case 'case':\n                    html += getCase();\n                    break;\n            }\n            if (afterTitle) {\n                html += '</div>';\n            }\n            html += getTitle(line);\n            html += folding ? '<div style=\"display:none\">' : '<div>';\n            afterTitle = true;\n            state = '';\n        } else if (regcasv) {\n            if (state == 'comment') {\n                html += getComment();\n            }\n            addCase(line.substring(match[0].length));\n            state = 'case';\n        } else {\n            if (state == 'case') {\n                html += getCase();\n            }\n            addComment(line);\n            state = 'comment';\n        }\n    }\n    switch (state) {\n        case 'comment':\n            html += getComment();\n            break;\n        case 'case':\n            html += getCase();\n            break;\n    }\n    if (afterTitle) {\n        html += '</div>';\n    }\n    return html;\n};\n(function() {\n    var scriptsLoaded = [];\n    VPLUtil.loadScript = function(scripts, end) {\n        if (scripts.length == 0) {\n            end();\n            return;\n        }\n        var scriptURL = scripts[0];\n        if (typeof scriptsLoaded[scriptURL] == 'undefined') {\n            scripts.shift();\n            scriptsLoaded[scriptURL] = 1;\n            var script = document.createElement('script');\n            script.type = 'text/javascript';\n            script.src = VPLUtil.options.scriptPath + scriptURL;\n            script.onload = function() {\n                scriptsLoaded[scriptURL] = 2;\n                VPLUtil.loadScript(scripts, end);\n            };\n            document.head.appendChild(script);\n        } else if (scriptsLoaded[scriptURL] == 2) {\n            scripts.shift();\n            VPLUtil.loadScript(scripts, end);\n        } else {\n            var fullScriptPath = VPLUtil.options.scriptPath + scriptURL;\n            VPLUtil.log('Loading js ' + fullScriptPath + ' (state ' + scriptsLoaded[scriptURL] + ')');\n            setTimeout(function() {\n                            VPLUtil.loadScript(scripts, end);\n                        }, 50);\n        }\n    };\n    VPLUtil.isScriptLoading = function(scriptURL) {\n        if (typeof scriptsLoaded[scriptURL] == 'undefined') {\n            return false;\n        }\n        return scriptsLoaded[scriptURL] == 1;\n    };\n    VPLUtil.isScriptLoaded = function(scriptURL) {\n        if (typeof scriptsLoaded[scriptURL] == 'undefined') {\n            return false;\n        }\n        return scriptsLoaded[scriptURL] == 2;\n    };\n})();\n\nVPLUtil.loadModule = function(module, variable) {\n    return new Promise(function(resolve, reject) {\n        if (typeof window[variable] !== 'undefined') {\n            VPLUtil.log('Module ' + module + ' already loaded');\n            resolve(window[variable]);\n            return;\n        }\n        var ntimedout = 0;\n        const timeoutInterval = 250;\n        const maxTimeouts = 10 * 4; // 10 seconds\n        var resolved = false;\n        var moduleURL = url.relativeUrl('/mod/vpl/thirdpartylibs/' + module + '.js');\n        var code = 'window.' + variable + ' = (await import(\\'' + moduleURL + '\\')).default;';\n        var script = document.createElement('script');\n        script.type = 'module';\n        script.onload = () => {\n            VPLUtil.log('Module ' + module + ' loaded');\n            if (!resolved) {\n                resolved = true;\n                resolve(window[variable]);\n            }\n        };\n        script.onerror = () => {\n            VPLUtil.log('Module ' + module + ' failed to load');\n            if (!resolved) {\n                resolved = true;\n                reject();\n            }\n        };\n        script.innerHTML = code;\n        document.head.appendChild(script);\n        /**\n         * Check if the module is loaded\n         */\n        function checkLoaded() {\n            if (resolved) {\n                return;\n            }\n            if (typeof window[variable] !== 'undefined') {\n                VPLUtil.log('Module ' + module + ' loaded after check ' + ntimedout * timeoutInterval + 'ms');\n                resolved = true;\n                resolve(window[variable]);\n            } else if (ntimedout < maxTimeouts) {\n                ntimedout++;\n                setTimeout(checkLoaded, timeoutInterval);\n            } else {\n                VPLUtil.log('Module ' + module + ' not loaded after check ' + ntimedout * timeoutInterval + 'ms');\n                resolved = true;\n                reject();\n            }\n        }\n        setTimeout(checkLoaded, timeoutInterval);\n    });\n};\n\n(function() {\n    var files = [];\n    var results = [];\n    var shs = [];\n    var nFileGroupHighlighter = 0;\n    /**\n     * Constructor for submission highlighter\n     * @param {Array} files Files to show highlighted\n     * @param {Array} results Output\n     */\n    function FileGroupHighlighter(files, results) {\n        this.files = files;\n        this.results = results;\n        this.shFiles = [];\n        this.shFileNames = [];\n        this.fileGroupId = nFileGroupHighlighter;\n        nFileGroupHighlighter++;\n        this.highlight();\n    }\n\n    FileGroupHighlighter.prototype.highlightBlockly = function(preid) {\n        VPLUtil.loadScript(['/blockly/blockly_compressed.js',\n            '/blockly/msg/js/en.js',\n            '/blockly/blocks_compressed.js']\n        , function() {\n            var tag = $('#' + preid);\n            var c = tag.html();\n            $('#' + preid + 'load').remove();\n            tag.html('');\n            tag.show();\n            c = $('<div />').html(c).text().replace(/\\n/g, \"\");\n            var xml = Blockly.Xml.textToDom(c);\n            tag.html('').height(300).width(tag.parent().width());\n            var options = {\n                toolbox: '',\n                readOnly: true,\n                media: '../editor/blockly/media/',\n            };\n            var work = Blockly.inject(preid, options);\n            Blockly.Xml.domToWorkspace(xml, work);\n            var hg = VPLUtil.adjustBlockly(work, 10, 10);\n            tag.height(hg);\n            tag.width('100%');\n            Blockly.svgResize(work);\n            Blockly.resizeSvgContents(work);\n            var h = tag.html();\n            work.dispose();\n            tag.html(h);\n        });\n    };\n\n    FileGroupHighlighter.prototype.highlight = function() {\n        var self = this;\n        var needAce = false;\n        var files = this.files;\n        for (let i = 0; i < files.length; i++) {\n            let file = files[i];\n            if (VPLUtil.isBinary(file.fileName) || VPLUtil.isBlockly(file.fileName)) {\n                continue;\n            } else {\n                needAce = true;\n                break;\n            }\n        }\n        if (needAce && typeof ace === 'undefined') {\n            VPLUtil.loadScript(['/../../thirdpartylibs/ace/ace.js'],\n                function() {\n                    self.highlight();\n                });\n            return;\n        }\n        VPLUtil.delay(\"FFGH.\" + self.fileGroupId, function() {\n            self.highlightStep(0);\n        });\n    };\n\n    FileGroupHighlighter.prototype.highlightStep = function(pos) {\n        if (pos >= this.files.length) {\n            this.resultStep(0);\n            return;\n        }\n        let file = this.files[pos];\n        let preid = 'code' + file.tagId;\n        if (VPLUtil.isBlockly(file.fileName)) {\n            this.highlightBlockly(preid);\n        } else {\n            var lang = VPLUtil.langType(file.fileName);\n            $('#' + preid).show();\n            $('#' + preid + 'load').remove();\n            var sh = ace.edit(preid);\n            sh.setTheme('ace/theme/' + file.theme);\n            sh.getSession().setMode('ace/mode/' + lang);\n            sh.renderer.setShowGutter(file.showln);\n            sh.setReadOnly(true);\n            sh.setHighlightActiveLine(false);\n            sh.setAutoScrollEditorIntoView(true);\n            sh.setOption('maxLines', file.nl);\n            sh.getAnnotations = function() {\n                return this.getSession().getAnnotations();\n            };\n            sh.cleanAnnotations = function(annotations) {\n                // Prevent more than 5 annotations for line.\n                const MAX_ANNOTATIONS_PER_LINE = 5;\n                var counts = {};\n                var res = [];\n                for (var i = 0; i < annotations.length; i++) {\n                    var annot = annotations[i];\n                    if (typeof counts[annot.row] == 'undefined') {\n                        counts[annot.row] = 0;\n                    }\n                    if (counts[annot.row] < MAX_ANNOTATIONS_PER_LINE) {\n                        res.push(annot);\n                    }\n                    counts[annot.row]++;\n                }\n                return res;\n            };\n            sh.setAnnotations = function(a) {\n                return this.getSession().setAnnotations(this.cleanAnnotations(a));\n            };\n            sh.getTagId = function() {\n                return this.vplTagId;\n            };\n            sh.vplTagId = file.tagId;\n            this.shFiles.push(sh);\n            this.shFileNames.push(file.fileName);\n            shs[file.tagId] = sh;\n        }\n        var self = this;\n        VPLUtil.delay(preid + \".next\", function() {\n            self.highlightStep(pos + 1);\n        });\n    };\n\n    FileGroupHighlighter.prototype.resultStep = function(pos) {\n        if (pos >= this.results.length) {\n            return;\n        }\n        var self = this;\n        var result = this.results[pos];\n        var tag = document.getElementById(result.tagId);\n        var text = tag.textContent || tag.innerText;\n        tag.innerHTML = VPLUtil.processResult(text, this.shFileNames, this.shFiles,\n            result.noFormat, result.addLinks, result.folding);\n        VPLUtil.delay(result.tagId + \".next\", function() {\n            self.resultStep(pos + 1);\n        });\n    };\n\n    VPLUtil.addResults = function(tagId, noFormat, addLinks, folding) {\n        results.push({'tagId': tagId, 'noFormat': noFormat, 'addLinks': addLinks, 'folding': folding});\n    };\n    VPLUtil.syntaxHighlightFile = function(tagId, fileName, theme, showln, nl) {\n        files.push({\n            'tagId': tagId,\n            'fileName': fileName,\n            'theme': theme,\n            'showln': showln,\n            'nl': nl\n            });\n    };\n    VPLUtil.syntaxHighlight = function() {\n        var groupFiles = files;\n        var groupResults = results;\n        files = [];\n        results = [];\n        new FileGroupHighlighter(groupFiles, groupResults);\n    };\n    VPLUtil.flEventHandler = function(event) {\n        var tag = event.target.getAttribute('href').substring(1);\n        var line = event.target.getAttribute('data-line');\n        var sh = shs[tag];\n        sh.gotoLine(line, 0);\n        sh.scrollToLine(line, true);\n    };\n    VPLUtil.setflEventHandler = function() {\n        var links = document.getElementsByClassName(\"vpl_fl\");\n        for (var i = 0; i < links.length; i++) {\n            links[i].onclick = VPLUtil.flEventHandler;\n        }\n    };\n    VPLUtil.showHideDiv = function(a) {\n        var text = a;\n        var div = a;\n        if (!div.nextSibling) {\n            div = div.parentNode;\n        }\n        div = div.nextSibling;\n        while (div.nodeName != 'DIV' && div.nodeName != 'PRE') {\n            div = div.nextSibling;\n            if (!div) {\n                return;\n            }\n        }\n        if (text) {\n            if (text.innerHTML == '[+]') {\n                if (div.savedDisplay) {\n                    div.style.display = div.savedDisplay;\n                } else {\n                    div.style.display = '';\n                }\n                text.innerHTML = '[-]';\n            } else {\n                div.savedDisplay = div.style.display;\n                div.style.display = 'none';\n                text.innerHTML = '[+]';\n            }\n        }\n    };\n    VPLUtil.adjustBlockly = function(work, offx, offy) {\n        var blocks = work.getAllBlocks();\n        var miy = 20000;\n        var may = -20000;\n        var mix = 20000;\n        var max = -20000;\n        for (var i = 0; i < blocks.length; i++) {\n            var xy = blocks[i].getRelativeToSurfaceXY();\n            miy = Math.min(miy, xy.y);\n            may = Math.max(may, xy.y);\n            mix = Math.min(mix, xy.x);\n            max = Math.max(max, xy.x);\n        }\n        blocks = work.getTopBlocks();\n        for (var j = 0; j < blocks.length; j++) {\n            blocks[j].moveBy(offx - mix, offy - miy);\n        }\n        return may - miy + 100 + offy;\n    };\n})();\nVPLUtil.options = {\n    scriptPath: ''\n};\nif (typeof window.VPLDebugMode != 'undefined') {\n    debugMode = window.VPLDebugMode;\n}\nVPLUtil.init = function(options) {\n    VPLUtil.options = {\n        scriptPath: ''\n    };\n    $.extend(VPLUtil.options, options);\n    if (typeof window.VPLDebugMode != 'undefined') {\n        debugMode = window.VPLDebugMode;\n    }\n    VPLUtil.log(VPLUtil.options);\n};\n\nself.VPLUtil = VPLUtil;\nexport const init = VPLUtil.init;\nexport const addResults = VPLUtil.addResults;\nexport const syntaxHighlightFile = VPLUtil.syntaxHighlightFile;\nexport const syntaxHighlight = VPLUtil.syntaxHighlight;\n"],"names":["VPLUtil","doNothing","$","noop","returnFalse","returnTrue","fileUniqueId","MIME","maplang","mapname","i18n","strreg","lastProccessID","scriptsLoaded","debugMode","log","m","forced","debug","setUserPreferences","pref","ajax","async","type","url","relativeUrl","JSON","stringify","contentType","dataType","getUserPreferences","func","getPreferences","done","sanitizeHTML","t","replace","html","sanitizeText","s","setProtocol","coninfo","secure","securePort","port","wsProtocol","window","location","protocol","URLBase","server","portToUse","monitorURL","monitorPath","executionURL","executionPath","ArrayBuffer2String","data","i","len","view","Uint8Array","chunks","length","push","String","fromCharCode","apply","subarray","Math","min","join","String2ArrayBuffer","ret","ArrayBuffer","u8","charCodeAt","getUniqueId","regExt","regImg","regAudio","regVideo","regBin","regBlk","fileExtension","fileName","res","exec","isImage","test","isAudio","isVideo","isBinary","fileContents","textBytes","concat","Array","keys","map","Object","entries","reduce","obj","key","value","bytes","TextEncoder","encode","substring","sizechecked","hasOwnProperty","isBlockly","regInvalidFileName","validFileName","getCurrentTime","parseInt","Date","valueOf","validPath","path","dirs","split","getFileName","dataFromURLData","indexOf","getMIME","ext","getTimeLeft","timeLeft","timePending","days","hours","minutes","seconds","slice","getLangNames","assign","langType","filenamepath","extfile","langName","useHardTabs","str","parm","setStr","newi18n","VPLi18n","delayedActions","afterAllActions","numberDelayed","internalDelay","timeout","id","arg1","arg2","clearTimeout","setTimeout","delay","longDelay","setAfterTimeout","afterAll","supportWebSocket","isAndroid","navigator","userAgent","isFirefox","isMac","setProcessId","getProcessId","directRun","URL","command","files","deferred","Deferred","result","success","response","ws","WebSocket","resolve","processid","homepath","connection","reject","error","fail","jqXHR","textStatus","errorThrown","message","undefined","directRunTest","name","contents","encoding","mcount","onopen","send","close","onmessage","event","onerror","onclose","code","reason","processResult","text","filenames","sh","noFormat","addLinks","folding","escReg","regtitgra","regtit","regcas","regError","RegExp","regWarning","regInformation","state","comment","case_","lines","regFiles","lastAnnotation","lastAnnotationFile","afterTitle","getHref","getTagId","genFileLinks","line","rawline","used","match","reg","anot","getAnnotations","search","href","lt","setAnnotations","getTitle","end","getComment","addComment","addCase","getCase","regcasv","loadScript","scripts","scriptURL","shift","script","document","createElement","src","options","scriptPath","onload","head","appendChild","fullScriptPath","isScriptLoading","isScriptLoaded","loadModule","module","variable","Promise","ntimedout","resolved","moduleURL","innerHTML","checkLoaded","results","shs","nFileGroupHighlighter","FileGroupHighlighter","shFiles","shFileNames","fileGroupId","highlight","prototype","highlightBlockly","preid","tag","c","remove","show","xml","Blockly","Xml","textToDom","height","width","parent","work","inject","toolbox","readOnly","media","domToWorkspace","hg","adjustBlockly","svgResize","resizeSvgContents","h","dispose","self","this","needAce","file","ace","highlightStep","pos","resultStep","tagId","lang","edit","setTheme","theme","getSession","setMode","renderer","setShowGutter","showln","setReadOnly","setHighlightActiveLine","setAutoScrollEditorIntoView","setOption","nl","cleanAnnotations","annotations","counts","annot","row","a","vplTagId","getElementById","textContent","innerText","addResults","syntaxHighlightFile","syntaxHighlight","groupFiles","groupResults","flEventHandler","target","getAttribute","gotoLine","scrollToLine","setflEventHandler","links","getElementsByClassName","onclick","showHideDiv","div","nextSibling","parentNode","nodeName","savedDisplay","style","display","offx","offy","blocks","getAllBlocks","miy","may","mix","max","xy","getRelativeToSurfaceXY","y","x","getTopBlocks","j","moveBy","VPLDebugMode","init","extend"],"mappings":"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YAfV,IAgBbA,aAhBa,GAgBEG,YACXC,QAAUlB,SAASc,oBACvB3C,MAAQ,KAAO6C,OAAOG,OAAO,GAAK,IAClChD,MAAQ,KAAO8C,SAASE,OAAO,GAC3BN,SAnBO,OAoBP1C,KAAO,KAAO,KAAO+C,SAASC,OAAO,IAElChD,KAIP9E,QAAU,MACF,WACD,UACA,mBACS,8BACA,oBACR,WACC,cACJ,cACE,oBACM,cACJ,qBACO,iBACL,eACL,sBACQ,UACP,QACF,SACG,cACE,gBACA,cACJ,sBACQ,cACH,aACL,gBACI,aACH,cACI,eACH,YACA,YACA,aACC,mBACK,kBACN,WACD,UACA,YACE,eACC,kBACE,kBACF,kBACE,iBACH,aACD,YACA,WACD,aACG,cACF,WACD,mBACO,oBACJ,gBACA,gBACA,WACL,qBACe,WACZ,YACA,YACA,aACC,eACC,cACF,oBACM,WACL,YACF,UACA,UACA,UACA,iBACO,kBACN,gBACI,mBACD,sBACI,iCACQ,WACf,WACD,WACC,QAERC,QAAU,MACF,WACD,UACA,UAAc,UAAc,SAC7B,mBAAuB,mBACtB,oBACC,WACD,UACF,MAAU,SAAa,UAAc,YAAc,UACjD,QAAY,MAAU,YACpB,gBACF,YAAgB,eACb,mBACH,aACD,YACI,iBACH,QACF,SACG,SACH,aACE,aAAiB,WACnB,cAAkB,cAAkB,cAAkB,aACrD,YACI,gBACJ,YACI,YACJ,SACA,cACC,YAAgB,UACjB,YACE,UACF,WACA,kBACE,WACD,UACA,SACD,aAAiB,WAClB,YACC,cACA,YAAgB,cACb,aACD,YACA,WAAe,WAChB,UACA,WAAe,cACd,WAAe,WAChB,UACA,YAAgB,aAChB,YACD,WACD,MAAU,OACT,YAAgB,UAChB,WACC,qBACF,oBACG,aACC,YACF,cACC,UACF,mBACG,YACF,UACA,UACA,UACA,SACD,kBACE,UACF,qBACI,0BACH,cACF,aAAiB,cACf,YAAgB,WAChB,WACC,mBAEK,uBACA,YAOjBT,QAAQuI,aAAe,kBACZpC,OAAOqC,OAAO,GAAI/H,UAS7BT,QAAQyI,SAAW,SAA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"}