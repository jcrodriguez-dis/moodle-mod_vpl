{"version":3,"file":"vplutil.min.js","sources":["../src/vplutil.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Tools for the VPL IDE\n *\n * @copyright 2016 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\n/* globals Blockly */\n/* globals ace */\n\ndefine(\n    [\n        'jquery',\n        'core/log',\n        'core/url'\n    ],\n    function($, log, url) {\n        var VPLUtil = {};\n        VPLUtil.doNothing = $.noop;\n        VPLUtil.returnFalse = function() {\n            return false;\n        };\n        VPLUtil.returnTrue = function() {\n            return true;\n        };\n        var debugMode = false;\n        VPLUtil.log = function(m, forced) {\n            if (debugMode || forced) {\n                log.debug(m);\n            }\n        };\n        VPLUtil.setUserPreferences = function(pref) {\n            $.ajax({\n                async: true,\n                type: \"POST\",\n                url: url.relativeUrl('/mod/vpl/editor/userpreferences.json.php'),\n                'data': JSON.stringify(pref),\n                contentType: \"application/json; charset=utf-8\",\n                dataType: \"json\"\n            });\n        };\n        VPLUtil.getUserPreferences = function(func) {\n            $.ajax({\n                async: true,\n                type: \"POST\",\n                url: url.relativeUrl('/mod/vpl/editor/userpreferences.json.php'),\n                'data': JSON.stringify({getPreferences: true}),\n                contentType: \"application/json; charset=utf-8\",\n                dataType: \"json\"\n            }).done(func);\n        };\n        VPLUtil.sanitizeHTML = function(t) {\n            if (typeof t == 'undefined' || t.replace(/^\\s+$/g, '') == '') {\n                return '';\n            }\n            return $('<div>' + t + '</div>').html();\n        };\n        VPLUtil.sanitizeText = function(s) {\n            if (typeof s == 'undefined' || s.replace(/^\\s+$/g, '') == '') {\n                return '';\n            }\n            return s.replace(/&/g, \"&amp;\")\n                    .replace(/</g, \"&lt;\")\n                    .replace(/>/g, \"&gt;\")\n                    .replace(/\"/g, \"&quot;\")\n                    .replace(/'/g, \"&#39;\");\n        };\n\n        VPLUtil.setProtocol = function(coninfo) {\n            var secure;\n            if (coninfo.securePort == 0 || coninfo.port == 0) {\n                secure = coninfo.port == 0;\n            } else {\n                switch (coninfo.wsProtocol) {\n                    case 'always_use_wss':\n                        secure = true;\n                        break;\n                    case 'always_use_ws':\n                        secure = false;\n                        break;\n                    default:\n                        secure = window.location.protocol == 'https:';\n                }\n            }\n            var URLBase = (secure ? 'wss://' : 'ws://') + coninfo.server;\n            coninfo.secure = secure;\n            coninfo.portToUse = secure ? coninfo.securePort : coninfo.port;\n            URLBase += ':' + coninfo.portToUse + '/';\n            coninfo.monitorURL = URLBase + coninfo.monitorPath;\n            coninfo.executionURL = URLBase + coninfo.executionPath;\n        };\n        VPLUtil.ArrayBuffer2String = function(data) {\n            var view = new Uint8Array(data);\n            var chunks = [];\n            var chunkSize = 32000;\n            var i, len;\n            for (i = 0, len = view.length; i < len; i += chunkSize) {\n                chunks.push(String.fromCharCode.apply(String, view.subarray(i, Math.min(i + chunkSize, len))));\n            }\n            return chunks.join('');\n        };\n        VPLUtil.String2ArrayBuffer = function(data) {\n            var len = data.length;\n            var ret = new ArrayBuffer(len);\n            var u8 = new Uint8Array(ret);\n            for (var i = 0; i < len; i++) {\n                u8[i] = data.charCodeAt(i);\n            }\n            return ret;\n        };\n\n        (function() {\n            var fileUniqueId = 0;\n            VPLUtil.getUniqueId = function() {\n                return fileUniqueId++;\n            };\n        })();\n        (function() {\n            var regImg = /^(avif|bmp|gif|ico|jpe?g|png|svg|webp)$/i;\n            var regBin = /^(zip|jar|pdf|tar|bin|7z|arj|deb|gzip|rar|rpm|dat|db|dll|rtf|doc|docx|odt|exe|com)$/i;\n            var regBlk = /^blockly[0123]?$/;\n            VPLUtil.fileExtension = function(fileName) {\n                return fileName.split('.').pop();\n            };\n            VPLUtil.isImage = function(fileName) {\n                return regImg.test(VPLUtil.fileExtension(fileName));\n            };\n            VPLUtil.isBinary = function(fileName, fileContents) {\n                if (VPLUtil.isImage(fileName) || regBin.test(VPLUtil.fileExtension(fileName))) {\n                    return true;\n                }\n                if (typeof fileContents === 'undefined' || !fileContents) {\n                    return false;\n                }\n                var textBytes = [7, 8, 9, 10, 12, 13, 27]\n                                .concat([...Array(0x5f).keys()].map(i => i + 0x20)) // Include [0x20 -> 0x7e].\n                                .concat([...Array(0x80).keys()].map(i => i + 0x80)); // Include [0x80 -> 0xff].\n                textBytes = Object.entries(textBytes).reduce((obj, [key, value]) => ({...obj, [value]: key}), {});\n                var bytes = null;\n                if (fileContents instanceof Uint8Array) {\n                    bytes = fileContents;\n                } else if (fileContents instanceof ArrayBuffer) {\n                    bytes = new Uint8Array(fileContents);\n                } else if (fileContents instanceof String || typeof fileContents === 'string') {\n                    bytes = (new TextEncoder()).encode(fileContents.substring(0, 512));\n                } else {\n                    return false;\n                }\n                for (var i = 0; i < bytes.length; i++) {\n                    if (!textBytes.hasOwnProperty(bytes[i])) {\n                        // Byte is not a standard text byte, file is likely binary.\n                        return true;\n                    }\n                }\n                return false;\n            };\n            VPLUtil.isBlockly = function(fileName) {\n                return regBlk.test(VPLUtil.fileExtension(fileName));\n            };\n            var regInvalidFileName = /[\\cA-\\cZ]|[:-@]|[{-~]|\\\\|\\[|\\]|[/^`´]|^-|^ | $|\\.\\./;\n            VPLUtil.validFileName = function(fileName) {\n                if (fileName.length < 1) {\n                    return false;\n                }\n                if (fileName.length > 128) {\n                    return false;\n                }\n                return !(regInvalidFileName.test(fileName));\n            };\n        })();\n        VPLUtil.getCurrentTime = function() {\n            return parseInt((new Date()).valueOf() / 1000);\n        };\n\n        VPLUtil.validPath = function(path) {\n            if (path.length > 256) {\n                return false;\n            }\n            var dirs = path.split(\"/\");\n            for (var i = 0; i < dirs.length; i++) {\n                if (!VPLUtil.validFileName(dirs[i])) {\n                    return false;\n                }\n            }\n            return true;\n        };\n        VPLUtil.getFileName = function(path) {\n            var dirs = path.split(\"/\");\n            return dirs[dirs.length - 1];\n        };\n        VPLUtil.dataFromURLData = function(data) {\n            return data.substr(data.indexOf(',') + 1);\n        };\n\n        (function() {\n            var MIME = {\n                'gif': 'image/gif',\n                'jpg': 'image/jpeg',\n                'jpeg': 'image/jpeg',\n                'png': 'image/png',\n                'ico': 'image/x-icon',\n                'webp': 'image/webp',\n                'avif': 'image/avif',\n                'bmp': 'image/bmp',\n                'svg': 'image/svg+xml',\n                'pdf': 'application/pdf',\n            };\n            VPLUtil.getMIME = function(fileName) {\n                var ext = VPLUtil.fileExtension(fileName);\n                if (ext in MIME) {\n                    return MIME[ext];\n                }\n                return 'application/octet-stream';\n            };\n            VPLUtil.getTimeLeft = function(timeLeft) {\n                var res = '';\n                var minute = 60;\n                var hour = 60 * minute;\n                var day = 24 * hour;\n                if (timeLeft < 0) {\n                    res += '-';\n                    timeLeft = -timeLeft;\n                }\n                var timePending = timeLeft;\n                var days = parseInt(timePending / day);\n                timePending -= days * day;\n                if (days !== 0) {\n                    res += days + 'T';\n                }\n                var hours = parseInt(timePending / hour);\n                timePending -= hours * hour;\n                var minutes = parseInt(timePending / minute);\n                timePending -= minutes * minute;\n                var seconds = parseInt(timePending);\n                res += ('00' + hours).substr(-2) + ':';\n                res += ('00' + minutes).substr(-2);\n                if (timeLeft < hour) {\n                    res += ':' + ('00' + seconds).substr(-2);\n                }\n                return res;\n            };\n        })();\n        (function() {\n            var maplang = {\n                'Abap': 'abap',\n                'ABC': 'abc',\n                'Ada': 'ada',\n                'ActionScript': 'actionscript',\n                'x86 assembly': 'assembly_x86',\n                'Bash': 'sh',\n                'Batch': 'batchfile',\n                'C': 'c_cpp',\n                'C++': 'c_cpp',\n                'VPL cases': 'cases',\n                'Cobol': 'cobol',\n                'CoffeeScript': 'coffee',\n                'Clojure': 'clojure',\n                'C#': 'csharp',\n                'C# project': 'xml',\n                'CSS': 'css',\n                'D': 'd',\n                'Dart': 'dart',\n                'Eiffel': 'eiffel',\n                'Erlang': 'erlang',\n                'F#': 'fsharp',\n                'F# project': 'xml',\n                'Fortran': 'fortran',\n                'Go': 'golang',\n                'Groovy': 'groovy',\n                'Dot': 'dot',\n                'Haskell': 'haskell',\n                'HTML': 'html',\n                'Haxe': 'haxe',\n                'Java': 'java',\n                'Julia': 'julia',\n                'JavaScript': 'javascript',\n                'JSON': 'json',\n                'JSP': 'jsp',\n                'JSX': 'jsx',\n                'Kotlin': 'kotlin',\n                'Matlab': 'matlab',\n                'Markdown': 'markdown',\n                'Less': 'less',\n                'LISP': 'lisp',\n                'Lua': 'lua',\n                'Pascal': 'pascal',\n                'Perl': 'perl',\n                'PHP': 'php',\n                'Prolog': 'prolog',\n                'PSeInt': 'pseint',\n                'Python': 'python',\n                'R': 'r',\n                'Ruby': 'ruby',\n                'Rust': 'rust',\n                'SASS': 'sass',\n                'Scala': 'scala',\n                'Scheme': 'scheme',\n                'SCSS': 'scss',\n                'Bash/shell': 'sh',\n                'Swift': 'swift',\n                'SQL': 'sql',\n                'SVG': 'svg',\n                'TeX': 'tex',\n                'tcl': 'tcl',\n                'TypeScript': 'typescript',\n                'Twig': 'twig',\n                'VBScript': 'vbscript',\n                'Verilog': 'verilog',\n                'VisualBasic': 'vbscript',\n                'VisualBasic project': 'xml',\n                'VHDL': 'vhdl',\n                'XML': 'xml',\n                'Yaml': 'yaml'\n            };\n            var mapname = {\n                'abap': 'Abap',\n                'abc': 'ABC',\n                'ada': 'Ada', 'ads': 'Ada', 'adb': 'Ada',\n                'as': 'ActionScript', 'as3': 'ActionScript',\n                'asm': 'x86 assembly',\n                'bash': 'Bash',\n                'bat': 'Batch',\n                'c': 'C', 'C': 'C++', 'cc': 'C++', 'cpp': 'C++', 'c++': 'C++',\n                'hxx': 'C++', 'h': 'C', 'H': 'C++',\n                'cases': 'VPL cases',\n                'cbl': 'Cobol', 'cob': 'Cobol',\n                'coffee': 'CoffeeScript',\n                'clj': 'Clojure',\n                'cs': 'C#',\n                'csproj': 'C# project',\n                'css': 'CSS',\n                'd': 'D',\n                'dart': 'Dart',\n                'e': 'Eiffel',\n                'erl': 'Erlang', 'hrl': 'Erlang',\n                'f': 'Fortran', 'f77': 'Fortran', 'f90': 'Fortran', 'for': 'Fortran',\n                'fs': 'F#',\n                'fsproj': 'F# project',\n                'go': 'Go',\n                'groovy': 'Groovy',\n                'gv': 'Dot',\n                'hs': 'Haskell',\n                'htm': 'HTML', 'html': 'HTML',\n                'hx': 'Haxe',\n                'java': 'Java',\n                'jl': 'Julia',\n                'js': 'JavaScript',\n                'json': 'JSON',\n                'jsp': 'JSP',\n                'jsx': 'JSX',\n                'kt': 'Kotlin', 'kts': 'Kotlin',\n                'm': 'Matlab',\n                'md': 'Markdown',\n                'less': 'Less',\n                'lisp': 'LISP', 'lsp': 'LISP',\n                'lua': 'Lua',\n                'pas': 'Pascal', 'p': 'Pascal',\n                'perl': 'Perl', 'prl': 'Perl',\n                'php': 'PHP',\n                'pro': 'Prolog', 'pl': 'Prolog',\n                'psc': 'pseint',\n                'py': 'Python',\n                'R': 'R', 'r': 'R',\n                'rb': 'Ruby', 'ruby': 'Ruby',\n                'rs': 'Rust',\n                's': 'x86 assembly',\n                'sass': 'SASS',\n                'scala': 'Scala',\n                'scm': 'Scheme',\n                'scss': 'SCSS',\n                'sh': 'Bash/shell',\n                'swift': 'Swift',\n                'sql': 'SQL',\n                'svg': 'SVG',\n                'tex': 'TeX',\n                'tcl': 'TCL',\n                'ts': 'TypeScript',\n                'twig': 'Twig',\n                'vb': 'VisualBasic',\n                'vbproj': 'VisualBasic project',\n                'vbs': 'VBSscript',\n                'v': 'Verilog', 'vh': 'Verilog',\n                'vhd': 'VHDL', 'vhdl': 'VHDL',\n                'xml': 'XML',\n                'yaml': 'YAML'\n            };\n            VPLUtil.getLangNames = function() {\n                return Object.assign({}, mapname);\n            };\n            VPLUtil.langType = function(ext) {\n                if (ext in mapname) {\n                    return maplang[mapname[ext]];\n                }\n                return 'plain_text';\n            };\n            VPLUtil.langName = function(ext) {\n                if (ext in mapname) {\n                    return mapname[ext];\n                }\n                return 'Plain text';\n            };\n        })();\n        (function() {\n            var i18n = {};\n            var strreg = /\\{\\\\*\\$a\\\\*}/g;\n            VPLUtil.str = function(key, parm) {\n                if (!i18n[key]) {\n                    return '{' + key + '}';\n                }\n                if (typeof parm != 'undefined') {\n                    return i18n[key].replace(strreg, parm);\n                } else {\n                    return i18n[key];\n                }\n            };\n            VPLUtil.setStr = function(newi18n) {\n                for (var key in newi18n) {\n                    if (newi18n.hasOwnProperty(key)) {\n                        i18n[key] = newi18n[key];\n                    }\n                }\n            };\n            VPLUtil.setStr(window.VPLi18n);\n        })();\n        (function() {\n            var delayedActions = {};\n            var afterAllActions = {};\n            var shortTimeout = 20;\n            var longTimeout = 100;\n            var numberDelayed = 0;\n            var internalDelay = function(timeout, id, func, arg1, arg2) {\n                if (typeof delayedActions[id] != 'undefined') {\n                    clearTimeout(delayedActions[id]);\n                    numberDelayed--;\n                }\n                numberDelayed++;\n                delayedActions[id] = setTimeout(function() {\n                    numberDelayed--;\n                    func(arg1, arg2);\n                    delete delayedActions[id];\n                }, timeout);\n            };\n            VPLUtil.delay = function(id, func, arg1, arg2) {\n                internalDelay(shortTimeout, id, func, arg1, arg2);\n            };\n            VPLUtil.longDelay = function(id, func, arg1, arg2) {\n                internalDelay(longTimeout, id, func, arg1, arg2);\n            };\n            var setAfterTimeout = function(id, func, arg1, arg2) {\n                if (typeof afterAllActions[id] != 'undefined') {\n                    clearTimeout(afterAllActions[id]);\n                }\n                afterAllActions[id] = setTimeout(function() {\n                        if (numberDelayed > 0) {\n                            afterAllActions[id] = setAfterTimeout(id, func, arg1, arg2);\n                        } else {\n                             func(arg1, arg2);\n                             delete afterAllActions[id];\n                        }\n                    }, longTimeout);\n            };\n            VPLUtil.afterAll = function(id, func, arg1, arg2) {\n                setAfterTimeout(id, func, arg1, arg2);\n            };\n        })();\n        VPLUtil.supportWebSocket = function() {\n            if (\"WebSocket\" in window) {\n                return true;\n            }\n            return false;\n        };\n        VPLUtil.isAndroid = function() {\n            return window.navigator.userAgent.indexOf('Android') > -1;\n        };\n        VPLUtil.isFirefox = function() {\n            return window.navigator.userAgent.indexOf('Firefox') > -1;\n        };\n        VPLUtil.isMac = function() {\n            return window.navigator.userAgent.indexOf('Mac') > -1;\n        };\n        (function() {\n            var lastProccessID = -1;\n            VPLUtil.setProcessId = function(id) {\n                lastProccessID = id;\n            };\n            VPLUtil.getProcessId = function() {\n                return lastProccessID;\n            };\n        })();\n\n        /**\n         * Run a command in a execution server with input/output using a WebSocket\n         * @param {string} URL to VPL editor services in Moodle server\n         * @param {string} command Command to run in execution server\n         * @param {array.<{name: string, contents: string, encoding: number}>} files\n         *         array of objects name, contents and encoding 0 => UTF-8, 1 => Base64\n         * @returns {object} deferred.\n         *         Use done() to set handler to receive the WebSocket. Use fail to set error handler.\n         */\n        VPLUtil.directRun = function(URL, command, files) {\n            var deferred = $.Deferred();\n            $.ajax({\n                async: true,\n                type: \"POST\",\n                url: URL + 'directrun',\n                'data': JSON.stringify({\"command\": command, \"files\": files}),\n                contentType: \"application/json; charset=utf-8\",\n                dataType: \"json\"\n            }).done(function(result) {\n                if (!result.success) {\n                    deferred.reject(result.error);\n                } else {\n                    var response = result.response;\n                    VPLUtil.setProtocol(response);\n                    var ws = new WebSocket(response.executionURL);\n                    log.debug('Conecting with:' + response.executionURL);\n                    deferred.resolve({processid: response.processid, homepath: response.homepath, connection: ws});\n                }\n            }).fail(function(jqXHR, textStatus, errorThrown) {\n                var message = 'Connection fail' + ': ' + textStatus;\n                if (errorThrown.message != undefined) {\n                    message += ': ' + errorThrown.message;\n                }\n                log.debug(message);\n                deferred.reject(message);\n            });\n            return deferred;\n        };\n        /**\n         * Function to experiment with Direct run.\n         * Limits: one data send and 10 messages received and 10 minutes connected\n         * @param {string} URL to server\n         * @param {string} command Command to prepare direct run. Execution of command must generate vpl_execution\n         * @param {object} data to send to server\n         */\n         VPLUtil.directRunTest = function(URL, command, data) {\n            var files = [{name: 'a.c', contents: 'int main(){return 0;}', encoding: 0},\n                         {name: 'b.c', contents: 'int f(){return 1;}', encoding: 0}];\n            VPLUtil.directRun(URL, command, files)\n                .done(function(result) {\n                    var mcount = 0;\n                    result.connection.onopen = function() {\n                        log.debug(\"Ws open \" + result.homepath + \" processid \" + result.processid);\n                        if (data != undefined) {\n                            result.connection.send(data);\n                        }\n                        setTimeout(function() { //  Close test if open for more than 10 minutes.\n                            result.connection.close();\n                        }, 60 * 10 * 1000);\n                    };\n                    result.connection.onmessage = function(event) {\n                        log.debug(\"WS Message (\" + ++mcount + \"): \" + event.data);\n                        if (mcount >= 10) {\n                            result.connection.close();\n                        }\n                    };\n                    result.connection.onerror = function(event) {\n                        log.debug(\"WS error: \" + event);\n                    };\n                    result.connection.onclose = function(event) {\n                        log.debug(\"WS close: \" + event.code + \" \" + event.reason);\n                    };\n                })\n                .fail(function(message) {\n                    log.debug(\"Direct run fail. URL: \" + URL + \" command: \" + command + \" message: \" + message);\n                });\n        };\n        VPLUtil.processResult = function(text, filenames, sh, noFormat, folding) {\n            if (typeof text == 'undefined' || text.replace(/^\\s+$/gm, '') == '') {\n                return '';\n            }\n            /**\n             * Adds escape to the text\n             * @param {string} t text to escape\n             * @returns {string} result\n             */\n            function escReg(t) {\n                return t.replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/, \"\\\\$&\");\n            }\n            var regtitgra = /\\([-]?[\\d]+[.]?[\\d]*\\)\\s*$/;\n            var regtit = /^-.*/;\n            var regcas = /^\\s*>/;\n            // TODO adds error? use first anotation for icon.\n            var regError = new RegExp('\\\\[err\\\\]|error|' + escReg(VPLUtil.str('error')), 'i');\n            var regWarning = new RegExp('\\\\[warn\\\\]|warning|note|' + escReg(VPLUtil.str('warning')), 'i');\n            var regInformation = new RegExp('\\\\[info\\\\]|information', 'i');\n            var state = '';\n            var html = '';\n            var comment = '';\n            var case_ = '';\n            var lines = text.split(/\\r\\n|\\n|\\r/);\n            var regFiles = [];\n            var lastAnotation = false;\n            var lastAnotationFile = false;\n            var afterTitle = false;\n            /**\n             * Generate attribute href for the editor in sh\n             * @param {int} i Index of sh\n             * @return {string} href\n             */\n            function getHref(i) {\n                if (typeof sh[i].getTagId === 'undefined') {\n                    return 'href=\"#\" ';\n                } else {\n                    return 'href=\"#' + sh[i].getTagId() + '\" ';\n                }\n            }\n            (function() {\n                for (var i = 0; i < filenames.length; i++) {\n                    var regf = escReg(filenames[i]);\n                    // Filename:N, filename(N), filename N, filename line N, filename on line N.\n                    // N=#|#:#|#,#.\n                    var reg = \"(^| |/)\" + regf + \"( on line | line |:|\\\\()(\\\\d+)(:|,)?(\\\\d+)?(\\\\))?\";\n                    regFiles[i] = new RegExp(reg, 'm');\n                }\n            })();\n            /**\n             * Generate the file links in the comments to point to the files\n             * @param {string} line Line to modify\n             * @param {string} rawline Text to include in annotation\n             * @returns {string} The line modified\n             */\n            function genFileLinks(line, rawline) {\n                var used = false;\n                for (var i = 0; i < regFiles.length; i++) {\n                    var reg = regFiles[i];\n                    var match;\n                    while ((match = reg.exec(line)) !== null) {\n                        var anot = sh[i].getAnnotations();\n                        // Annotation format {row:,column:,raw:,type:error,warning,info;text} .\n                        lastAnotationFile = i;\n                        used = true;\n                        var type;\n                        if (line.search(regError) > -1) {\n                            type = 'error';\n                        } else if (line.search(regWarning) > -1) {\n                            type = 'warning';\n                        } else if (line.search(regInformation) > -1) {\n                            type = 'info';\n                        } else {\n                            type = 'error';\n                        }\n                        lastAnotation = {\n                            'row': (match[3] - 1),\n                            'column': match[5],\n                            'type': type,\n                            'text': rawline,\n                        };\n                        anot.push(lastAnotation);\n                        var fileName = filenames[i];\n                        var href = getHref(i);\n                        var lt = VPLUtil.sanitizeText(fileName);\n                        var data = 'data-file=\"' + fileName + '\" data-line=\"' + match[3] + '\"';\n                        line = line.replace(reg, '$1<a ' + href + ' class=\"vpl_fl\" ' + data + '>' + lt + '$2$3$4$5$6</a>');\n                        sh[i].setAnnotations(anot);\n                    }\n                }\n                if (!used && lastAnotation) {\n                    if (rawline !== '') {\n                        lastAnotation.text += \"\\n\" + rawline;\n                        sh[lastAnotationFile].setAnnotations(sh[lastAnotationFile].getAnnotations());\n                    } else {\n                        lastAnotation = false;\n                    }\n                }\n                return line;\n            }\n            /**\n             * Generates HTML for title line\n             * @param {string} line The line to process\n             * @returns {string} Line in HTML format\n             */\n            function getTitle(line) {\n                lastAnotation = false;\n                line = line.substr(1);\n                var end = regtitgra.exec(line);\n                if (end !== null) {\n                    line = line.substr(0, line.length - end[0].length);\n                }\n                var html = '';\n                if (folding) {\n                    html += '<a href=\"javascript:void(0)\" onclick=\"VPLUtil.showHideDiv(this)\">[+]</a>';\n                }\n                html += '<b class=\"ui-widget-header ui-corner-all\">' + VPLUtil.sanitizeText(line) + '</b><br>';\n                html = genFileLinks(html, line);\n                return html;\n            }\n            /**\n             * Returns comment that has been saved\n             * @returns {string}\n             */\n            function getComment() {\n                lastAnotation = false;\n                var ret = comment;\n                comment = '';\n                return ret;\n            }\n            /**\n             * Adds a new comment in HTML\n             * @param {string} rawline  Comment to add\n             */\n            function addComment(rawline) {\n                var line = VPLUtil.sanitizeText(rawline);\n                comment += genFileLinks(line, rawline) + '<br>';\n            }\n            /**\n             * Adds a new case\n             * @param {*} rawline Text to add\n             */\n            function addCase(rawline) {\n                var line = VPLUtil.sanitizeText(rawline);\n                case_ += genFileLinks(line, rawline) + \"\\n\";\n            }\n            /**\n             * Returns cases saved in HTML\n             * @returns {string}\n             */\n            function getCase() {\n                lastAnotation = false;\n                var ret = case_;\n                case_ = '';\n                return '<pre><i>' + ret + '</i></pre>';\n            }\n\n            for (var i = 0; i < lines.length; i++) {\n                var line = lines[i];\n                if (noFormat) {\n                    html += genFileLinks(VPLUtil.sanitizeText(line), line) + \"\\n\";\n                    continue;\n                }\n                var match = regcas.exec(line);\n                var regcasv = regcas.test(line);\n                if ((match !== null) != regcasv) {\n                    VPLUtil.log('error');\n                }\n                if (regtit.test(line)) {\n                    switch (state) {\n                        case 'comment':\n                            html += getComment();\n                            break;\n                        case 'case':\n                            html += getCase();\n                            break;\n                    }\n                    if (afterTitle) {\n                        html += '</div>';\n                    }\n                    html += getTitle(line);\n                    html += folding ? '<div style=\"display:none\">' : '<div>';\n                    afterTitle = true;\n                    state = '';\n                } else if (regcasv) {\n                    if (state == 'comment') {\n                        html += getComment();\n                    }\n                    addCase(line.substr(match[0].length));\n                    state = 'case';\n                } else {\n                    if (state == 'case') {\n                        html += getCase();\n                    }\n                    addComment(line);\n                    state = 'comment';\n                }\n            }\n            switch (state) {\n                case 'comment':\n                    html += getComment();\n                    break;\n                case 'case':\n                    html += getCase();\n                    break;\n            }\n            if (afterTitle) {\n                html += '</div>';\n            }\n            return html;\n        };\n        (function() {\n            var scriptsLoaded = [];\n            VPLUtil.loadScript = function(scripts, end) {\n                if (scripts.length == 0) {\n                    end();\n                    return;\n                }\n                var scriptURL = scripts[0];\n                if (typeof scriptsLoaded[scriptURL] == 'undefined') {\n                    scripts.shift();\n                    scriptsLoaded[scriptURL] = 1;\n                    var script = document.createElement('script');\n                    script.type = 'text/javascript';\n                    script.src = VPLUtil.options.scriptPath + scriptURL;\n                    script.onload = function() {\n                        scriptsLoaded[scriptURL] = 2;\n                        VPLUtil.loadScript(scripts, end);\n                    };\n                    document.head.appendChild(script);\n                } else if (scriptsLoaded[scriptURL] == 2) {\n                    scripts.shift();\n                    VPLUtil.loadScript(scripts, end);\n                } else {\n                    var fullScriptPath = VPLUtil.options.scriptPath + scriptURL;\n                    VPLUtil.log('Loading js ' + fullScriptPath + ' (state ' + scriptsLoaded[scriptURL] + ')');\n                    setTimeout(function() {\n                                  VPLUtil.loadScript(scripts, end);\n                               }, 50);\n                }\n            };\n            VPLUtil.isScriptLoading = function(scriptURL) {\n                if (typeof scriptsLoaded[scriptURL] == 'undefined') {\n                    return false;\n                }\n                return scriptsLoaded[scriptURL] == 1;\n            };\n            VPLUtil.isScriptLoaded = function(scriptURL) {\n                if (typeof scriptsLoaded[scriptURL] == 'undefined') {\n                    return false;\n                }\n                return scriptsLoaded[scriptURL] == 2;\n            };\n        })();\n        (function() {\n            var files = [];\n            var results = [];\n            var shs = [];\n            var nFileGroupHighlighter = 0;\n            /**\n             * Constructor for submission highlighter\n             * @param {Array} files Files to show highlighted\n             * @param {Array} results Output\n             */\n            function FileGroupHighlighter(files, results) {\n                this.files = files;\n                this.results = results;\n                this.shFiles = [];\n                this.shFileNames = [];\n                this.fileGroupId = nFileGroupHighlighter;\n                nFileGroupHighlighter++;\n                this.highlight();\n            }\n\n            FileGroupHighlighter.prototype.highlightBlockly = function(preid) {\n                VPLUtil.loadScript(['/blockly/blockly_compressed.js',\n                    '/blockly/msg/js/en.js',\n                    '/blockly/blocks_compressed.js']\n                , function() {\n                    var tag = $('#' + preid);\n                    var c = tag.html();\n                    $('#' + preid + 'load').remove();\n                    tag.html('');\n                    tag.show();\n                    c = $('<div />').html(c).text().replace(/\\n/g, \"\");\n                    var xml = Blockly.Xml.textToDom(c);\n                    tag.html('').height(300).width(tag.parent().width());\n                    var options = {\n                        toolbox: '',\n                        readOnly: true,\n                        media: '../editor/blockly/media/',\n                    };\n                    var work = Blockly.inject(preid, options);\n                    Blockly.Xml.domToWorkspace(xml, work);\n                    var hg = VPLUtil.adjustBlockly(work, 10, 10);\n                    tag.height(hg);\n                    tag.width('100%');\n                    Blockly.svgResize(work);\n                    Blockly.resizeSvgContents(work);\n                    var h = tag.html();\n                    work.dispose();\n                    tag.html(h);\n                });\n            };\n\n            FileGroupHighlighter.prototype.highlight = function() {\n                var self = this;\n                var needAce = false;\n                var files = this.files;\n                for (let i = 0; i < files.length; i++) {\n                    let file = files[i];\n                    if (VPLUtil.isBinary(file.fileName) || VPLUtil.isBlockly(file.fileName)) {\n                        continue;\n                    } else {\n                        needAce = true;\n                        break;\n                    }\n                }\n                if (needAce && typeof ace === 'undefined') {\n                    VPLUtil.loadScript(['/ace9/ace.js'],\n                        function() {\n                           self.highlight();\n                        });\n                    return;\n                }\n                VPLUtil.delay(\"FFGH.\" + self.fileGroupId, function() {\n                    self.highlightStep(0);\n                });\n            };\n\n            FileGroupHighlighter.prototype.highlightStep = function(pos) {\n                if (pos >= this.files.length) {\n                    this.resultStep(0);\n                    return;\n                }\n                let file = this.files[pos];\n                let preid = 'code' + file.tagId;\n                if (VPLUtil.isBlockly(file.fileName)) {\n                    this.highlightBlockly(preid);\n                } else {\n                    var ext = VPLUtil.fileExtension(file.fileName);\n                    var lang = VPLUtil.langType(ext);\n                    $('#' + preid).show();\n                    $('#' + preid + 'load').remove();\n                    var sh = ace.edit(preid);\n                    sh.setTheme('ace/theme/' + file.theme);\n                    sh.getSession().setMode('ace/mode/' + lang);\n                    sh.renderer.setShowGutter(file.showln);\n                    sh.setReadOnly(true);\n                    sh.setHighlightActiveLine(false);\n                    sh.setAutoScrollEditorIntoView(true);\n                    sh.setOption('maxLines', file.nl);\n                    sh.getAnnotations = function() {\n                        return this.getSession().getAnnotations();\n                    };\n                    sh.setAnnotations = function(a) {\n                        return this.getSession().setAnnotations(a);\n                    };\n                    sh.getTagId = function() {\n                        return this.vplTagId;\n                    };\n                    sh.vplTagId = file.tagId;\n                    this.shFiles.push(sh);\n                    this.shFileNames.push(file.fileName);\n                    shs[file.tagId] = sh;\n                }\n                var self = this;\n                VPLUtil.delay(preid + \".next\", function() {\n                    self.highlightStep(pos + 1);\n                });\n            };\n\n            FileGroupHighlighter.prototype.resultStep = function(pos) {\n                if (pos >= this.results.length) {\n                    return;\n                }\n                var self = this;\n                var result = this.results[pos];\n                var tag = document.getElementById(result.tagId);\n                var text = tag.textContent || tag.innerText;\n                tag.innerHTML = VPLUtil.processResult(text, this.shFileNames, this.shFiles,\n                    result.noFormat, result.folding);\n                VPLUtil.delay(result.tagId + \".next\", function() {\n                    self.resultStep(pos + 1);\n                });\n            };\n\n            VPLUtil.addResults = function(tagId, noFormat, folding) {\n                results.push({'tagId': tagId, 'noFormat': noFormat, 'folding': folding});\n            };\n            VPLUtil.syntaxHighlightFile = function(tagId, fileName, theme, showln, nl) {\n                files.push({\n                    'tagId': tagId,\n                    'fileName': fileName,\n                    'theme': theme,\n                    'showln': showln,\n                    'nl': nl\n                 });\n            };\n            VPLUtil.syntaxHighlight = function() {\n                var groupFiles = files;\n                var groupResults = results;\n                files = [];\n                results = [];\n                new FileGroupHighlighter(groupFiles, groupResults);\n            };\n            VPLUtil.flEventHandler = function(event) {\n                var tag = event.target.getAttribute('href').substring(1);\n                var line = event.target.getAttribute('data-line');\n                var sh = shs[tag];\n                sh.gotoLine(line, 0);\n                sh.scrollToLine(line, true);\n            };\n            VPLUtil.setflEventHandler = function() {\n                var links = document.getElementsByClassName(\"vpl_fl\");\n                for (var i = 0; i < links.length; i++) {\n                    links[i].onclick = VPLUtil.flEventHandler;\n                }\n            };\n            VPLUtil.showHideDiv = function(a) {\n                var text = a;\n                var div = a;\n                if (!div.nextSibling) {\n                    div = div.parentNode;\n                }\n                div = div.nextSibling;\n                while (div.nodeName != 'DIV' && div.nodeName != 'PRE') {\n                    div = div.nextSibling;\n                    if (!div) {\n                        return;\n                    }\n                }\n                if (text) {\n                    if (text.innerHTML == '[+]') {\n                        if (div.savedDisplay) {\n                            div.style.display = div.savedDisplay;\n                        } else {\n                            div.style.display = '';\n                        }\n                        text.innerHTML = '[-]';\n                    } else {\n                        div.savedDisplay = div.style.display;\n                        div.style.display = 'none';\n                        text.innerHTML = '[+]';\n                    }\n                }\n            };\n            VPLUtil.adjustBlockly = function(work, offx, offy) {\n                var blocks = work.getAllBlocks();\n                var miy = 20000;\n                var may = -20000;\n                var mix = 20000;\n                var max = -20000;\n                for (var i = 0; i < blocks.length; i++) {\n                    var xy = blocks[i].getRelativeToSurfaceXY();\n                    miy = Math.min(miy, xy.y);\n                    may = Math.max(may, xy.y);\n                    mix = Math.min(mix, xy.x);\n                    max = Math.max(max, xy.x);\n                }\n                blocks = work.getTopBlocks();\n                for (var j = 0; j < blocks.length; j++) {\n                    blocks[j].moveBy(offx - mix, offy - miy);\n                }\n                return may - miy + 100 + offy;\n            };\n        })();\n        VPLUtil.options = {\n            scriptPath: ''\n        };\n        if (typeof window.VPLDebugMode != 'undefined') {\n            debugMode = window.VPLDebugMode;\n        }\n        VPLUtil.init = function(options) {\n            VPLUtil.options = {\n                scriptPath: ''\n            };\n            $.extend(VPLUtil.options, options);\n            if (typeof window.VPLDebugMode != 'undefined') {\n                debugMode = window.VPLDebugMode;\n            }\n            VPLUtil.log(VPLUtil.options);\n        };\n        // Needs global use of VPLUtil for view source.\n        window.VPLUtil = VPLUtil;\n        return VPLUtil;\n    }\n);\n"],"names":["define","$","log","url","VPLUtil","doNothing","noop","returnFalse","returnTrue","fileUniqueId","MIME","maplang","mapname","i18n","strreg","lastProccessID","scriptsLoaded","debugMode","m","forced","debug","setUserPreferences","pref","ajax","async","type","relativeUrl","data","JSON","stringify","contentType","dataType","getUserPreferences","func","getPreferences","done","sanitizeHTML","t","replace","html","sanitizeText","s","setProtocol","coninfo","secure","securePort","port","wsProtocol","window","location","protocol","URLBase","server","portToUse","monitorURL","monitorPath","executionURL","executionPath","ArrayBuffer2String","i","len","view","Uint8Array","chunks","length","push","String","fromCharCode","apply","subarray","Math","min","join","String2ArrayBuffer","ret","ArrayBuffer","u8","charCodeAt","getUniqueId","regImg","regBin","regBlk","fileExtension","fileName","split","pop","isImage","test","isBinary","fileContents","textBytes","concat","Array","keys","map","Object","entries","reduce","obj","_ref","key","value","bytes","TextEncoder","encode","substring","hasOwnProperty","isBlockly","regInvalidFileName","validFileName","getCurrentTime","parseInt","Date","valueOf","validPath","path","dirs","getFileName","dataFromURLData","substr","indexOf","gif","jpg","jpeg","png","ico","webp","avif","bmp","svg","pdf","getMIME","ext","getTimeLeft","timeLeft","res","timePending","days","hours","minutes","seconds","Abap","ABC","Ada","ActionScript","Bash","Batch","C","Cobol","CoffeeScript","Clojure","CSS","D","Dart","Eiffel","Erlang","Fortran","Go","Groovy","Dot","Haskell","HTML","Haxe","Java","Julia","JavaScript","JSP","JSX","Kotlin","Matlab","Markdown","Less","LISP","Lua","Pascal","Perl","PHP","Prolog","PSeInt","Python","R","Ruby","Rust","SASS","Scala","Scheme","SCSS","Swift","SQL","SVG","TeX","tcl","TypeScript","Twig","VBScript","Verilog","VisualBasic","VHDL","XML","Yaml","abap","abc","ada","ads","adb","as","as3","asm","bash","bat","c","cc","cpp","hxx","h","H","cases","cbl","cob","coffee","clj","cs","csproj","css","d","dart","e","erl","hrl","f","f77","f90","for","fs","fsproj","go","groovy","gv","hs","htm","hx","java","jl","js","json","jsp","jsx","kt","kts","md","less","lisp","lsp","lua","pas","p","perl","prl","php","pro","pl","psc","py","r","rb","ruby","rs","sass","scala","scm","scss","sh","swift","sql","tex","ts","twig","vb","vbproj","vbs","v","vh","vhd","vhdl","xml","yaml","getLangNames","assign","langType","langName","str","parm","setStr","newi18n","VPLi18n","delayedActions","afterAllActions","numberDelayed","internalDelay","timeout","id","arg1","arg2","clearTimeout","setTimeout","delay","longDelay","setAfterTimeout","afterAll","supportWebSocket","isAndroid","navigator","userAgent","isFirefox","isMac","setProcessId","getProcessId","directRun","URL","command","files","deferred","Deferred","result","success","response","ws","WebSocket","resolve","processid","homepath","connection","reject","error","fail","jqXHR","textStatus","errorThrown","message","undefined","directRunTest","name","contents","encoding","mcount","onopen","send","close","onmessage","event","onerror","onclose","code","reason","processResult","text","filenames","noFormat","folding","escReg","regtitgra","regtit","regcas","regError","RegExp","regWarning","regInformation","state","comment","case_","lines","regFiles","lastAnotation","lastAnotationFile","afterTitle","getHref","getTagId","genFileLinks","line","rawline","used","match","reg","exec","anot","getAnnotations","search","row","column","href","lt","setAnnotations","getTitle","end","getComment","addComment","addCase","getCase","regcasv","loadScript","scripts","scriptURL","shift","script","document","createElement","src","options","scriptPath","onload","head","appendChild","fullScriptPath","isScriptLoading","isScriptLoaded","results","shs","nFileGroupHighlighter","FileGroupHighlighter","this","shFiles","shFileNames","fileGroupId","highlight","prototype","highlightBlockly","preid","tag","remove","show","Blockly","Xml","textToDom","height","width","parent","work","inject","toolbox","readOnly","media","domToWorkspace","hg","adjustBlockly","svgResize","resizeSvgContents","dispose","self","needAce","file","ace","highlightStep","pos","resultStep","tagId","lang","edit","setTheme","theme","getSession","setMode","renderer","setShowGutter","showln","setReadOnly","setHighlightActiveLine","setAutoScrollEditorIntoView","setOption","nl","a","vplTagId","getElementById","textContent","innerText","innerHTML","addResults","syntaxHighlightFile","syntaxHighlight","groupFiles","groupResults","flEventHandler","target","getAttribute","gotoLine","scrollToLine","setflEventHandler","links","getElementsByClassName","onclick","showHideDiv","div","nextSibling","parentNode","nodeName","savedDisplay","style","display","offx","offy","blocks","getAllBlocks","miy","may","mix","max","xy","getRelativeToSurfaceXY","y","x","getTopBlocks","j","moveBy","VPLDebugMode","init","extend"],"mappings":"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"}