define("mod_vpl/vplidecodefilemonaco",["exports","jquery","mod_vpl/vplutil","mod_vpl/vplui","core/log","core/url"],(function(_exports,_jquery,_vplutil,_vplui,_log,_url){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Code files extension method using ACE editorfiles. Add to VPLFile object.
   *
   * @copyright 2013 Juan Carlos Rodríguez-del-Pino
   * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.codeExtensionMonaco=void 0,_jquery=_interopRequireDefault(_jquery),_log=_interopRequireDefault(_log),_url=_interopRequireDefault(_url);_exports.codeExtensionMonaco=function(){var monaco=null,self=this,editor=null,opening=!1,readOnly=self.getFileManager().readOnly,getOldContent=this.getContent;this.getContent=function(){return this.isOpen()?editor.getValue():getOldContent.call(this)};var setOldContent=this.setContent;this.setContent=function(c){setOldContent.call(this,c),this.isOpen()&&editor.setValue(c)};var oldDestroy=this.destroy;this.destroy=function(){this.isOpen()&&editor.dispose(),oldDestroy.call(this)},this.setFontSize=function(size){this.isOpen()&&editor.updateOptions({fontSize:size})};var oldAdjustSize=this.adjustSize;this.adjustSize=function(){return!!oldAdjustSize.call(this)&&(editor.layout(),!0)},this.gotoLine=function(line){if(this.isOpen()){var position={lineNumber:line,column:1};editor.setPosition(position),editor.revealPositionInCenter(position),editor.focus(),this.updateStatus()}},this.setReadOnly=function(s){readOnly=s,this.isOpen()&&editor.updateOptions({readOnly:s})},this.isReadOnly=function(){return readOnly},this.focus=function(){if(this.isOpen()){var tid=this.getTId();(0,_jquery.default)(tid).removeClass("ui-widget-content ui-tabs-panel"),editor.focus(),this.updateStatus()}},this.blur=function(){this.isOpen()&&editor.blur()},this.undo=function(){this.isOpen()&&(editor.trigger("keyboard","undo",null),editor.focus())},this.redo=function(){this.isOpen()&&(editor.trigger("keyboard","redo",null),editor.focus())},this.selectAll=function(){this.isOpen()&&(editor.trigger("keyboard","editor.action.selectAll",null),editor.focus())},this.hasUndo=function(){if(!this.isOpen())return!1;var model=editor.getModel();return model.canUndo&&model.canUndo()},this.hasRedo=function(){if(!this.isOpen())return!1;var model=editor.getModel();return model.canRedo&&model.canRedo()},this.hasSelectAll=_vplutil.VPLUtil.returnTrue,this.hasFind=_vplutil.VPLUtil.returnTrue,this.hasFindReplace=_vplutil.VPLUtil.returnTrue,this.hasNext=_vplutil.VPLUtil.returnTrue,this.find=function(){if(this.isOpen()){var action=editor.getAction("actions.find");action&&action.run()}},this.replace=function(){this.isOpen()&&editor.getAction("editor.action.replaceOne").run()},this.next=function(){this.isOpen()&&editor.getAction("editor.action.nextMatchFindAction").run()},this.getAnnotations=function(){return[]},this.setAnnotations=function(a){if(!this.isOpen())return!1;for(var markers=[],i=0;i<a.length;i++){var ann=a[i],marker={};marker.severity=monaco.MarkerSeverity.Info,"error"===ann.type?marker.severity=monaco.MarkerSeverity.Error:"warning"===ann.type&&(marker.severity=monaco.MarkerSeverity.Warning),marker.startLineNumber=ann.row,marker.startColumn=ann.column,marker.endLineNumber=ann.row,marker.endColumn=ann.column+10,marker.message=ann.text,markers.push(marker)}return monaco.editor.setModelMarkers(editor.getModel(),"vpl-id",markers)},this.clearAnnotations=function(){return!!this.isOpen()&&monaco.editor.setModelMarkers(editor.getModel(),"vpl-id",[])},this.isLanguageLoaded=function(lang){if(null===monaco)return!1;for(var languages=monaco.languages.getLanguages(),i=0;i<languages.length;i++)if(languages[i].id===lang)return!0;return!1},this.registerLanguage=async function(lang){if(null===monaco)return!1;if(!this.isLanguageLoaded(lang)){const moduleName="monaco-editor/esm/vs/basic-languages/"+lang+"/"+lang+".contribution";return _vplutil.VPLUtil.loadModule(moduleName,"vpl_monaco_lang_"+lang,!1)}return!0},this.langSelection=function(){if(this.isOpen()){var filenamepath=this.getFileName(),lang=_vplutil.VPLUtil.langType(filenamepath),options={tabSize:4,insertSpaces:!_vplutil.VPLUtil.useHardTabs(filenamepath)};editor.updateOptions(options),"plain_text"==lang&&(lang="plaintext"),"c_cpp"==lang&&(lang="cpp"),this.registerLanguage(lang).then((()=>{var uri=monaco.Uri.parse("file:///"+filenamepath),model=monaco.editor.getModel(uri);model?(monaco.editor.setModelLanguage(model,lang),model.setValue(self.getContent())):model=monaco.editor.createModel(self.getContent(),lang,uri);var oldModel=editor.getModel();editor.setModel(model),oldModel&&oldModel!==model&&oldModel.dispose(),this.setLang(lang),editor.layout()})).catch((error=>{_log.default.error("Failed to load language "+lang+": "+error)}))}},this.getEditor=function(){return!!this.isOpen()&&editor},this.setTheme=function(theme){this.isOpen()&&monaco.editor.setTheme("vs"+(theme.includes("dark")?"-dark":""))},this.updateStatus=function(){if(this.isOpen()){var text="",pos=editor.getPosition(),fullname=this.getFileName(),name=_vplutil.VPLUtil.getFileName(fullname);(fullname.length>20||name!=fullname)&&(text=fullname+" "),text+="Ln "+pos.lineNumber+", Col "+pos.column,text+=" "+_vplutil.VPLUtil.langName(name),_vplui.VPLUI.showIDEStatus(text)}},this.open=function(){var idefile=this;return idefile.showFileName(),idefile.isOpen()?editor:opening?null:(opening=!0,this.getMonaco().then((function(monacoModule){opening=!1,monaco=monacoModule;var fileManager=idefile.getFileManager(),tid=idefile.getTId();(0,_jquery.default)(tid).removeClass("ui-widget-content ui-tabs-panel vpl_ide_file ui-corner-bottom"),editor=monaco.editor.create(document.getElementById("vpl_file"+idefile.getId()),{value:idefile.getContent(),language:_vplutil.VPLUtil.langType(idefile.getFileName()),fontSize:fileManager.getFontSize(),theme:"vs-"+fileManager.getTheme(),readOnly:readOnly}),idefile.setOpen(!0),idefile.langSelection(),editor.onDidChangeCursorPosition((function(){idefile.updateStatus()})),editor.onDidChangeModelContent((function(){idefile.isModified()||idefile.setModified(),idefile.updateStatus()}))})).catch((function(error){return opening=!1,_log.default.error("Failed to load Monaco:"+error),!1})),editor)},this.close=function(){this.setOpen(!1),null!==editor&&(this.setContent(editor.getValue()),editor.dispose(),editor=null)},this.getMonaco=async function(){return new Promise(((resolve,reject)=>{try{const base=_url.default.relativeUrl("/mod/vpl/thirdpartylibs/monaco-editor/min/vs"),baseRel="/../thirdpartylibs/monaco-editor/min/vs";_vplutil.VPLUtil.loadScript([baseRel+"/loader.js"],(function(){requirejs.config({paths:{vs:base}}),void 0===window.MonacoEnvironment&&(window.MonacoEnvironment={getWorkerUrl:function(_moduleId,label){const workers={json:base+"language/json/json.worker.js",css:base+"language/css/css.worker.js",html:base+"language/html/html.worker.js",typescript:base+"language/typescript/ts.worker.js",javascript:base+"language/typescript/ts.worker.js",editor:base+"editor/editor.worker.js"};return workers[label]||workers.editor}}),require(["vs/editor/editor.main"],(function(){_log.default.debug("Monaco loaded"),resolve(window.monaco)}))}))}catch(e){_log.default.error("Failed to load Monaco:"+e),reject(e)}}))},this.getMonacoEms=async function(){const base=_url.default.relativeUrl("/mod/vpl/thirdpartylibs/monaco-editor/esm/vs/");return void 0!==window.vpl_monaco||(void 0===window.MonacoEnvironment&&(window.MonacoEnvironment={getWorkerUrl:function(_moduleId,label){const workers={json:base+"language/json/json.worker.js",css:base+"language/css/css.worker.js",html:base+"language/html/html.worker.js",typescript:base+"language/typescript/ts.worker.js",javascript:base+"language/typescript/ts.worker.js",editor:base+"editor/editor.worker.js"};return workers[label]||workers.editor}}),await _vplutil.VPLUtil.loadModule("monaco-editor/esm/vs/editor/editor.api","vpl_monaco",!1)),Promise.resolve(window.vpl_monaco)}}}));

//# sourceMappingURL=vplidecodefilemonaco.min.js.map