{"version":3,"file":"vplidefile.min.js","sources":["../src/vplidefile.js"],"sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * File management\n *\n * @copyright 2013 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\nimport $ from 'jquery';\n/* eslint-disable no-unused-vars */\nimport jqui from 'jqueryui';\n/* eslint-enable no-unused-vars */\nimport {VPLUtil} from 'mod_vpl/vplutil';\nimport {VPLUI} from 'mod_vpl/vplui';\nimport {codeExtension} from 'mod_vpl/vplidecodefile';\nimport {blocklyExtension} from 'mod_vpl/vplideblocklyfile';\nimport {binaryExtension} from 'mod_vpl/vplidebinaryfile';\n\nexport const VPLFile = function(id, name, value, fileManager, vplIdeInstance) {\n    var tid = \"#vpl_file\" + id;\n    var tabnameid = \"#vpl_tab_name\" + id;\n    var fileName = name;\n    var modified = true;\n    var opened = false;\n    var langType = 'text';\n    var self = this;\n    var binary = VPLUtil.isBinary(name, value);\n    this.getContent = function() {\n        return value;\n    };\n    this.setContent = function(c) {\n        value = c;\n        binary = VPLUtil.isBinary(name, value);\n    };\n    this.getFileManager = function() {\n        return fileManager;\n    };\n    this.getFileName = function() {\n        return fileName;\n    };\n    this.getId = function() {\n        return id;\n    };\n    this.getTabNameId = function() {\n        return tabnameid;\n    };\n    this.getTId = function() {\n        return tid;\n    };\n    this.getFileName = function() {\n        return fileName;\n    };\n    this.isModified = function() {\n        return modified;\n    };\n    this.resetModified = function() {\n        modified = false;\n        this.showFileName();\n    };\n    this.setModified = function() {\n        modified = true;\n        this.showFileName();\n    };\n    this.getTabPos = function() {\n        return fileManager.getTabPos(this);\n    };\n    this.setLang = function(lang) {\n        langType = lang;\n    };\n    this.getLang = function() {\n        return langType;\n    };\n    this.isOpen = function() {\n        return opened;\n    };\n    this.setOpen = function(openState) {\n        opened = openState;\n    };\n    this.getVPLIDE = function() {\n        return vplIdeInstance;\n    };\n    this.change = function() {\n        if (!modified) {\n            this.setModified();\n            fileManager.generateFileList();\n            this.showFileName();\n            VPLUtil.longDelay('setModified', fileManager.setModified);\n        }\n    };\n    this.setFileName = function(name) {\n        if (!VPLUtil.validPath(name)) {\n            return false;\n        }\n        if (name != fileName) {\n            fileName = name;\n            self.change();\n        }\n        this.setReadOnly(fileManager.isReadOnly(name));\n        if (!this.isOpen()) {\n            return true;\n        }\n        binary = VPLUtil.isBinary(name, value);\n        this.showFileName();\n        this.langSelection();\n        return true;\n    };\n    this.showFileName = function() {\n        var name = this.getFileName();\n        var fn = VPLUtil.getFileName(name);\n        if (fn.length > 20) {\n            fn = fn.substring(0, 16) + '...';\n        }\n        var html = (modified ? VPLUI.iconModified() : '') + fn;\n        if (this.isReadOnly()) {\n            html = html + VPLUI.iconReadOnly();\n        } else if (this.getId() < fileManager.minNumberOfFiles) {\n            html = html + VPLUI.iconRequired();\n        }\n        html = html + VPLUI.iconClose();\n        $(tabnameid + ' a').html(html);\n        if (fn != name) {\n            $(tabnameid + ' a').attr('title', name);\n        }\n        VPLUtil.afterAll('adjustTabsTitles' + self.id, function() {\n            fileManager.adjustTabsTitles(true);\n            VPLUtil.delay('adjustTabsTitles' + self.id, function() {\n                self.adjustSize();\n            });\n        });\n    };\n\n    this.destroy = function() {\n        $(tabnameid).remove();\n        $(tid).remove();\n    };\n\n    this.adjustSize = function() {\n        if (!this.isOpen()) {\n            return false;\n        }\n        var editTag = $(tid);\n        var tabs = editTag.parent();\n        if (editTag.length === 0) {\n            return false;\n        }\n        var editorHeight = editTag.height();\n        var editorWidth = editTag.width();\n        var newHeight = tabs.height();\n        newHeight -= editTag.position().top;\n        var newWidth = $('#vpl_tabs_scroll').width();\n        if (newHeight != editorHeight || newWidth != editorWidth) {\n            $(editTag).height(newHeight);\n            $(editTag).width(newWidth);\n            return true;\n        }\n        return false;\n    };\n    this.isBinary = function() {\n        return binary;\n    };\n    this.updateStatus = VPLUI.hideIDEStatus;\n    this.gotoLine = VPLUtil.doNothing;\n    this.setReadOnly = VPLUtil.doNothing;\n    this.isReadOnly = VPLUtil.returnFalse;\n    this.focus = VPLUI.hideIDEStatus;\n    this.blur = VPLUtil.doNothing;\n    this.undo = VPLUtil.doNothing;\n    this.redo = VPLUtil.doNothing;\n    this.selectAll = VPLUtil.doNothing;\n    this.open = VPLUtil.doNothing;\n    this.hasUndo = VPLUtil.returnFalse;\n    this.hasRedo = VPLUtil.returnFalse;\n    this.hasSelectAll = VPLUtil.returnFalse;\n    this.hasFind = VPLUtil.returnFalse;\n    this.hasFindReplace = VPLUtil.returnFalse;\n    this.hasNext = VPLUtil.returnFalse;\n    this.find = VPLUtil.doNothing;\n    this.replace = VPLUtil.doNothing;\n    this.next = VPLUtil.doNothing;\n    this.getAnnotations = function() {\n        return [];\n    };\n    this.setAnnotations = VPLUtil.doNothing;\n    this.setFontSize = VPLUtil.doNothing;\n    this.setTheme = VPLUtil.doNothing;\n    this.clearAnnotations = VPLUtil.doNothing;\n    this.langSelection = VPLUtil.doNothing;\n    // Adds support for current extensions\n    this.extendToCodeEditor = codeExtension;\n    this.extendToBlockly = blocklyExtension;\n    this.extendToBinary = binaryExtension;\n};\n"],"names":["id","name","value","fileManager","vplIdeInstance","tid","tabnameid","fileName","modified","opened","langType","self","this","binary","VPLUtil","isBinary","getContent","setContent","c","getFileManager","getFileName","getId","getTabNameId","getTId","isModified","resetModified","showFileName","setModified","getTabPos","setLang","lang","getLang","isOpen","setOpen","openState","getVPLIDE","change","generateFileList","longDelay","setFileName","validPath","setReadOnly","isReadOnly","langSelection","fn","length","substring","html","VPLUI","iconModified","iconReadOnly","minNumberOfFiles","iconRequired","iconClose","attr","afterAll","adjustTabsTitles","delay","adjustSize","destroy","remove","editTag","tabs","parent","editorHeight","height","editorWidth","width","newHeight","position","top","newWidth","updateStatus","hideIDEStatus","gotoLine","doNothing","returnFalse","focus","blur","undo","redo","selectAll","open","hasUndo","hasRedo","hasSelectAll","hasFind","hasFindReplace","hasNext","find","replace","next","getAnnotations","setAnnotations","setFontSize","setTheme","clearAnnotations","extendToCodeEditor","codeExtension","extendToBlockly","blocklyExtension","extendToBinary","binaryExtension"],"mappings":"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"}