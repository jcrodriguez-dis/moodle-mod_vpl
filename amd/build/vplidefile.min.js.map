{"version":3,"sources":["../src/vplidefile.js"],"names":["define","$","jqui","VPLUtil","codeExtension","blocklyExtension","binaryExtension","id","name","value","fileManager","vplIdeInstance","tid","tabnameid","fileName","modified","opened","self","getContent","setContent","c","getFileManager","getFileName","getId","getTabNameId","getTId","isModified","resetModified","showFileName","setModified","getTabPos","isOpen","setOpen","openState","getVPLIDE","change","generateFileList","longDelay","setFileName","validPath","langSelection","fn","length","substring","html","iconModified","minNumberOfFiles","iconRequired","iconClose","attr","afterAll","adjustTabsTitles","delay","adjustSize","destroy","remove","editTag","tabs","parent","editorHeight","height","editorWidth","width","newHeight","position","top","newWidth","gotoLine","doNothing","setReadOnly","focus","blur","undo","redo","selectAll","open","hasUndo","returnFalse","hasRedo","hasSelectAll","hasFind","hasFindReplace","hasNext","find","replace","next","getAnnotations","setAnnotations","setFontSize","setTheme","clearAnnotations","isBinary","extendToCodeEditor","extendToBlockly","extendToBinary"],"mappings":"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","sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * File management\n *\n * @package mod_vpl\n * @copyright 2013 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\ndefine(\n    [\n        'jquery',\n        'jqueryui',\n        'mod_vpl/vplutil',\n        'mod_vpl/vplidecodefile',\n        'mod_vpl/vplideblocklyfile',\n        'mod_vpl/vplidebinaryfile',\n    ],\n    function($, jqui, VPLUtil, codeExtension, blocklyExtension, binaryExtension) {\n        return function(id, name, value, fileManager, vplIdeInstance) {\n            var tid = \"#vpl_file\" + id;\n            var tabnameid = \"#vpl_tab_name\" + id;\n            var fileName = name;\n            var modified = true;\n            var opened = false;\n            var self = this;\n            this.getContent = function() {\n                return value;\n            };\n            this.setContent = function(c) {\n                value = c;\n            };\n            this.getFileManager = function() {\n                return fileManager;\n            };\n            this.getFileName = function() {\n                return fileName;\n            };\n            this.getId = function() {\n                return id;\n            };\n            this.getTabNameId = function() {\n                return tabnameid;\n            };\n            this.getTId = function() {\n                return tid;\n            };\n            this.getFileName = function() {\n                return fileName;\n            };\n            this.isModified = function() {\n                return modified;\n            };\n            this.resetModified = function() {\n                modified = false;\n                this.showFileName();\n            };\n            this.setModified = function() {\n                modified = true;\n                this.showFileName();\n            };\n            this.getTabPos = function() {\n                return fileManager.getTabPos(this);\n            };\n            this.isOpen = function() {\n                return opened;\n            };\n            this.setOpen = function(openState) {\n                opened = openState;\n            };\n            this.getVPLIDE = function() {\n                return vplIdeInstance;\n            };\n            this.change = function() {\n                if (!modified) {\n                    this.setModified();\n                    fileManager.generateFileList();\n                    this.showFileName();\n                    VPLUtil.longDelay('setModified', fileManager.setModified);\n                }\n            };\n            this.setFileName = function(name) {\n                if (!VPLUtil.validPath(name)) {\n                    return false;\n                }\n                if (name != fileName) {\n                    fileName = name;\n                    self.change();\n                }\n                if (!this.isOpen()) {\n                    return true;\n                }\n                this.showFileName();\n                this.langSelection();\n                return true;\n            };\n            this.showFileName = function() {\n                var name = this.getFileName();\n                var fn = VPLUtil.getFileName(name);\n                if (fn.length > 20) {\n                    fn = fn.substring(0, 16) + '...';\n                }\n                var html = (modified ? VPLUtil.iconModified() : '') + fn;\n                if (this.getTabPos() < fileManager.minNumberOfFiles) {\n                    html = html + VPLUtil.iconRequired();\n                } else {\n                    html = html + VPLUtil.iconClose();\n                }\n                $(tabnameid + ' a').html(html);\n                if (fn != name) {\n                    $(tabnameid + ' a').attr('title', name);\n                }\n                VPLUtil.afterAll('adjustTabsTitles' + self.id, function() {\n                    fileManager.adjustTabsTitles(true);\n                    VPLUtil.delay('adjustTabsTitles' + self.id, function() {\n                        self.adjustSize();\n                    });\n                });\n            };\n\n            this.destroy = function() {\n                $(tabnameid).remove();\n                $(tid).remove();\n            };\n\n            this.adjustSize = function() {\n                if (!this.isOpen()) {\n                    return false;\n                }\n                var editTag = $(tid);\n                var tabs = editTag.parent();\n                if (editTag.length === 0) {\n                    return false;\n                }\n                var editorHeight = editTag.height();\n                var editorWidth = editTag.width();\n                var newHeight = tabs.height();\n                newHeight -= editTag.position().top;\n                var newWidth = $('#vpl_tabs_scroll').width();\n                if (newHeight != editorHeight || newWidth != editorWidth) {\n                    $(editTag).height(newHeight);\n                    $(editTag).width(newWidth);\n                    return true;\n                }\n                return false;\n            };\n            this.gotoLine = VPLUtil.doNothing;\n            this.setReadOnly = VPLUtil.doNothing;\n            this.focus = VPLUtil.doNothing;\n            this.blur = VPLUtil.doNothing;\n            this.undo = VPLUtil.doNothing;\n            this.redo = VPLUtil.doNothing;\n            this.selectAll = VPLUtil.doNothing;\n            this.open = VPLUtil.doNothing;\n            this.hasUndo = VPLUtil.returnFalse;\n            this.hasRedo = VPLUtil.returnFalse;\n            this.hasSelectAll = VPLUtil.returnFalse;\n            this.hasFind = VPLUtil.returnFalse;\n            this.hasFindReplace = VPLUtil.returnFalse;\n            this.hasNext = VPLUtil.returnFalse;\n            this.find = VPLUtil.doNothing;\n            this.replace = VPLUtil.doNothing;\n            this.next = VPLUtil.doNothing;\n            this.getAnnotations = function() {\n                return [];\n            };\n            this.setAnnotations = VPLUtil.doNothing;\n            this.setFontSize = VPLUtil.doNothing;\n            this.setTheme = VPLUtil.doNothing;\n            this.clearAnnotations = VPLUtil.doNothing;\n            this.langSelection = VPLUtil.doNothing;\n            this.isBinary = VPLUtil.returnFalse;\n            // Adds support for current extensions\n            this.extendToCodeEditor = codeExtension;\n            this.extendToBlockly = blocklyExtension;\n            this.extendToBinary = binaryExtension;\n        };\n    }\n);\n"],"file":"vplidefile.min.js"}