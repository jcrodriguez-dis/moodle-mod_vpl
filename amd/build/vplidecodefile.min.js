/**
 * Code files extension method using ACE editorfiles. Add to VPLFile object.
 *
 * @copyright 2013 Juan Carlos Rodríguez-del-Pino
 * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>
 */
define("mod_vpl/vplidecodefile",["jquery","mod_vpl/vplutil"],(function($,VPLUtil){return function(){var self=this,editor=null,session=null,readOnly=self.getFileManager().readOnly,getOldContent=this.getContent;this.getContent=function(){return this.isOpen()?editor.getValue():getOldContent.call(this)};var setOldContent=this.setContent;this.setContent=function(c){setOldContent.call(this,c),this.isOpen()&&editor.setValue(c)};var oldDestroy=this.destroy;this.destroy=function(){this.isOpen()&&editor.destroy(),oldDestroy.call(this)},this.setFontSize=function(size){this.isOpen()&&editor.setFontSize(size)};var oldAdjustSize=this.adjustSize;this.adjustSize=function(){return!!oldAdjustSize.call(this)&&(editor.resize(!0),!0)},this.gotoLine=function(line){this.isOpen()&&(editor.gotoLine(line,0),editor.scrollToLine(line,!0),editor.focus())},this.setReadOnly=function(s){readOnly=s,this.isOpen()&&editor.setReadOnly(s)},this.focus=function(){if(this.isOpen()){var tid=this.getTId();$(tid).removeClass("ui-widget-content ui-tabs-panel"),editor.focus()}},this.blur=function(){this.isOpen()&&editor.blur()},this.undo=function(){this.isOpen()&&(editor.undo(),editor.focus())},this.redo=function(){this.isOpen()&&(editor.redo(),editor.focus())},this.selectAll=function(){this.isOpen()&&(editor.selectAll(),editor.focus())},this.hasUndo=function(){return!!this.isOpen()&&session.getUndoManager().hasUndo()},this.hasRedo=function(){return!!this.isOpen()&&session.getUndoManager().hasRedo()},this.hasSelectAll=VPLUtil.returnTrue,this.hasFind=VPLUtil.returnTrue,this.hasFindReplace=VPLUtil.returnTrue,this.hasNext=VPLUtil.returnTrue,this.find=function(){this.isOpen()&&editor.execCommand("find")},this.replace=function(){this.isOpen()&&editor.execCommand("replace")},this.next=function(){this.isOpen()&&editor.execCommand("findnext")},this.getAnnotations=function(){return this.isOpen()?session.getAnnotations():[]},this.setAnnotations=function(a){return!!this.isOpen()&&session.setAnnotations(a)},this.clearAnnotations=function(){return!!this.isOpen()&&session.clearAnnotations()},this.langSelection=function(){if(this.isOpen()){var ext=VPLUtil.fileExtension(this.getFileName()),lang=""!==ext?VPLUtil.langType(ext):"text";session.setMode("ace/mode/"+lang),this.setLang(lang)}},this.getEditor=function(){return!!this.isOpen()&&editor},this.setTheme=function(theme){this.isOpen()&&editor.setTheme("ace/theme/"+theme)},this.open=function(){if(this.showFileName(),"undefined"==typeof ace)return VPLUtil.loadScript(["../editor/ace9/ace.js","../editor/ace9/ext-language_tools.js"],(function(){self.open()})),!1;if(this.isOpen())return editor;var fileManager=this.getFileManager(),tid=this.getTId();$(tid).removeClass("ui-widget-content ui-tabs-panel"),ace.require("ext/language_tools"),editor=ace.edit("vpl_file"+this.getId()),session=editor.getSession(),editor.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0}),editor.setValue(this.getContent()),editor.setFontSize(fileManager.getFontSize()),editor.setTheme("ace/theme/"+fileManager.getTheme()),editor.$blockScrolling=1/0,editor.gotoLine(1,0),editor.setReadOnly(readOnly),session.setUseSoftTabs(!0),session.setTabSize(4),session.setUndoManager(new ace.UndoManager),this.setOpen(!0),this.langSelection(),editor.execCommand("replace");var addEventDrop=function(){var tag=$(tid+" div.ace_search");tag.length?(tag.on("drop",fileManager.dropHandler),$(".ace_searchbtn_close").trigger("click")):setTimeout(addEventDrop,50)};editor.on("change",(function(){self.change()})),setTimeout(addEventDrop,5);var prevOnPaste=editor.onPaste;return editor.onPaste=function(s){fileManager.restrictedEdit?editor.insert(fileManager.getClipboard()):prevOnPaste.call(editor,s)},editor.on("copy",(function(t){fileManager.setClipboard(t.text)})),$(tid).on("paste","*",fileManager.restrictedPaste),$(tid+" div.ace_content").on("drop",fileManager.dropHandler),$(tid+" div.ace_content").on("dragover",fileManager.dragoverHandler),$(tid).find("div.ace_scroller").css("position","static"),this.adjustSize(),$(tid).find("div.ace_scroller").css("position","absolute"),editor},this.close=function(){this.setOpen(!1),null!==editor&&(this.setContent(editor.getValue()),editor.destroy(),editor=null,session=null)}}}));

//# sourceMappingURL=vplidecodefile.min.js.map