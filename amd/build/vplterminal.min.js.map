{"version":3,"sources":["../src/vplterminal.js"],"names":["define","$","jqui","VPLUtil","VPLClipboard","VPLTerminal","dialogId","terminalId","str","self","ws","onCloseAction","doNothing","title","message","tdialog","tIde","titleText","clipboard","cliboardMaxsize","clipboardData","terminal","terminalTag","updateTitle","text","setTitle","t","setMessage","receiveClipboard","data","length","from","substr","pasteClipboard","readyState","OPEN","send","getEntry2","updateClipboard","setEntry1","openClipboard","show","write","connect","server","onClose","window","reset","startBlink","close","WebSocket","writeBuffer","writeIt","onmessage","event","setTimeout","onopen","onclose","blur","stopBlink","stopOutput","writeLocal","setDataCallback","call","onData","closeLocal","connectLocal","readBuffer","pos","indexOf","isOpen","dialog","isConnected","CLOSED","disconnect","HTMLUpdateClipboard","genIcon","HTMLPaste","document","execCommand","closeDialog","hide","setTheme","theme","setUserPreferences","terminalTheme","i","removeClass","addClass","controlDialogSize","bw","width","bh","height","parent","prev","outerHeight","closeOnEscape","autoOpen","resizable","dragStop","open","focus","dialogClass","create","setTitleBar","resizeStop","setFontSize","size","css","getUserPreferences","preferences","init","Terminal","loadScript","cols","rows","useStyle","screenKeys","on","setLineCallback","line","nlines","offset","scrollTop","viewHeight","innerHeight","lineHeight"],"mappings":"AA0BAA,OAAM,uBACF,CACI,QADJ,CAEI,UAFJ,CAGI,iBAHJ,CAII,sBAJJ,CADE,CAOF,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAA2BC,CAA3B,CAAyC,IAKjCC,CAAAA,CAAW,CAAG,SAASC,CAAT,CAAmBC,CAAnB,CAA+BC,CAA/B,CAAoC,IAC9CC,CAAAA,CAAI,CAAG,IADuC,CAE9CC,CAAE,CAAG,IAFyC,CAG9CC,CAAa,CAAGR,CAAO,CAACS,SAHsB,CAI9CC,CAAK,CAAG,EAJsC,CAK9CC,CAAO,CAAG,EALoC,CAM9CC,CAAO,CAAGd,CAAC,CAAC,IAAMK,CAAP,CANmC,CAO9CU,CAAI,CAAGf,CAAC,CAAC,SAAD,CAPsC,CAQ9CgB,CAAS,CAAG,EARkC,CAS9CC,CAAS,CAAG,IATkC,CAU9CC,CAAe,CAAG,IAV4B,CAW9CC,CAAa,CAAG,EAX8B,CAa9CC,CAb8C,CAc9CC,CAAW,CAAGrB,CAAC,CAAC,IAAMM,CAAP,CAd+B,CAelD,KAAKgB,WAAL,CAAmB,UAAW,CAC1B,GAAIC,CAAAA,CAAI,CAAGX,CAAX,CACA,GAAgB,EAAZ,GAAAC,CAAJ,CAAoB,CAChBU,CAAI,EAAI,KAAOV,CAAP,CAAiB,GAC5B,CACDG,CAAS,CAACO,IAAV,CAAehB,CAAG,CAAC,SAAD,CAAH,CAAiB,IAAjB,CAAwBgB,CAAvC,CACH,CAND,CAOA,KAAKC,QAAL,CAAgB,SAASC,CAAT,CAAY,CACxBb,CAAK,CAAGa,CAAR,CACA,KAAKH,WAAL,EACH,CAHD,CAIA,KAAKI,UAAL,CAAkB,SAASD,CAAT,CAAY,CAC1BZ,CAAO,CAAGY,CAAV,CACA,KAAKH,WAAL,EACH,CAHD,CAQA,QAASK,CAAAA,CAAT,CAA0BC,CAA1B,CAAgC,CAC5BT,CAAa,EAAIS,CAAjB,CACA,GAAIT,CAAa,CAACU,MAAd,CAAuBX,CAA3B,CAA4C,CACxC,GAAIY,CAAAA,CAAI,CAAGX,CAAa,CAACU,MAAd,CAAuBX,CAAe,CAAG,CAApD,CACAC,CAAa,CAAGA,CAAa,CAACY,MAAd,CAAqBD,CAArB,CACnB,CACJ,CAID,QAASE,CAAAA,CAAT,EAA0B,CACtB,GAAIvB,CAAE,EAAIA,CAAE,CAACwB,UAAH,EAAiBxB,CAAE,CAACyB,IAA9B,CAAoC,CAChCzB,CAAE,CAAC0B,IAAH,CAAQlB,CAAS,CAACmB,SAAV,EAAR,CACH,CACJ,CAID,QAASC,CAAAA,CAAT,EAA2B,CACvBpB,CAAS,CAACqB,SAAV,CAAoBnB,CAApB,CACH,CAID,QAASoB,CAAAA,CAAT,EAAyB,CACrBF,CAAe,GACfpB,CAAS,CAACuB,IAAV,EACH,CACD,KAAKC,KAAL,CAAa,SAASlB,CAAT,CAAe,CACxBH,CAAQ,CAACqB,KAAT,CAAelB,CAAf,EACA,MAAOA,CAAAA,CACV,CAHD,CAKA,KAAKmB,OAAL,CAAe,SAASC,CAAT,CAAiBC,CAAjB,CAA0B,CACrClC,CAAa,CAAGkC,CAAhB,CACA,GAAI,aAAeC,CAAAA,MAAnB,CAA2B,CACvBzB,CAAQ,CAAC0B,KAAT,GACA1B,CAAQ,CAAC2B,UAAT,GACAvC,CAAI,CAACgC,IAAL,GACA,GAAI/B,CAAJ,CAAQ,CACJA,CAAE,CAACuC,KAAH,EACH,CACD7B,CAAa,CAAG,EAAhB,CACAX,CAAI,CAACkB,UAAL,CAAgB,EAAhB,EACAlB,CAAI,CAACgB,QAAL,CAAcjB,CAAG,CAAC,YAAD,CAAjB,EACAE,CAAE,CAAG,GAAIwC,CAAAA,SAAJ,CAAcN,CAAd,CAAL,CACAlC,CAAE,CAACyC,WAAH,CAAiB,EAAjB,CACAzC,CAAE,CAAC0C,OAAH,CAAa,UAAW,CACpB/B,CAAQ,CAACqB,KAAT,CAAehC,CAAE,CAACyC,WAAlB,EACAvB,CAAgB,CAAClB,CAAE,CAACyC,WAAJ,CAAhB,CACAzC,CAAE,CAACyC,WAAH,CAAiB,EACpB,CAJD,CAKAzC,CAAE,CAAC2C,SAAH,CAAe,SAASC,CAAT,CAAgB,CAC3B,GAA4B,CAAxB,CAAA5C,CAAE,CAACyC,WAAH,CAAerB,MAAnB,CAA+B,CAC3BpB,CAAE,CAACyC,WAAH,EAAkBG,CAAK,CAACzB,IAC3B,CAFD,IAEO,CACHnB,CAAE,CAACyC,WAAH,CAAiBG,CAAK,CAACzB,IAAvB,CACA0B,UAAU,CAAC7C,CAAE,CAAC0C,OAAJ,CAAa,EAAb,CACb,CACJ,CAPD,CAQA1C,CAAE,CAAC8C,MAAH,CAAY,UAAW,CACnB/C,CAAI,CAACkB,UAAL,CAAgB,EAAhB,EACAlB,CAAI,CAACgB,QAAL,CAAcjB,CAAG,CAAC,WAAD,CAAjB,CACH,CAHD,CAIAE,CAAE,CAAC+C,OAAH,CAAa,UAAW,CACpBhD,CAAI,CAACgB,QAAL,CAAcjB,CAAG,CAAC,mBAAD,CAAjB,EACAa,CAAQ,CAACqC,IAAT,GACArC,CAAQ,CAACsC,SAAT,GACAd,CAAO,GACPnC,CAAE,CAACkD,UAAH,GACH,CACJ,CApCD,IAoCO,CACHvC,CAAQ,CAACqB,KAAT,CAAe,+CAAf,CACH,CACJ,CAzCD,CA0CA,KAAKmB,UAAL,CAAkB,SAASrC,CAAT,CAAe,CAC7Bd,CAAE,CAAC2C,SAAH,CAAa,CACTxB,IAAI,CAAEL,CADG,CAAb,EAGA,MAAOA,CAAAA,CACV,CALD,CAMA,KAAKsC,eAAL,CAAuB,SAASC,CAAT,CAAe,CAClCrD,CAAE,CAACsD,MAAH,CAAYD,CACf,CAFD,CAGA,KAAKE,UAAL,CAAkB,UAAW,CACzB,GAAIvD,CAAJ,CAAQ,CACJA,CAAE,CAAC0C,OAAH,GACA1C,CAAE,CAACuC,KAAH,GACA5B,CAAQ,CAACsC,SAAT,GACAlD,CAAI,CAACgB,QAAL,CAAcjB,CAAG,CAAC,mBAAD,CAAjB,CACH,CACJ,CAPD,CAQA,KAAK0D,YAAL,CAAoB,SAASrB,CAAT,CAAkBmB,CAAlB,CAA0B,CAC1CrD,CAAa,CAAGkC,CAAhB,CACAxB,CAAQ,CAAC0B,KAAT,GACA1B,CAAQ,CAAC2B,UAAT,GACAvC,CAAI,CAACgC,IAAL,GACA,GAAI/B,CAAJ,CAAQ,CACJA,CAAE,CAACuC,KAAH,EACH,CACD7B,CAAa,CAAG,EAAhB,CACAX,CAAI,CAACkB,UAAL,CAAgB,EAAhB,EACAlB,CAAI,CAACgB,QAAL,CAAcjB,CAAG,CAAC,SAAD,CAAjB,EACAE,CAAE,CAAG,EAAL,CACAA,CAAE,CAACsD,MAAH,CAAYA,CAAZ,CACAtD,CAAE,CAACyC,WAAH,CAAiB,EAAjB,CACAzC,CAAE,CAACyD,UAAH,CAAgB,EAAhB,CACAzD,CAAE,CAACwB,UAAH,CAAgB,CAAhB,CACAxB,CAAE,CAACyB,IAAH,CAAU,CAAV,CACAzB,CAAE,CAACuC,KAAH,CAAW,UAAW,CAClBvC,CAAE,GACL,CAFD,CAGAA,CAAE,CAAC2C,SAAH,CAAe,SAASC,CAAT,CAAgB,CAC3B5C,CAAE,CAACyC,WAAH,CAAiBG,CAAK,CAACzB,IAAvB,CACAnB,CAAE,CAAC0C,OAAH,EACH,CAHD,CAIA1C,CAAE,CAAC0C,OAAH,CAAa,UAAW,CACpB,GAAI1C,CAAJ,CAAQ,CACJW,CAAQ,CAACqB,KAAT,CAAehC,CAAE,CAACyC,WAAlB,EACAvB,CAAgB,CAAClB,CAAE,CAACyC,WAAJ,CAAhB,CACAzC,CAAE,CAACyC,WAAH,CAAiB,EACpB,CACJ,CAND,CAOAzC,CAAE,CAAC0B,IAAH,CAAU,SAASZ,CAAT,CAAe,CAErB,GAAY,MAAR,EAAAA,CAAJ,CAAsB,CAClB,GAA2B,CAAvB,CAAAd,CAAE,CAACyD,UAAH,CAAcrC,MAAlB,CAA8B,CAC1BrB,CAAI,CAACoD,UAAL,CAAgB,OAAhB,EACAnD,CAAE,CAACyD,UAAH,CAAgBzD,CAAE,CAACyD,UAAH,CAAcnC,MAAd,CAAqB,CAArB,CAAwBtB,CAAE,CAACyD,UAAH,CAAcrC,MAAd,CAAuB,CAA/C,CACnB,CACJ,CALD,IAKO,CACHrB,CAAI,CAACoD,UAAL,CAAgBrC,CAAhB,EACAd,CAAE,CAACyD,UAAH,EAAiB3C,CACpB,CACD,GAAI4C,CAAAA,CAAG,CAAG1D,CAAE,CAACyD,UAAH,CAAcE,OAAd,CAAsB,IAAtB,CAAV,CACA,GAAW,CAAC,CAAR,EAAAD,CAAJ,CAAe,CACX,GAAIvC,CAAAA,CAAI,CAAGnB,CAAE,CAACyD,UAAH,CAAcnC,MAAd,CAAqB,CAArB,CAAwBoC,CAAxB,CAAX,CACA1D,CAAE,CAACyD,UAAH,CAAgBzD,CAAE,CAACyD,UAAH,CAAcnC,MAAd,CAAqBoC,CAAG,CAAG,CAA3B,CAAhB,CACA1D,CAAE,CAACsD,MAAH,CAAUnC,CAAV,CACH,CACJ,CACJ,CAjDD,CAkDA,KAAKyC,MAAL,CAAc,UAAW,CACrB,MAAOvD,CAAAA,CAAO,CAACwD,MAAR,CAAe,QAAf,CACV,CAFD,CAGA,KAAKtB,KAAL,CAAa,UAAW,CACpBlC,CAAO,CAACwD,MAAR,CAAe,OAAf,CACH,CAFD,CAGA,KAAKC,WAAL,CAAmB,UAAW,CAC1B,MAAO9D,CAAAA,CAAE,EAAIA,CAAE,CAACwB,UAAH,EAAiBxB,CAAE,CAAC+D,MACpC,CAFD,CAGA,KAAKC,UAAL,CAAkB,UAAW,CACzB,GAAIhE,CAAE,EAAIA,CAAE,CAACwB,UAAH,EAAiBxB,CAAE,CAACyB,IAA9B,CAAoC,CAChCxB,CAAa,GACb,GAAID,CAAJ,CAAQ,CACJA,CAAE,CAACuC,KAAH,EACH,CACD5B,CAAQ,CAACsC,SAAT,EACH,CACJ,CARD,CAzLkD,GAkM9CgB,CAAAA,CAAmB,CAAGxE,CAAO,CAACyE,OAAR,CAAgB,MAAhB,CAAwB,IAAxB,EAAgC,GAAhC,CAAsCpE,CAAG,CAAC,MAAD,CAlMjB,CAmM9CqE,CAAS,CAAG1E,CAAO,CAACyE,OAAR,CAAgB,OAAhB,CAAyB,IAAzB,EAAiC,GAAjC,CAAuCpE,CAAG,CAAC,OAAD,CAnMR,CAoMlDU,CAAS,CAAG,GAAId,CAAAA,CAAJ,CAAiB,+BAAjB,CAAkDuE,CAAlD,CAAuE,UAAW,CACtFrC,CAAe,GACfwC,QAAQ,CAACC,WAAT,CAAqB,MAArB,CACH,CAHO,CAGLF,CAHK,CAGM5C,CAHN,CAAZ,CAIA,KAAK+C,WAAL,CAAmB,UAAW,CAC1B9D,CAAS,CAAC+D,IAAV,GACAxE,CAAI,CAACiE,UAAL,EACH,CAHD,CAQA,QAASQ,CAAAA,CAAT,CAAkBC,CAAlB,CAAyB,CAGrBpE,CAAO,CAACc,IAAR,CAAa,gBAAb,CAA+BsD,CAA/B,EACAhF,CAAO,CAACiF,kBAAR,CAA2B,CAACC,aAAa,CAAEF,CAAhB,CAA3B,EACA,IAAK,GAAIG,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAHH,CAGd,CAA6BA,CAAC,EAA9B,CAAkC,CAC9BvE,CAAO,CAACwE,WAAR,CAAoB,qBAAQD,CAA5B,CACH,CACDvE,CAAO,CAACyE,QAAR,CAAiB,qBAAQL,CAAzB,CACH,CAID,QAASM,CAAAA,CAAT,EAA6B,IAErBC,CAAAA,CAAE,CAAG1E,CAAI,CAAC2E,KAAL,EAFgB,CAGrBC,CAAE,CAAG5E,CAAI,CAAC6E,MAAL,EAHgB,CAIzB,GAAI9E,CAAO,CAAC4E,KAAR,GAAkBD,CAAtB,CAA0B,CACtB3E,CAAO,CAACwD,MAAR,CAAe,QAAf,CAAyB,OAAzB,CAAkCmB,CAAlC,CACH,CACD,GAAI3E,CAAO,CAAC+E,MAAR,GAAiBD,MAAjB,GAA4BD,CAAhC,CAAoC,CAChC7E,CAAO,CAACwD,MAAR,CAAe,QAAf,CAAyB,QAAzB,CAAmCqB,CAAE,CAAG7E,CAAO,CAACgF,IAAR,GAAeC,WAAf,EAAxC,CACH,CACJ,CACDjF,CAAO,CAACwD,MAAR,CAAe,CACX0B,aAAa,GADF,CAEXC,QAAQ,GAFG,CAGXP,KAAK,CAAE,MAHI,CAIXE,MAAM,CAAE,MAJG,CAKXM,SAAS,GALE,CAMXC,QAAQ,CAAEX,CANC,CAOXY,IAAI,CAAEZ,CAPK,CAQXa,KAAK,CAAE,gBAAW,CACdb,CAAiB,GACjBpE,CAAQ,CAACiF,KAAT,EACH,CAXU,CAYXC,WAAW,CAAE,iBAZF,CAaXC,MAAM,CAAE,iBAAW,CACfvF,CAAS,CAAGd,CAAO,CAACsG,WAAR,CAAoB1F,CAApB,CAA6B,SAA7B,CAAwC,SAAxC,CACJ,CAAC,WAAD,CAAc,UAAd,CAA0B,OAA1B,CADI,CAEJ,CAACyB,CAAD,CACA,UAAW,CACPnB,CAAQ,CAACiF,KAAT,EACH,CAHD,CAIA,UAAW,CAEP,GAAInB,CAAAA,CAAK,CAAG,CAACpE,CAAO,CAACc,IAAR,CAAa,gBAAb,EAAiC,CAAlC,GAAZ,CACAqD,CAAQ,CAACC,CAAD,CACX,CARD,CAFI,CAWf,CAzBU,CA0BXlC,KAAK,CAAE,gBAAW,CACdxC,CAAI,CAACuE,WAAL,EACH,CA5BU,CA6BX0B,UAAU,CAAE,qBAAW,CACnB3F,CAAO,CAAC4E,KAAR,CAAc5E,CAAO,CAAC+E,MAAR,GAAiBH,KAAjB,EAAd,EACA5E,CAAO,CAAC8E,MAAR,CAAe9E,CAAO,CAAC+E,MAAR,GAAiBD,MAAjB,GAA4B9E,CAAO,CAACgF,IAAR,GAAeC,WAAf,EAA3C,EACAP,CAAiB,GACjBpE,CAAQ,CAACiF,KAAT,EACH,CAlCU,CAAf,EAoCA,KAAKK,WAAL,CAAmB,SAASC,CAAT,CAAe,CAC9BtF,CAAW,CAACuF,GAAZ,CAAgB,WAAhB,CAA6BD,CAAI,CAAG,IAApC,CACH,CAFD,CAGAzG,CAAO,CAAC2G,kBAAR,CAA2B,SAASjF,CAAT,CAAe,CACtCqD,CAAQ,CAACrD,CAAI,CAACkF,WAAL,CAAiB1B,aAAlB,CACX,CAFD,EAGAtE,CAAO,CAAC8F,GAAR,CAAY,SAAZ,CAAuB,KAAvB,EACA9F,CAAO,CAAC+E,MAAR,GAAiBe,GAAjB,CAAqB,SAArB,CAAgC,GAAhC,EACA,KAAKpE,IAAL,CAAY,UAAW,CACnB1B,CAAO,CAACwD,MAAR,CAAe,MAAf,EACAlD,CAAQ,CAACiF,KAAT,EACH,CAHD,CAIA,KAAKU,IAAL,CAAY,UAAW,CACnB,GAAwB,WAApB,QAAOC,CAAAA,QAAX,CAAqC,CACjC9G,CAAO,CAAC+G,UAAR,CAAmB,CAAC,gCAAD,CAAnB,CAAuD,UAAW,CACPzG,CAAI,CAACuG,IAAL,EACH,CAFxD,EAGA,MACH,CACD3F,CAAQ,CAAG,GAAI4F,CAAAA,QAAJ,CAAa,CACpBE,IAAI,CAAE,EADc,CAEpBC,IAAI,CAAE,EAFc,CAGpBC,QAAQ,GAHY,CAIpBC,UAAU,GAJU,CAAb,CAAX,CAMAjG,CAAQ,CAACkG,EAAT,CAAY,MAAZ,CAAoB,SAAS1F,CAAT,CAAe,CAC/B,GAAInB,CAAE,EAAIA,CAAE,CAACwB,UAAH,EAAiBxB,CAAE,CAACyB,IAA9B,CAAoC,CAChCzB,CAAE,CAAC0B,IAAH,CAAQP,CAAR,CACH,CACJ,CAJD,EAKAR,CAAQ,CAACgF,IAAT,CAAc/E,CAAW,CAAC,CAAD,CAAzB,EACAD,CAAQ,CAAC0B,KAAT,GACA1B,CAAQ,CAACsC,SAAT,GACAtC,CAAQ,CAACmG,eAAT,CACI,SAASC,CAAT,CAAeC,CAAf,CAAuB,IACf7B,CAAAA,CAAM,CAAGvE,CAAW,CAACuE,MAAZ,EADM,CAEf8B,CAAM,CAAG5G,CAAO,CAAC6G,SAAR,EAFM,CAGfC,CAAU,CAAG9G,CAAO,CAAC+G,WAAR,EAHE,CAInB,GAAID,CAAU,EAAIhC,CAAlB,CAA0B,CACtB,MACH,CANkB,GAOfkC,CAAAA,CAAU,CAAGlC,CAAM,CAAG6B,CAPP,CAQftD,CAAG,CAAGqD,CAAI,CAAGM,CARE,CAUnB,GAAI3D,CAAG,EAAIuD,CAAP,EAAiBvD,CAAG,CAAIyD,CAAU,CAAGF,CAAb,CAAsBI,CAAlD,CAA+D,CAC3D,MACH,CACD,GAAI3D,CAAG,CAAGuD,CAAV,CAAkB,CACd5G,CAAO,CAAC6G,SAAR,CAAkBxD,CAAlB,CACH,CAFD,IAEO,CACHrD,CAAO,CAAC6G,SAAR,CAAmBxD,CAAG,CAAGyD,CAAP,CAAqB,EAAIE,CAA3C,CACH,CACJ,CAnBL,CAqBH,CA1CD,CA2CA,KAAKf,IAAL,EACH,CAzUoC,CA0UrClE,MAAM,CAACzC,WAAP,CAAqBA,CAArB,CACA,MAAOA,CAAAA,CACV,CAnVC,CAAN","sourcesContent":["// This file is part of VPL for Moodle - http://vpl.dis.ulpgc.es/\n//\n// VPL for Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// VPL for Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with VPL for Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Terminal control\n *\n * @package mod_vpl\n * @copyright 2014 Juan Carlos Rodríguez-del-Pino\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @author Juan Carlos Rodríguez-del-Pino <jcrodriguez@dis.ulpgc.es>\n */\n\n/* globals Terminal */\n\ndefine(\n    [\n        'jquery',\n        'jqueryui',\n        'mod_vpl/vplutil',\n        'mod_vpl/vplclipboard'\n    ],\n    function($, jqui, VPLUtil, VPLClipboard) {\n        if (typeof VPLTerminal !== 'undefined') {\n            return VPLTerminal;\n        }\n        var NTHEMES = 5;\n        var VPLTerminal = function(dialogId, terminalId, str) {\n            var self = this;\n            var ws = null;\n            var onCloseAction = VPLUtil.doNothing;\n            var title = '';\n            var message = '';\n            var tdialog = $('#' + dialogId);\n            var tIde = $('#vplide');\n            var titleText = '';\n            var clipboard = null;\n            var cliboardMaxsize = 64000;\n            var clipboardData = '';\n\n            var terminal;\n            var terminalTag = $('#' + terminalId);\n            this.updateTitle = function() {\n                var text = title;\n                if (message !== '') {\n                    text += ' (' + message + ')';\n                }\n                titleText.text(str('console') + \": \" + text);\n            };\n            this.setTitle = function(t) {\n                title = t;\n                this.updateTitle();\n            };\n            this.setMessage = function(t) {\n                message = t;\n                this.updateTitle();\n            };\n            /**\n             * Manages the data received from clipboard\n             * @param {string} data Data recieved\n             */\n            function receiveClipboard(data) {\n                clipboardData += data;\n                if (clipboardData.length > cliboardMaxsize) {\n                    var from = clipboardData.length - cliboardMaxsize / 2;\n                    clipboardData = clipboardData.substr(from);\n                }\n            }\n            /**\n             * Sends the clipboard data to the connection\n             */\n            function pasteClipboard() {\n                if (ws && ws.readyState == ws.OPEN) {\n                    ws.send(clipboard.getEntry2());\n                }\n            }\n            /**\n             * Updates the data in the clipboard dialog\n             */\n            function updateClipboard() {\n                clipboard.setEntry1(clipboardData);\n            }\n            /**\n             * Opens the clipboard dialog\n             */\n            function openClipboard() {\n                updateClipboard();\n                clipboard.show();\n            }\n            this.write = function(text) {\n                terminal.write(text);\n                return text;\n            };\n\n            this.connect = function(server, onClose) {\n                onCloseAction = onClose;\n                if (\"WebSocket\" in window) {\n                    terminal.reset();\n                    terminal.startBlink();\n                    self.show();\n                    if (ws) {\n                        ws.close();\n                    }\n                    clipboardData = '';\n                    self.setMessage('');\n                    self.setTitle(str('connecting'));\n                    ws = new WebSocket(server);\n                    ws.writeBuffer = '';\n                    ws.writeIt = function() {\n                        terminal.write(ws.writeBuffer);\n                        receiveClipboard(ws.writeBuffer);\n                        ws.writeBuffer = '';\n                    };\n                    ws.onmessage = function(event) {\n                        if (ws.writeBuffer.length > 0) {\n                            ws.writeBuffer += event.data;\n                        } else {\n                            ws.writeBuffer = event.data;\n                            setTimeout(ws.writeIt, 35);\n                        }\n                    };\n                    ws.onopen = function() {\n                        self.setMessage('');\n                        self.setTitle(str('connected'));\n                    };\n                    ws.onclose = function() {\n                        self.setTitle(str('connection_closed'));\n                        terminal.blur();\n                        terminal.stopBlink();\n                        onClose();\n                        ws.stopOutput = true;\n                    };\n                } else {\n                    terminal.write('WebSocket not available: Upgrade your browser');\n                }\n            };\n            this.writeLocal = function(text) {\n                ws.onmessage({\n                    data: text\n                });\n                return text;\n            };\n            this.setDataCallback = function(call) {\n                ws.onData = call;\n            };\n            this.closeLocal = function() {\n                if (ws) {\n                    ws.writeIt();\n                    ws.close();\n                    terminal.stopBlink();\n                    self.setTitle(str('connection_closed'));\n                }\n            };\n            this.connectLocal = function(onClose, onData) {\n                onCloseAction = onClose;\n                terminal.reset();\n                terminal.startBlink();\n                self.show();\n                if (ws) {\n                    ws.close();\n                }\n                clipboardData = '';\n                self.setMessage('');\n                self.setTitle(str('running'));\n                ws = {};\n                ws.onData = onData;\n                ws.writeBuffer = '';\n                ws.readBuffer = '';\n                ws.readyState = 1;\n                ws.OPEN = 1;\n                ws.close = function() {\n                    ws = false;\n                };\n                ws.onmessage = function(event) {\n                    ws.writeBuffer = event.data;\n                    ws.writeIt();\n                };\n                ws.writeIt = function() {\n                    if (ws) {\n                        terminal.write(ws.writeBuffer);\n                        receiveClipboard(ws.writeBuffer);\n                        ws.writeBuffer = '';\n                    }\n                };\n                ws.send = function(text) {\n                    // Process backspace.\n                    if (text == '\\u007f') {\n                        if (ws.readBuffer.length > 0) {\n                            self.writeLocal('\\b \\b');\n                            ws.readBuffer = ws.readBuffer.substr(0, ws.readBuffer.length - 1);\n                        }\n                    } else {\n                        self.writeLocal(text);\n                        ws.readBuffer += text;\n                    }\n                    var pos = ws.readBuffer.indexOf(\"\\r\");\n                    if (pos != -1) {\n                        var data = ws.readBuffer.substr(0, pos);\n                        ws.readBuffer = ws.readBuffer.substr(pos + 1);\n                        ws.onData(data);\n                    }\n                };\n            };\n            this.isOpen = function() {\n                return tdialog.dialog(\"isOpen\");\n            };\n            this.close = function() {\n                tdialog.dialog(\"close\");\n            };\n            this.isConnected = function() {\n                return ws && ws.readyState != ws.CLOSED;\n            };\n            this.disconnect = function() {\n                if (ws && ws.readyState == ws.OPEN) {\n                    onCloseAction();\n                    if (ws) {\n                        ws.close();\n                    }\n                    terminal.stopBlink();\n                }\n            };\n            var HTMLUpdateClipboard = VPLUtil.genIcon('copy', 'sw') + ' ' + str('copy');\n            var HTMLPaste = VPLUtil.genIcon('paste', 'sw') + ' ' + str('paste');\n            clipboard = new VPLClipboard('vpl_dialog_terminal_clipboard', HTMLUpdateClipboard, function() {\n                    updateClipboard();\n                    document.execCommand('copy');\n                }, HTMLPaste, pasteClipboard);\n            this.closeDialog = function() {\n                clipboard.hide();\n                self.disconnect();\n            };\n            /**\n             * Sets the terminal theme\n             * @param {int} theme\n             */\n            function setTheme(theme) {\n                var cbase = \"vpl_terminal_theme\";\n                var nthemes = 5;\n                tdialog.data('terminal_theme', theme);\n                VPLUtil.setUserPreferences({terminalTheme: theme});\n                for (var i = 0; i < nthemes; i++) {\n                    tdialog.removeClass(cbase + i);\n                }\n                tdialog.addClass(cbase + theme);\n            }\n            /**\n             * Limits the size of the dialogo to the IDE\n             */\n            function controlDialogSize() {\n                // Resize if dialog is large than screen.\n                var bw = tIde.width();\n                var bh = tIde.height();\n                if (tdialog.width() > bw) {\n                    tdialog.dialog(\"option\", \"width\", bw);\n                }\n                if (tdialog.parent().height() > bh) {\n                    tdialog.dialog(\"option\", \"height\", bh - tdialog.prev().outerHeight());\n                }\n            }\n            tdialog.dialog({\n                closeOnEscape: false,\n                autoOpen: false,\n                width: 'auto',\n                height: 'auto',\n                resizable: true,\n                dragStop: controlDialogSize,\n                open: controlDialogSize,\n                focus: function() {\n                    controlDialogSize();\n                    terminal.focus();\n                },\n                dialogClass: 'vpl_ide vpl_vnc',\n                create: function() {\n                    titleText = VPLUtil.setTitleBar(tdialog, 'console', 'console',\n                            ['clipboard', 'keyboard', 'theme'],\n                            [openClipboard,\n                            function() {\n                                terminal.focus();\n                            },\n                            function() {\n                                // Cycle themes from 0 to NTHEMES-1.\n                                var theme = (tdialog.data('terminal_theme') + 1) % NTHEMES;\n                                setTheme(theme);\n                            }]);\n                },\n                close: function() {\n                    self.closeDialog();\n                },\n                resizeStop: function() {\n                    tdialog.width(tdialog.parent().width());\n                    tdialog.height(tdialog.parent().height() - tdialog.prev().outerHeight());\n                    controlDialogSize();\n                    terminal.focus();\n                }\n            });\n            this.setFontSize = function(size) {\n                terminalTag.css(\"font-size\", size + \"px\");\n            };\n            VPLUtil.getUserPreferences(function(data) {\n                setTheme(data.preferences.terminalTheme);\n            });\n            tdialog.css(\"padding\", \"1px\");\n            tdialog.parent().css('z-index', 2000);\n            this.show = function() {\n                tdialog.dialog('open');\n                terminal.focus();\n            };\n            this.init = function() {\n                if (typeof Terminal === 'undefined') {\n                    VPLUtil.loadScript(['../../vpl/editor/xterm/term.js'], function() {\n                                                                               self.init();\n                                                                           });\n                    return;\n                }\n                terminal = new Terminal({\n                    cols: 80,\n                    rows: 24,\n                    useStyle: true,\n                    screenKeys: true\n                });\n                terminal.on('data', function(data) {\n                    if (ws && ws.readyState == ws.OPEN) {\n                        ws.send(data);\n                    }\n                });\n                terminal.open(terminalTag[0]);\n                terminal.reset();\n                terminal.stopBlink();\n                terminal.setLineCallback(\n                    function(line, nlines) {\n                        var height = terminalTag.height();\n                        var offset = tdialog.scrollTop();\n                        var viewHeight = tdialog.innerHeight();\n                        if (viewHeight >= height) {\n                            return;\n                        }\n                        var lineHeight = height / nlines;\n                        var pos = line * lineHeight;\n                        // If cursor in view area return.\n                        if (pos >= offset && pos < (viewHeight + offset - lineHeight)) {\n                            return;\n                        }\n                        if (pos < offset) { // If cursor beforer view area scroll to first view line.\n                            tdialog.scrollTop(pos);\n                        } else {\n                            tdialog.scrollTop((pos - viewHeight) + 2 * lineHeight);\n                        }\n                    }\n                );\n            };\n            this.init();\n        };\n        window.VPLTerminal = VPLTerminal;\n        return VPLTerminal;\n    }\n);\n"],"file":"vplterminal.min.js"}