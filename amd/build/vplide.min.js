function _typeof(e){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(e){return typeof e}}else{_typeof=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return _typeof(e)}define ("mod_vpl/vplide",["jquery","jqueryui","mod_vpl/vplutil","mod_vpl/vplidefile","mod_vpl/vplidebutton","mod_vpl/vplterminal","mod_vpl/vplvnc"],function(t,e,l,n,a,o,d){var s,r=function(e,c){var C=this,V,k,S,I,N,H,P=c.minfiles||0,W=c.maxfiles||0,O=c.restrictededitor||c.example,R=c.example,E=c.isTeacher,j=!1,D=l.scrollBarWidth(),B=l.str,q=t("#"+e);t("head").append("<meta name=\"viewport\" content=\"initial-scale=1\">").append("<meta name=\"viewport\" width=\"device-width\">").append("<link rel=\"stylesheet\" href=\"../editor/VPLIDE.css\"/>");if("object"!=_typeof(q)){throw new Error("VPL: constructor tag_id not found")}var K={new:!0,rename:!0,delete:!0,save:!0,run:!0,edit:!0,debug:!0,evaluate:!0,import:!0,resetfiles:!0,sort:!0,multidelete:!0,acetheme:!0,console:!0,comments:!0};if("undefined"==typeof c.loadajaxurl){c.loadajaxurl=c.ajaxurl}(function(){var e=P<W;c.new=e;c.rename=e;c.delete=e;c.comments=c.comments&&!c.example;c.acetheme=!0})();c.sort=2<=W-P;c.multidelete=c.sort;c.import=!O;var U=function(e){if(!K[e]){return!0}return c[e]};c.console=U("run")||U("debug");if("undefined"==typeof c.fontSize){c.fontSize=12}c.fontSize=parseInt(c.fontSize);function p(i){if(O){i.originalEvent.dataTransfer.dropEffect="none"}else{i.originalEvent.dataTransfer.dropEffect="copy"}i.preventDefault()}function u(i){if(O){i.stopImmediatePropagation();return!1}var e=i.originalEvent.dataTransfer;if(0<e.files.length){l.readSelectedFiles(e.files,function(e){return V.addFile(e,!0,N,I)},function(){V.fileListVisibleIfNeeded()});i.stopImmediatePropagation();return!1}return!1}q.on("drop",u);q.on("dragover",p);function g(i){if(O){i.stopPropagation();return!1}return!0}var G=t("#vpl_menu"),X=new a(G,U),Y=t("#vpl_tr"),r=t("#vpl_filelist"),Q=t("#vpl_filelist_header"),J=t("#vpl_filelist_content"),Z=t("#vpl_tabs_ul"),$=t("#vpl_tabs"),ee=t("#vpl_results"),ie=t("#vpl_results_accordion");r.vplMinWidth=80;ee.vplMinWidth=100;function m(e,i){if("newHeader"in i){if(i.newHeader.hasClass("vpl_ide_accordion_t_grade")){return!1}}return!0}function h(){var a=t("#vpl_tabs_ul");t("#vpl_tabs").tabs();var o=t("#vpl_tabs").tabs("widget"),d=[],m=[],h=!0,f=this;(function(){var e;f.setVersion=function(i){e=i};f.getVersion=function(){return e}})();this.updateFileList=function(){f.generateFileList()};this.fileNameExists=function(e){for(var t=e.toLowerCase(),l=0;l<d.length;l++){if(d[l].getFileName().toLowerCase()==t){return l}}return-1};function e(e){for(var t=e.toLowerCase()+"/",l=0,n;l<d.length;l++){n=d[l].getFileName().toLowerCase()+"/";if(0===n.indexOf(t)||0===t.indexOf(n)){return!0}}return!1}function i(e,t){if(l.isBlockly(e)){return!1}if(l.isBlockly(t)){for(var n=0;n<d.length;n++){if(l.isBlockly(d[n].getFileName())){return!0}}}return!1}this.restrictedPaste=g;this.dropHandler=u;this.dragoverHandler=p;this.readOnly=R;this.restrictedEdit=O;this.adjustTabsTitles=k;this.minNumberOfFiles=P;this.scrollBarWidth=D;var v="";this.setClipboard=function(e){v=e};this.getClipboard=function(){return v};this.getTabPos=function(e){for(var t=0;t<m.length;t++){if(m[t]==e){return t}}return m.length};this.getTheme=function(){return c.theme};this.setTheme=function(e){c.theme=e;for(var t=0;t<d.length;t++){d[t].setTheme(e)}};this.addTab=function(e){a.append("<li id=\"vpl_tab_name"+e+"\">"+("<a href=\"#vpl_file"+e+"\"></a>")+"</li>");o.append("<div id=\"vpl_file"+e+"\" class=\"vpl_ide_file\"></div>")};this.removeTab=function(e){a.find("#vpl_tab_name"+e).remove();o.find("#vpl_file"+e).remove()};this.open=function(e){var i;if("object"==_typeof(e)){i=e}else{i=d[e]}if(i.isOpen()){return}var t=i.getId();f.addTab(t);m.push(i);X.setGetkeys(i.open());o.tabs("refresh");k(!1);l.delay("updateFileList",f.updateFileList);l.delay("updateMenu",N)};this.close=function(e){if(!e.isOpen()){return}var i,t=e.getId();e.close();f.removeTab(t);var n=f.getTabPos(e);m.splice(n,1);o.tabs("refresh");k(!1);f.fileListVisible(!0);l.delay("updateFileList",f.updateFileList);l.delay("adjustTabsTitles",k,!1);if(m.length>n){i=f.getFilePosById(m[n].getId());f.gotoFile(i,"c");return}if(0<n){i=f.getFilePosById(m[n-1].getId());f.gotoFile(i,"c")}};this.isClosed=function(e){return!d[e].isOpen()};this.fileListVisible=function(e){if(e===r.vplVisible){return}if(e){l.delay("fileListVisible",function(){r.vplVisible=!0;f.updateFileList();r.show();S()})}else{l.delay("fileListVisible",function(){r.vplVisible=!1;r.hide();S()})}};this.isFileListVisible=function(){return r.vplVisible};this.fileListVisibleIfNeeded=function(){if(this.isFileListVisible()){return}for(var e=0;e<d.length;e++){if(!d[e].isOpen()){this.fileListVisible(!0);return}}};this.setFontSize=function(e){c.fontSize=e;for(var t=0;t<d.length;t++){d[t].setFontSize(e)}we.setFontSize(e)};this.getFontSize=function(){return c.fontSize};this.addFile=function(t,a,o,r){if("string"!=typeof t.name||!l.validPath(t.name)){r(B("incorrect_file_name")+" ("+t.name+")");return!1}if(!0!==a){a=!1}var c=this.fileNameExists(t.name);if(-1!=c){if(a){d[c].setContent(t.contents);f.setModified();o();l.delay("updateFileList",f.updateFileList);return t}else{r(B("filenotadded",t.name));return!1}}if(e(t.name)||i("",t.name)){r(B("filenotadded",t.name));return!1}if(d.length>=W){r(B("maxfilesexceeded")+" ("+W+")");return!1}var p=l.getUniqueId(),u=new n(p,t.name,t.contents,this,s);if(1==t.encoding){u.extendToBinary()}else{if(l.isBlockly(t.name)){u.extendToBlockly()}else{u.extendToCodeEditor()}}u.setFileName(t.name);d.push(u);f.setModified();if(5<d.length){f.fileListVisible(!0)}o();return u};this.renameFile=function(t,n,a){var o=this.fileNameExists(t);try{if(-1==o){throw new Error("Internal error: File name not found")}if(o<P){throw new Error("Internal error: Renaming requested filename")}if(d[o].getFileName()==n){return!0}if(!l.validPath(n)||e(n)||i(t,n)){throw B("incorrect_file_name")}if(l.isBinary(t)&&l.fileExtension(t)!=l.fileExtension(n)){throw B("incorrect_file_name")}if(l.isBlockly(t)!=l.isBlockly(n)){throw B("incorrect_file_name")}d[o].setFileName(n)}catch(i){a(B("filenotrenamed",n)+": "+i);return!1}f.setModified();k(!1);l.delay("updateFileList",f.updateFileList);return!0};this.deleteFile=function(e,i,t){var n=this.fileNameExists(e);if(-1==n){t(B("filenotdeleted",e));return!1}if(n<P){t(B("filenotdeleted",e));return!1}f.setModified();f.close(d[n]);d.splice(n,1);l.delay("updateFileList",f.updateFileList);return!0};this.currentFile=function(){var e=o.tabs("option","active");if(e in m){var i=m[e];if(0===arguments.length){return i}var t=arguments[0];if("function"==typeof i[t]){var l=i[t],n=Array.prototype.slice(arguments);n.shift();return l.apply(i,n)}}return!1};this.currentPos=function(){return o.tabs("option","active")};this.getFileTab=function(e){for(var t=0;t<m.length;t++){if(m[t].getId()==e){return t}}return-1};this.getFilePosById=function(e){for(var t=0;t<d.length;t++){if(d[t].getId()==e){return t}}return-1};this.gotoFile=function(e,i){var t=d[e];f.open(t);o.tabs("option","active",f.getFileTab(t.getId()));if("c"!==i){t.gotoLine(parseInt(i,10))}t.focus()};this.gotoFileLink=function(e){var i=t(e),l=i.data("file"),n=-1;if(""<l){n=this.fileNameExists(l)}else{n=f.getFilePosById(i.data("fileid"))}if(0<=n){var a=i.data("line");if("undefined"==typeof a){a="c"}f.gotoFile(n,a);return!0}return!1};this.getFilesToSave=function(){for(var e=[],t=0,l;t<d.length;t++){l={};l.name=d[t].getFileName();l.contents=d[t].getContent();l.encoding=d[t].isBinary()?1:0;e.push(l)}return e};this.resetModified=function(){h=!1;for(var e=0;e<d.length;e++){d[e].resetModified()}l.delay("updateMenu",N);l.delay("updateFileList",f.updateFileList)};this.setModified=function(){h=!0;l.delay("updateFileList",f.updateFileList);l.delay("updateMenu",N)};this.isModified=function(){return h};this.length=function(){return d.length};this.clearAnnotations=function(){for(var e=0;e<d.length;e++){d[e].clearAnnotations()}};this.getFile=function(e){return d[e]};this.getFiles=function(){return d};this.getDirectoryStructure=function(){var t={isDir:!0,content:{}};function e(e){var i=d[e],l=i.getFileName(),n=l.split("/"),a=t;for(var o in n){if(n.hasOwnProperty(o)){var s=n[o];if(o==n.length-1){a.content[s]={isDir:!1,content:i,pos:e}}else{if(!a.content[s]){a.content[s]={isDir:!0,content:{}}}a=a.content[s]}}}}for(var l in d){if(d.hasOwnProperty(l)){e(l)}}return t};this.generateFileList=function(){if(!f.isFileListVisible()){return}function e(i,t,n){for(var a in i.content){if(i.content.hasOwnProperty(a)){var o=i.content[a];if(o.isDir){n.push(t+l.iconFolder()+l.sanitizeText(a));e(o,t+"<span class=\"vpl_ide_dirindent\"></span>",n)}else{var d=o.content,s=l.sanitizeText(a),r=l.sanitizeText(d.getFileName());if(d.isOpen()){s="<b>"+s+"</b>"}var c="href=\"#\" data-fileid=\""+d.getId()+"\" title=\""+r+"\"",p="<a "+c+">"+s+"</a>";if(d.isModified()){p=l.iconModified()+p}if(o.pos<P){p=p+l.iconRequired()}n.push(t+p)}}}}var t=f.getDirectoryStructure(),n=[],a="";e(t,"",n);for(var o=0;o<n.length;o++){a+=n[o]+"<br>"}J.html("<div>"+a+"</div>")};a.on("click","span.vpl_ide_closeicon",function(){V.close(V.currentFile())});a.on("dblclick","span.vpl_ide_closeicon",X.getAction("delete"));a.on("dblclick","a",X.getAction("rename"));J.on("dblclick","a",X.getAction("rename"))}this.updateEvaluationNumber=function(e){if("undefined"!=typeof e.nevaluations){var i=e.nevaluations;if("undefined"!=typeof e.reductionbyevaluation&&""<e.reductionbyevaluation&&0!=e.reductionbyevaluation){if(0!=e.freeevaluations){i=i+"/"+e.freeevaluations}i=i+" -"+e.reductionbyevaluation}X.setExtracontent("evaluate",i)}};this.lastResult=null;this.getTerminal=function(){return we};this.setResultGrade=function(e,i){var t="vpl_ide_accordion_t_grade",l="vpl_ide_accordion_c_grade";if(0==ie.find("."+l).length){ie.append("<div class=\""+t+"\"></div>");ie.append("<div class=\""+l+"\"></div>")}if("undefined"==typeof i){return 0<ie.find("h4."+t).length}var n=ie.find("."+t);if(""<e){n.replaceWith("<h4 class=\""+t+"\">"+e+"</h4>");return!0}else{n.replaceWith("<div class=\""+t+"\"></div>");return!1}};this.setResultTab=function(e,i,l){var n="vpl_ide_accordion_t_"+e,a="vpl_ide_accordion_c_"+e;if(0==ie.find("."+a).length){ie.append("<div class=\""+n+"\"></div>");ie.append("<div class=\""+a+"\"></div>")}if("undefined"==typeof l){return 0<ie.find("h4."+n).length}var o=ie.find("."+n),d=ie.find("."+a),s=t("<div>"+i+"</div>");s.find("h4").replaceWith(function(){return t("<h5>").append(t(this).contents())});if(d.html()==s.html()){return""<i}if(""<i){o.replaceWith("<h4 class=\""+n+"\">"+B(e)+"</h4>");d.replaceWith("<div class=\"ui-widget "+a+"\">"+s.html()+"</div>");return!0}else{o.replaceWith("<div class=\""+n+"\"></div>");d.replaceWith("<div class=\""+a+"\"></div>");return!1}};this.setResult=function(e,t){C.updateEvaluationNumber(e);var n=V.getFiles(),a=[],o;for(o=0;o<n.length;o++){a[o]=n[o].getFileName();n[o].clearAnnotations()}var d=!1,s,r=l.sanitizeText(e.grade),c,p;c=C.setResultGrade(r,e.grade);d=d||c;s=C.setResultTab("variables",e.variables,e.variables);d=d||s;p=l.processResult(e.compilation,a,n,!0,!1);s=C.setResultTab("compilation",p,e.compilation);d=d||s;p=l.processResult(e.evaluation,a,n,!1,!1);s=C.setResultTab("comments",p,e.evaluation);d=d||s;p=l.sanitizeText(e.execution);s=C.setResultTab("execution",p,e.execution);d=d||s;s=C.setResultTab("description",window.VPLDescription,window.VPLDescription);if(s&&"object"==("undefined"==typeof MathJax?"undefined":_typeof(MathJax))){var u=ie.find(".vpl_ide_accordion_c_description")[0];MathJax.Hub.Queue(["Typeset",MathJax.Hub,u])}d=d||s;if(d){ee.show();ee.vplVisible=!0;ie.accordion("refresh");ie.accordion("option","active",c?1:0);for(o=0;o<n.length;o++){for(var g=n[o].getAnnotations(),m=0;m<g.length;m++){if(t||"error"==g[m].type){V.gotoFile(o,g[m].row+1);break}}}}else{ee.hide();ee.vplVisible=!1}l.delay("autoResizeTab",S)};ie.accordion({heightStyle:"fill",header:"h4",animate:!1,beforeActivate:m});ee.width(2*ee.vplMinWidth);ie.on("click","a",function(e){if(V.gotoFileLink(e.currentTarget)){e.preventDefault()}});ee.vplVisible=!1;ee.hide();r.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all");Q.text(B("filelist"));Q.html(l.iconFolder()+Q.html());Q.addClass("ui-widget-header ui-button-text-only ui-corner-all");J.addClass("ui-widget ui-corner-all");r.width(2*r.vplMinWidth);r.on("click","a",function(e){e.preventDefault();V.gotoFileLink(e.currentTarget)});r.vplVisible=!1;r.hide();var te=!1;function f(){if(!1===te){te=($.outerWidth(!0)-$.width())/2}return te}function v(i,e){var t=e.position.left-e.originalPosition.left,l;if(0!=t){l=$.width()+r.width()-r.vplMinWidth;$.resizable("option","maxWidth",l);r.width(r.vplOriginalWidth+t)}else{l=$.width()+ee.width()-ee.vplMinWidth;$.resizable("option","maxWidth",l);var n=e.size.width-e.originalSize.width;ee.width(ee.vplOriginalWidth-n)}V.currentFile("adjustSize")}var le={containment:"parent",resize:v,start:function start(){t(window).off("resize",S);$.resizable("option","minWidth",100);if(ee.vplVisible){ee.vplOriginalWidth=ee.width()}if(r.vplVisible){r.vplOriginalWidth=r.width()}},stop:function stop(i,e){v(i,e);$.resizable("option","maxWidth",1e5);$.resizable("option","minWidth",0);S();t(window).on("resize",S)},handles:""};$.resizable(le);function _(){var e=0;e+=r.vplVisible?1:0;e+=ee.vplVisible?2:0;$.resizable("destroy");le.handles=["e","w","e","e, w"][e];le.disable=0===e;$.resizable(le)}function b(){var e=t(window).outerHeight();e-=G.offset().top+G.height()+(j?f():20);if(150>e){e=150}Y.height(e);var i=e-3*f();$.height(i);if(ee.vplVisible){ee.height(i+f());ie.accordion("refresh")}if(r.vplVisible){J.height(i-(Q.outerHeight()+f()));r.height(i)}}k=function(e){var i=$.width(),l=0;Z.width(1e5);var n=Z.children("li:visible").last();if(n.length){var a=Z.parent().scrollLeft();l=a+n.position().left+n.width()+te;Z.width(l);var o=V.currentFile();if(o&&e){var d=t(o.getTabNameId()),s=a+d.position().left;s-=(i-d.outerWidth())/2;if(0>s){s=0}Z.parent().finish().animate({scrollLeft:s},"slow")}}if(l<i){Z.width("")}};S=function(){var e=$.width(),i=G.width(),t=!1;_();Y.width(G.outerWidth());if(r.vplVisible){var l=r.outerWidth()+te;e+=l;if(100<=l){i-=l;$.css("left",l)}else{t=!0}}else{$.css("left",0)}if(ee.vplVisible){var n=ee.outerWidth()+te;e+=n;i-=n;if(100>i){t=!0}}if(t){var a=G.width()/e,o=0;if(r.vplVisible){o=r.width()*a;r.width(o-te);o+=te;$.css("left",o)}$.width($.width()*a);if(ee.vplVisible){ee.width(G.width()-(o+$.width()+te))}}else{$.width(i)}k(!0);b();V.currentFile("adjustSize")};function F(){V.currentFile("focus")}var ne=t.extend({},{close:F},l.dialogbaseOptions);function T(e,i){return l.showMessage(e,t.extend({},ne,i))}I=function(e){return l.showErrorMessage(e,{close:F})};var ae=t("#vpl_ide_dialog_new");function w(e){if(!("click"==e.type||"keypress"==e.type&&13==e.keyCode)){return!0}ae.dialog("close");var i={name:t("#vpl_ide_input_newfilename").val(),contents:"",encoding:0},l=V.addFile(i,!1,N,I);if(l){V.open(l);$.tabs("option","active",V.getTabPos(l));l.focus();return!0}return!1}var oe={};oe[B("ok")]=w;oe[B("cancel")]=function(){t(this).dialog("close")};ae.find("input").on("keypress",w);ae.dialog(t.extend({},ne,{title:B("create_new_file"),buttons:oe}));l.setDialogTitleIcon(ae,"new");var de=t("#vpl_ide_dialog_rename");function y(e){if(!("click"==e.type||"keypress"==e.type&&13==e.keyCode)){return}de.dialog("close");V.renameFile(V.currentFile("getFileName"),t("#vpl_ide_input_renamefilename").val(),I);e.preventDefault()}de.find("input").on("keypress",y);oe[B("ok")]=y;de.dialog(t.extend({},ne,{open:function open(){t("#vpl_ide_input_renamefilename").val(V.currentFile("getFileName"))},title:B("rename_file"),buttons:oe}));l.setDialogTitleIcon(de,"rename");oe[B("ok")]=function(){t(this).dialog("close")};var se=t("#vpl_ide_dialog_comments");se.dialog(t.extend({},ne,{title:B("comments"),width:"40em",buttons:oe}));l.setDialogTitleIcon(se,"comments");t("#vpl_ide_input_comments").width("30em");var re=t("#vpl_ide_dialog_about"),ce={};ce[B("ok")]=function(){t(this).dialog("close")};var pe=t("#vpl_ide_dialog_shortcuts");pe.dialog(t.extend({},ne,{open:function open(){var e=X.getShortcuts(V.currentFile("getEditor"));t("#vpl_ide_dialog_shortcuts").html(e)},title:B("shortcuts"),width:400,height:300,buttons:ce}));pe.dialog("option","height",300);l.setDialogTitleIcon(pe,"shortcuts");ce[B("shortcuts")]=function(){t(this).dialog("close");pe.dialog("open")};re.dialog(t.extend({},ne,{open:function open(){var e=X.getShortcuts(V.currentFile("getEditor"));re.next().find("button").filter(function(){return t(this).text()==B("shortcuts")}).button(""!=e?"enable":"disable")},title:B("about"),width:400,height:300,buttons:ce}));re.dialog("option","height",300);l.setDialogTitleIcon(re,"about");var ue=t("#vpl_ide_dialog_sort"),ge={};ge[B("ok")]=function(){var e=V.getFiles(),l=[],n=0,a=t("#vpl_sort_list li");if(a.length!=e.length){return}a.each(function(){var i=parseInt(this.id.replace(/[^\d]*/,""));l.push(e[i])});for(n=0;n<a.length;n++){e[n]=l[n]}V.setModified();t(this).dialog("close")};ge[B("cancel")]=function(){t(this).dialog("close")};ue.dialog(t.extend({},ne,{title:B("sort"),buttons:ge,open:function open(){var e=t("#vpl_sort_list");e.html("");for(var l=V.getFiles(),n=0,a;n<l.length;n++){a=t("<li id=\"vpl_fsort_"+n+"\"class=\"ui-widget-content\"></li>");if(n<P){a.addClass("ui-state-disabled")}a.text(n+1+"-"+l[n].getFileName());e.append(a)}e.sortable({items:"li:not(.ui-state-disabled)",placeholder:"ui-state-highlight",start:function start(e,i){i.item.addClass("ui-state-highlight")},stop:function stop(e,i){i.item.removeClass("ui-state-highlight")}});e.disableSelection()},maxHeight:400}));l.setDialogTitleIcon(ue,"sort");var me=t("#vpl_ide_dialog_multidelete"),he={};he[B("selectall")]=function(){t(this).find("input").prop("checked",!0)};he[B("deselectall")]=function(){t(this).find("input").prop("checked",!1)};he[B("deleteselected")]=function(){var e=V.getFiles(),n=[],a=t("#vpl_multidelete_list label");a.each(function(){var i=t(this);if(i.find("input").prop("checked")){var l=i.data("fileid");n.push(e[l].getFileName())}});for(var o=0;o<n.length;o++){V.deleteFile(n[o],!1,I)}l.delay("updateMenu",N);l.delay("updateFileList",V.updateFileList);t(this).dialog("close")};he[B("cancel")]=function(){t(this).dialog("close")};me.dialog(t.extend({},ne,{title:B("multidelete"),buttons:he,open:function open(){var e=t("#vpl_multidelete_list");e.html("");for(var n=V.getFiles(),a=P;a<n.length;a++){var o=l.sanitizeText(n[a].getFileName()),d=t("<label><input type=\"checkbox\"> "+o+"</label>");d.data("fileid",a);e.append(d);e.append("<br>")}e.find("label").button()},maxHeight:400,maxWidth:400}));l.setDialogTitleIcon(me,"multidelete");var fe=t("#vpl_ide_dialog_fontsize"),ve=t("#vpl_ide_dialog_fontsize .vpl_fontsize_slider"),_e={};_e[B("ok")]=function(){var e=ve.slider("value");V.setFontSize(e);t(this).dialog("close");t.ajax({async:!0,type:"POST",url:"../editor/userpreferences.json.php",data:JSON.stringify({fontSize:e}),contentType:"application/json; charset=utf-8",dataType:"json"})};_e[B("cancel")]=function(){V.setFontSize(ve.data("vpl_fontsize"));t(this).dialog("close")};_e[B("reset")]=function(){ve.slider("value",12)};fe.dialog(t.extend({},ne,{title:B("fontsize"),buttons:_e,open:function open(){ve.data("vpl_fontsize",V.getFontSize());ve.slider("value",V.getFontSize())}}));ve.slider({min:1,max:48,change:function change(){var e=ve.slider("value");V.setFontSize(e);fe.find(".vpl_fontsize_slider_value").text(e)}});l.setDialogTitleIcon(fe,"fontsize");var be=t("#vpl_ide_dialog_acetheme"),Fe=t("#vpl_ide_dialog_acetheme select"),Te={};Te[B("ok")]=function(){V.setTheme(Fe.val());t(this).dialog("close");l.setUserPreferences({aceTheme:Fe.val()})};Te[B("cancel")]=function(){V.setTheme(Fe.data("acetheme"));t(this).dialog("close")};Te[B("reset")]=function(){Fe.val(Fe.data("acetheme"));V.setTheme(Fe.val())};be.dialog(t.extend({},ne,{title:B("theme"),buttons:Te,modal:!1,open:function open(){Fe.data("acetheme",V.getTheme());Fe.val(V.getTheme())}}));Fe.on("change",function(){V.setTheme(Fe.val())});l.setDialogTitleIcon(be,"theme");var we=new o("vpl_dialog_terminal","vpl_terminal",B),ye=new d("vpl_dialog_vnc",B),xe=we,Le=t("#vpl_ide_input_file");Le.on("change",function fileSelectHandler(){l.readSelectedFiles(this.files,function(e){return V.addFile(e,!0,N,I)},function(){V.fileListVisibleIfNeeded()})});X.add({name:"filelist",originalAction:function originalAction(){V.fileListVisible(!V.isFileListVisible());l.delay("updateMenu",N);l.delay("autoResizeTab",S);l.delay("updateFileList",V.updateFileList)},bindKey:{win:"Ctrl-L",mac:"Ctrl-L"}});X.add({name:"new",originalAction:function originalAction(){if(V.length()<W){ae.dialog("open")}},bindKey:{win:"Alt-N",mac:"Option-N"}});X.add({name:"rename",originalAction:function originalAction(){var e=V.currentFile();if(e&&V.getFilePosById(e.getId())>=P){de.dialog("open")}},bindKey:{win:"Ctrl-R",mac:"Ctrl-R"}});X.add({name:"delete",originalAction:function originalAction(){var e=V.currentFile();if(!e){return}var i=e.getFileName(),t=B("delete_file_fq",i);T(t,{ok:function ok(){V.deleteFile(i,I)},title:B("delete_file_q"),icon:"trash"})},bindKey:{win:"Ctrl-D",mac:"Ctrl-D"}});X.add({name:"close",originalAction:function originalAction(){var e=V.currentFile();if(!e){return}V.close(e)},bindKey:{win:"Alt-W",mac:"Option-W"}});X.add({name:"import",originalAction:function originalAction(){Le.val("");Le.trigger("click")},bindKey:{win:"Ctrl-I",mac:"Ctrl-I"}});X.add({name:"sort",originalAction:function originalAction(){ue.dialog("open")},bindKey:{win:"Ctrl-O",mac:"Ctrl-O"}});X.add({name:"multidelete",originalAction:function originalAction(){me.dialog("open")}});X.add({name:"fontsize",originalAction:function originalAction(){fe.dialog("open")}});X.add({name:"theme",originalAction:function originalAction(){be.dialog("open")}});X.add({name:"print",originalAction:function originalAction(){window.print()},bindKey:{win:"Alt-P",mac:"Command-P"}});X.add({name:"undo",originalAction:function originalAction(){V.currentFile("undo")}});X.add({name:"redo",originalAction:function originalAction(){V.currentFile("redo")}});X.add({name:"select_all",editorName:"selectall",originalAction:function originalAction(){V.currentFile("selectAll")}});X.add({name:"find",originalAction:function originalAction(){V.currentFile("find")}});X.add({name:"find_replace",editorName:"replace",originalAction:function originalAction(){V.currentFile("replace")}});X.add({name:"next",editorName:"findnext",originalAction:function originalAction(){V.currentFile("next")}});X.add({name:"fullscreen",originalAction:function originalAction(){var e="header, nav, footer, aside, .dropdown, #page-header, div.navbar, #nav-drawer";e+=", div.tabtree, #dock, .breadcrumb-nav, .moodle-actionmenu";if(j){q.removeClass("vpl_ide_root_fullscreen");t("body").removeClass("vpl_body_fullscreen");X.setText("fullscreen","fullscreen");t(e).show();t("#vpl_ide_user").hide();j=!1}else{t("body").addClass("vpl_body_fullscreen").scrollTop(0);t(e).hide();q.addClass("vpl_ide_root_fullscreen");X.setText("fullscreen","regularscreen");if(c.username){t("#vpl_ide_user").show()}j=!0}F();setTimeout(S,10)},bindKey:{win:"Alt-F",mac:"Ctrl-F"}});X.add({name:"download",originalAction:function originalAction(){window.location=c.download}});function x(){l.requestAction("resetfiles","",{},c.ajaxurl).done(function(e){var i=e.files;for(var t in i){if(i.hasOwnProperty(t)){V.addFile(i[t],!0,l.doNothing,I)}}V.fileListVisibleIfNeeded();l.delay("updateMenu",N)}).fail(I)}X.add({name:"resetfiles",originalAction:function originalAction(){T(B("sureresetfiles"),{title:B("resetfiles"),ok:x,icon:"resetfiles"})}});X.add({name:"save",originalAction:function originalAction(){var i={files:V.getFilesToSave(),comments:t("#vpl_ide_input_comments").val(),version:V.getVersion()};if(JSON.stringify(i).length>c.postMaxSize){I(B("maxpostsizeexceeded"));return}function e(){l.requestAction("save","saving",i,c.ajaxurl).done(function(t){if(t.requestsconfirmation){T(t.question,{title:B("saving"),icon:"alert",yes:function yes(){i.version=t.version;e()}})}else{V.resetModified();V.setVersion(t.version);X.setTimeLeft(t);l.delay("updateMenu",N);if(l.monitorRunning()){l.requestAction("update","updating",i,c.ajaxurl)}}}).fail(I)}e()},bindKey:{win:"Ctrl-S",mac:"Command-S"}});function L(e,i,t){if(!t){t={}}if(!xe.isConnected()){l.requestAction(e,"",t,c.ajaxurl).done(function(t){l.webSocketMonitor(t,e,i,H)}).fail(I)}}function M(){L("run","running",{XGEOMETRY:ye.getCanvasSize()})}X.add({name:"run",originalAction:function originalAction(){H.setLastAction(M);M()},bindKey:{win:"Ctrl-F11",mac:"Command-U"}});function A(){L("debug","debugging",{XGEOMETRY:ye.getCanvasSize()})}X.add({name:"debug",originalAction:function originalAction(){H.setLastAction(A);A()},bindKey:{win:"Alt-F11",mac:"Option-U"}});function z(){L("evaluate","evaluating")}X.add({name:"evaluate",originalAction:function originalAction(){H.setLastAction(z);z()},bindKey:{win:"Shift-F11",mac:"Command-Option-U"}});X.add({name:"comments",originalAction:function originalAction(){se.dialog("open")}});X.add({name:"console",originalAction:function originalAction(){if(xe.isOpen()){xe.close()}else{xe.show()}}});X.add({name:"user"});X.add({name:"about",originalAction:function originalAction(){re.dialog("open")}});X.add({name:"timeleft",originalAction:function originalAction(){X.toggleTimeLeft()}});X.add({name:"more",originalAction:function originalAction(){var e=t("#vpl_ide_menuextra");if(e.is(":visible")){X.setText("more","more",l.str("more"));e.hide()}else{X.setText("more","less",l.str("less"));e.show()}l.delay("updateMenu",N);l.delay("autoResizeTab",S)}});G.addClass("ui-widget-header ui-corner-all");var Me="";Me+=X.getHTML("more");Me+=X.getHTML("save");Me+="<span id='vpl_ide_mexecution'>";Me+=X.getHTML("run");Me+=X.getHTML("debug");Me+=X.getHTML("evaluate");Me+=X.getHTML("comments");Me+=X.getHTML("console");Me+="</span> ";Me+="<span id='vpl_ide_menuextra'>";Me+="<span id='vpl_ide_file'>";Me+=X.getHTML("filelist");Me+=X.getHTML("new");Me+=X.getHTML("rename");Me+=X.getHTML("delete");Me+=X.getHTML("import");Me+=X.getHTML("download");Me+=X.getHTML("resetfiles");Me+=X.getHTML("sort");Me+=X.getHTML("multidelete");Me+=X.getHTML("fontsize");Me+=X.getHTML("theme");Me+="</span> ";Me+="<span id='vpl_ide_edit'>";Me+=X.getHTML("undo");Me+=X.getHTML("redo");Me+=X.getHTML("select_all");Me+=X.getHTML("find");Me+=X.getHTML("find_replace");Me+=X.getHTML("next");Me+="</span> ";Me+="</span> ";Me+=X.getHTML("fullscreen")+" ";Me+=X.getHTML("about")+" ";Me+=X.getHTML("user")+" ";Me+=X.getHTML("timeleft");Me+="<div class=\"clearfix\"></div>";G.append(Me);t("#vpl_ide_more").button();t("#vpl_ide_save").button();t("#vpl_ide_menuextra").hide();t("#vpl_ide_file").controlgroup();t("#vpl_ide_edit").controlgroup();t("#vpl_ide_mexecution").controlgroup();t("#vpl_ide_fullscreen").button();t("#vpl_ide_acetheme").button();t("#vpl_ide_about").button();t("#vpl_ide_user").button().css("float","right").hide();t("#vpl_ide_timeleft").button().css("float","right").hide();t("#vpl_menu .ui-button").css("padding","6px");t("#vpl_menu .ui-button-text").css("padding","0");for(var Ae=["filelist","more","fullscreen","about","resetfiles","download","comments","console","import","fontsize","timeleft"],ze=0;ze<Ae.length;ze++){X.enable(Ae[ze],!0)}X.setExtracontent("user",c.username);X.setTimeLeft(c);N=function(){var e,t=V.currentFile(),n=V.length();if(n){$.show()}else{$.hide()}if(V.isFileListVisible()){X.setText("filelist","filelistclose",l.str("filelist"))}else{X.setText("filelist","filelist",l.str("filelist"))}var a=V.isModified();X.enable("save",a);var o=l.monitorRunning();if(o){X.setText("run","running")}else{X.setText("run","run")}X.enable("run",!o&&(!a||c.example)&&U("run"));X.enable("debug",!o&&(!a||c.example)&&U("debug"));X.enable("evaluate",!o&&(!a||c.example)&&U("evaluate"));X.enable("download",!a);X.enable("new",n<W);X.enable("sort",1<n-P);X.enable("multidelete",1<n-P);X.enable("theme",!0);var d;if(!t||0===n){d=["rename","delete","undo","redo","select_all","find","find_replace","next"];for(e=0;e<d.length;e++){X.enable(d[e],!1)}return}var s=V.getFilePosById(t.getId());X.enable("rename",s>=P&&0!==n);X.enable("delete",s>=P&&0!==n);X.enable("undo",t.hasUndo());X.enable("redo",t.hasRedo());X.enable("select_all",t.hasSelectAll());X.enable("find",t.hasFind());X.enable("find_replace",t.hasFindReplace());X.enable("next",t.hasNext());l.delay("updateFileList",V.updateFileList)};H={open:N,close:N,getConsole:function getConsole(){return xe},setResult:C.setResult,ajaxurl:c.ajaxurl,run:function run(e,i,n){var a=/^([^:]*):?(.*)/i.exec(e),o=a[1];if("terminal"==o||"webterminal"==o){if(xe&&xe.isOpen()){xe.close()}xe=we;we.connect(i.executionURL,function(){n.close();F()});if("webterminal"==o){var d=(i.secure?"https":"http")+"://"+i.server+":"+i.portToUse;d+="/favicon.ico";var s=t("<img>");s.attr("src",d);s.attr("style","display:none");t("body").append(s)}}else if("vnc"==o){if(xe&&xe.isOpen()){xe.close()}xe=ye;ye.connect(i.secure,i.server,i.portToUse,i.VNCpassword,i.executionPath,function(){n.close();F()})}else if("browser"==o){var r=(i.secure?"https":"http")+"://"+i.server+":"+i.portToUse+"/";r+=a[2]+"/httpPassthrough";if(E){r+="?private"}var c="<a href=\""+r+"\" target=\"_blank\">";c+=l.str("open")+"</a>";var p={width:200,icon:"run",title:l.str("run")};T(c,p)}else{l.log("Type of run error "+e,!0)}},lastAction:!1,getLastAction:function getLastAction(){var e=this.lastAction;this.lastAction=!1;return e},setLastAction:function setLastAction(e){this.lastAction=e}};$.on("tabsactivate",function(){V.currentFile("focus");l.delay("updateMenu",N);l.delay("autoResizeTab",S)});var Ce=t(window);Ce.on("resize",S);if(!c.example){Ce.on("beforeunload",function(){if(V.isModified()){return B("changesNotSaved")}})}V=new h;S();(function(){var i=G.width();function e(){var e=G.width();if(i!=e){i=e;S()}}e();setInterval(e,1e3)})();V.resetModified();l.requestAction("load","loading",c,c.loadajaxurl).done(function(e){for(var n=!0,a=e.files,o=!1,d=0;d<a.length;d++){var s=a[d],p=V.addFile(s,!1,N,I);if(p){p.resetModified();if(d<P||5>=a.length){V.open(p)}else{o=!0}}else{n=!1}}$.tabs("option","active",0);if(e.compilationexecution){C.setResult(e.compilationexecution,!1)}X.setTimeLeft(e);if(""<e.comments){t("#vpl_ide_input_comments").val(e.comments)}if(n){V.resetModified()}else{V.setModified()}if(0===V.length()&&0<W){X.getAction("new")()}else if(!c.saved){V.setModified()}V.setFontSize(c.fontSize);V.setVersion(e.version);V.fileListVisible(o);l.afterAll("AfterLoadFiles",function(){N();S();k(!0)})}).fail(I)};window.VPLIDE=r;return{init:function init(e,i){s=new r(e,i)}}});
//# sourceMappingURL=vplide.min.js.map
